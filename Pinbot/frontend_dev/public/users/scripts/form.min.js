$.validator.addMethod("emailOrMobile",function(a,b,c){return a.trim().match(/^[0-9a-z_\.\+\-]+@[0-9a-z\-]+\.[0-9a-z\.\-]+$/i)||a.match(/^1[0-9]{10}$/i)?!0:!1},"Please enter your email or mobile number."),$.validator.addMethod("smscodeRequired",function(a,b,c){return a.match(/^[0-9]{6}$/i)?!0:!1},"Please enter your sms code."),$.validator.addMethod("mobile",function(a,b,c){return a.match(/^1[0-9]{10}$/i)?!0:!1},"Please enter your mobile number."),$.validator.addMethod("phoneNumber",function(a,b,c){return a.match(/^[0-9,\-]{6,}$/i)?!0:!1},"Please enter your phone number."),$.validator.addMethod("QQ",function(a,b,c){return a.match(/^[0-9]{5,}$/i)?!0:!1},"Please enter your QQ number."),$.validator.addMethod("chinese",function(a,b,c){return a.match(/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi)?!0:!1},"Please enter some Chinese words."),$("input.big-placeholder").focus(function(){if(1==$(this).parent().find("label:nth-child(1)").length){var a=$(this).parent().find("label:nth-child(1)");$(a).removeClass("pc-hide")}}),$("input.big-placeholder").blur(function(){if(1==$(this).parent().find("label:nth-child(1)").length){var a=$(this).parent().find("label:nth-child(1)");$(a).hasClass("pc-hide")||""!=$(this).prop("value")||$(a).addClass("pc-hide")}}),$("input.big-placeholder").change(function(){if(1==$(this).parent().find("label:nth-child(1)").length){var a=$(this).parent().find("label:nth-child(1)");$(a).hasClass("pc-hide")||""!=$(this).prop("value")?""!=$(this).prop("value")?$(a).hasClass("pc-hide")&&$(a).removeClass("pc-hide"):$(a).hasClass("pc-hide")||$(a).addClass("pc-hide"):$(a).addClass("pc-hide")}}),$("input.big-placeholder").keydown(function(a){if(1==$(this).parent().find("label:nth-child(1)").length){var b=$(this).parent().find("label:nth-child(1)");$(b).hasClass("pc-hide")&&$(b).removeClass("pc-hide")}});var countDown=function(a,b){var c=$(".jumpTo")[0];null!=c.innerHTML&&(c.innerHTML=a,--a>0?setTimeout("countDown("+a+",'"+b+"')",1e3):window.location.href=b)};$(function(){$(".send_active").on("click",function(a){a.preventDefault();var b=$(this),c=b.attr("email");pbDebug&&console.log("send_active",c),isValidEmail(c)?$.ajax({type:"get",dataType:"json",url:"/users/send_active_email/"+c+"/",success:function(a){a&&a.status&&"ok"==a.status?$(".resp_info").html(a.msg).css("display","block"):a&&a.status&&"malice"==a.status&&$(".resp_info").html(a.msg).css("display","block")}}):$(".resp_info").html("\u8bf7\u767b\u5f55\u90ae\u7bb1\u6fc0\u6d3b\u90ae\u4ef6\uff5e").css("display","block")}),$(".got-to-activate").on("click",function(a){a.preventDefault();var b=$(this),c=b.attr("email");if(pbDebug&&console.log("got-to-activate",c),isValidEmail(c)){if(c.match(/^([^@]+)@([0-9a-z\.\-]+)/i)){var d="http://www."+RegExp.$2;confirm("\u786e\u5b9a\u6253\u5f00\u7f51\u5740\uff1a["+d+"]\uff1f")&&window.open(d)}}else $(".resp_info").html("\u8bf7\u5c3d\u5feb\u767b\u5f55\u90ae\u7bb1\u6fc0\u6d3b\u90ae\u4ef6\uff5e").css("display","block")}),$(".captcha").length&&$(".captcha").click(function(a){var b=$(".captcha").attr("src")+"?t="+ +new Date;$(".captcha").attr("src",b)}),$("#JS_reset_submit").length&&$("#JS_reset_submit").click(function(){var a=$(this).closest("form"),b=a.serializeObject(),c="/users/password_confirm_ajax/";return b.new_password1&&b.new_password2?b.new_password1.length<6||b.new_password2<6?($.alert('<p style="text-align:center;color:#333;font-size:14px;">\u5bc6\u7801\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e6\uff01</p>'),!1):b.new_password1!=b.new_password2?($.alert('<p style="text-align:center;color:#333;font-size:14px;">2\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01</p>'),!1):void $.post(c,JSON.stringify(b),function(a){if(a&&"ok"==a.status){var b=$("#JS_no_card").html();$.LayerOut({html:b,dialogCss:"width:540px;"})}else a&&a.msg?$.alert('<p style="text-align:center;color:#333;font-size:14px;">'+a.msg+"</p>"):$.alert('<p style="text-align:center;color:#333;font-size:14px;">\u8bf7\u586b\u5199\u5b8c\u6574\uff01</p>')},"json"):($.alert('<p style="text-align:center;color:#333;font-size:14px;">\u8bf7\u586b\u5199\u5b8c\u6574\uff01</p>'),!1)})});var regOptions={rules:{user_email:{required:!0,email:!0},password:{required:!0,minlength:6,maxlength:20},phone:{required:!0,phoneNumber:!0},smscode:{required:!0,smscodeRequired:!0,minlength:6,maxlength:6},name:{required:!0},qq:{required:!0,QQ:!0},company_name:{required:!0},select_fields:{required:!0},agreement:{required:!0}},messages:{user_email:{required:"\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\uff01",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u90ae\u7bb1\uff01"},password:{required:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd"},phone:{required:"\u8054\u7cfb\u7535\u8bdd\u4e0d\u80fd\u4e3a\u7a7a\uff01",phoneNumber:"\u8bf7\u8f93\u5165\u8054\u7cfb\u7535\u8bdd"},smscode:{required:"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",smscodeRequired:"\u8bf7\u8f93\u5165\u77ed\u4fe1\u9a8c\u8bc1\u7801",minlength:"\u8bf7\u8f93\u5165\u516d\u4f4d\u77ed\u4fe1\u9a8c\u8bc1\u7801",maxlength:"\u8bf7\u8f93\u5165\u516d\u4f4d\u77ed\u4fe1\u9a8c\u8bc1\u7801"},name:{required:"\u771f\u5b9e\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01"},qq:{required:"\u8054\u7edcQQ\u4e0d\u80fd\u4e3a\u7a7a\uff01",QQ:"\u8bf7\u8f93\u5165\u6709\u6548QQ\u53f7\u7801\uff01"},company_name:{required:"\u4f01\u4e1a\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"},select_fields:{required:"\u8bf7\u9009\u62e9\u6240\u5728\u9886\u57df\uff01"},agreement:{required:"\u8bf7\u540c\u610f\u8058\u5b9d\u7528\u6237\u534f\u8bae\uff01"}},errorClass:"invalid",invalidHandler:function(a,b){var c=b.errorList;$(c[0].element).focus()}},loginOptions={rules:{username:{required:!0,emailOrMobile:!0},password:{required:!0,minlength:6,maxlength:20}},messages:{username:{required:"\u90ae\u7bb1/\u624b\u673a\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01",emailOrMobile:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u90ae\u7bb1/\u624b\u673a\u53f7\uff01"},password:{required:"\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd"}},errorClass:"invalid",invalidHandler:function(a,b){var c=b.errorList;$(c[0].element).focus()}},resetMobileOptions={rules:{phone:{required:!0,mobile:!0},code:{required:!0,minlength:4,maxlength:8},password:{required:!0,minlength:6},re_password:{required:!0,equalTo:"#password"}},messages:{phone:{required:"\u624b\u673a\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01",mobile:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\uff01"},code:{required:"\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u9a8c\u8bc1\u7801\u5e94\u4e3a4-8\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u9a8c\u8bc1\u7801\u5e94\u4e3a4-8\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd"},password:{required:"\u65b0\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u65b0\u5bc6\u7801\u4e0d\u5c11\u4e8e\u516d\u4f4d\uff01"},re_password:{required:"\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",equalTo:"\u786e\u8ba4\u5bc6\u7801\u4e0d\u5bf9\uff01"}},errorClass:"invalid",invalidHandler:function(a,b){var c=b.errorList;$(c[0].element).focus()}},resetOptions={rules:{email:{required:!0,email:!0},code:{required:!0,minlength:4,maxlength:8}},messages:{email:{required:"\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a\uff01",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u90ae\u7bb1\uff01"},code:{required:"\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u9a8c\u8bc1\u7801\u5e94\u4e3a4-8\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u9a8c\u8bc1\u7801\u5e94\u4e3a4-8\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd"}},errorClass:"invalid",invalidHandler:function(a,b){var c=b.errorList;$(c[0].element).focus()}},resetOptions2={rules:{new_password1:{required:!0,minlength:6,maxlength:20},new_password2:{required:!0,minlength:6,maxlength:20,equalTo:"#password_new"}},messages:{new_password1:{required:"\u65b0\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u65b0\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u65b0\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd"},new_password2:{required:"\u786e\u8ba4\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01",minlength:"\u786e\u8ba4\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",maxlength:"\u786e\u8ba4\u5bc6\u7801\u5e94\u4e3a6-20\u4f4d\u7684\u6570\u5b57\u52a0\u5b57\u6bcd",equalTo:"\u786e\u8ba4\u5bc6\u7801\u4e0d\u5339\u914d"}},errorClass:"invalid",invalidHandler:function(a,b){var c=b.errorList;$(c[0].element).focus()}};$(function(){"placeholder"in document.createElement("input")||$("input[placeholder]").each(function(){var a=$(this),b=$("<label>");b.html(a.attr("placeholder")),b.css({"font-size":"12px",position:"absolute",left:"110px",top:"13px",color:"#999",cursor:"text",width:"90%","text-align":"left"}),a.on("keydown paste",function(){setTimeout(function(){b[a.val()?"hide":"show"]()},0)}).parent().append(b.on("click",function(){a.focus()}))}),$(".field_list").on("click",function(a){a.preventDefault();var b=$(a.target),c=$(".select_fields");if($("label#select_fields-error").css("display","none"),b.is("a")){var d=b.attr("field_id");b.parent().hasClass("selected")?(b.parent().removeClass("selected"),c.each(function(){var a=$(this);return a.val()==d?(a.val(""),c.length>1&&""==a.val()&&a.remove(),!1):void 0})):$(".selected").length<3?(b.parent().addClass("selected"),c.each(function(){var a=$(this);return""==a.val()?(a.val(d),!1):(a.parent().append('<input type="hidden" name="select_fields" class="select_fields" value="'+d+'" required/>'),!1)})):b.parent().hasClass("selected")&&b.parent().removeClass("selected")}else if(b.is("li")){var d=b.find("a").attr("field_id");b.hasClass("selected")?(b.removeClass("selected"),c.each(function(){var a=$(this);return a.val()==d?(a.val(""),c.length>1&&""==a.val()&&a.remove(),!1):void 0})):$(".selected").length<3&&(b.addClass("selected"),c.each(function(){var a=$(this);return""==a.val()?(a.val(d),!1):(a.parent().append('<input type="hidden" name="select_fields" class="select_fields" value="'+d+'" required/>'),!1)}))}});var a=$(".register-confirm").html();$(".register-confirm").on("click",function(){var b=$("#regForm"),d=(b.validate(regOptions),$(this));if(b.valid()){d.attr("disabled","true");var e=PB.formSerializeToObject(b);return e.hasOwnProperty("smscode")&&(e.code=e.smscode,delete e.smscode),PB.request("post","/users/account_register/","json",function(c){$(".register-confirm").removeAttr("disabled"),PB.formErrHandler(c,function(a){b[0].reset(),$(".selected").removeClass("selected"),$.cookie("wait_to_activate",a.username,{expires:365,path:"/"}),document.location.href=a.redirect_url},null,".register-confirm",a)},function(a,b){return PB.btnAlert(".register-confirm","\u7f51\u7edc\u8c8c\u4f3c\u6709\u95ee\u9898\uff5e\u91cd\u65b0\u8bd5\u8bd5"),!1},e,"json"),!1}});var b=function(){var a=$("#loginForm");a.validate(loginOptions),$(this);if(a.valid()){$(".login-btn").attr("disabled","true");var d=PB.formSerializeToObject(a);return PB.request("post","/users/account_login/","json",function(a){$(".login-btn").removeAttr("disabled"),PB.formErrHandler(a,function(a){document.location.href=a.redirect_url},null,".login-btn","\u7acb\u5373\u767b\u5f55")},function(a,b){return PB.btnAlert(".login-btn","\u7f51\u7edc\u8c8c\u4f3c\u6709\u95ee\u9898\uff5e\u91cd\u65b0\u8bd5\u8bd5"),$(".login-btn").attr("disabled","false"),!1},d,"json"),!1}},c=function(a,b,c){$(a).keypress(function(a){var d=a.which;13==d&&"function"==typeof b&&b(c)})};c("#password",function(){b()}),$(".verify-by-mobile").on("click",function(){document.location.href="/users/change_pwd_by_mobile/"}),$(".verify-by-email").on("click",function(){document.location.href="/users/resetpassword/"}),$(".login-btn").on("click",function(){b()});var d=$(".reset-mobile-btn").html();$(".reset-mobile-btn").on("click",function(){PB.validateFormSubmit($("#resetByMobileForm"),resetMobileOptions,".reset-mobile-btn",function(a){return a.hasOwnProperty("phone")&&(a.mobile=a.phone,delete a.phone),a},"/users/change_pwd_by_mobile/",function(a){$("#resetByMobileForm")[0].reset(),PB.btnAlert(".reset-mobile-btn","\u65b0\u5bc6\u7801\u8bbe\u7f6e\u6210\u529f\uff01",d,"#fff")},"\u627e\u56de\u5bc6\u7801")}),$(".reset-btn").on("click",function(){var a=$("#resetForm"),d=(a.serialize(),a.validate(resetOptions),$(this));a.valid()&&(d.attr("disabled","true"),a.submit(),$("body").scrollTop(0))}),$(".reset2-btn").on("click",function(){var a=$("#resetForm2"),d=(a.serialize(),a.validate(resetOptions2),$(this));a.valid()&&(d.attr("disabled","true"),a.submit(),$("body").scrollTop(0))});var f,e=!1;$(".smscodeBox").length&&PB.smsCodeHtml(".smscodeBox","phone",f,e);var h,g=!1;$("#code-mobile").length&&PB.smsCodeHtml("#code-mobile","phone",h,g,"ChangePwd"),$(".modify-email").on("click",function(a){var b='<div class="no-feed-alert"><p class="text-center f14">\u8bf7\u91cd\u65b0\u8f93\u5165\u63a5\u6536\u90ae\u7bb1\uff1a<input type="text" name="new-email" value="" id="new-email" class="dark-border f14"><br><br></p><p class="text-center f14"><span class="city-no-star">\u8be5\u90ae\u7bb1\u4ec5\u4e3a\u60a8\u63a5\u53d7\u8058\u5b9d\u63a8\u8350\u7b80\u5386\u7684\u90ae\u7bb1\uff0c\u4e0d\u7528\u4e8e\u767b\u5f55\uff0c\u60a8\u53ef\u81f3\u201c\u4e2a\u4eba\u8bbe\u7f6e\u201d\u4e2d\u4fee\u6539</span><br><br></p><p class="text-center"><button class="btn btn-blue-light-submit-small confirm">\u53d1\u9001\u9a8c\u8bc1\u94fe\u63a5</button></p></div>';$.LayerOut({html:b}),$(".modal").delegate(".confirm","click",function(){console.log("confirm")})}),$(".resend-email").on("click",function(a){$(".pb-wait-resend").removeClass("pb-hide"),PB.request("get","/users/resend_bind_email/","json",function(a){$(".done-resend").removeClass("pb-hide"),$(".pb-wait-resend").addClass("pb-hide")},function(a,b){$(".done-resend-err").removeClass("pb-hide"),$(".pb-wait-resend").addClass("pb-hide")})}),$("p").undelegate(".chg-email").delegate(".chg-email","click",function(a){PB.chgNotifyEmail(e,f,function(a){PB.formErrHandler(a,function(a){box.close(),$(".pb-layer").addClass("pb-hide"),$(".email-valid-ok").removeClass("pb-hide"),PB.countDown(".email-valid-ok","/users/profile/"),$(".link-guide").on("click",function(a){document.location.href="/tut/"})},null,".chg-email","\u786e\u8ba4\u4fee\u6539")})})});