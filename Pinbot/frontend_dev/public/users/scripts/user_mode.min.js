!function(a){var b=angular.module("app.user_mode",["app.config","ui.router","app.django","app.utils","app.filter"]),c=angular.injector(["app.django","app.utils"]),d=c.get("tmpl"),g=(c.get("static_url"),c.get("mockTest"),c.get("mockTestWithCoin")),i=(c.get("confirmBox"),c.get("alertBox")),j=c.get("getModeData"),k=c.get("postModeData"),l=c.get("pbFunc"),m=c.get("orderPay");b.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){var e="/";b.otherwise(e),a.state("userMode",{url:"/",templateUrl:d("users/user_mode.html"),controller:"userMode"}),a.state("userModeDiy",{url:"/usermode_diy/",templateUrl:d("users/user_mode_diy.html"),controller:"userModeDiy"}),a.state("userModeDiyPay",{url:"/usermode_diy_pay/",templateUrl:d("users/user_mode_diy_pay.html"),controller:"userModeDiyPay"}),a.state("userModeDiyPayOk",{url:"/usermode_diy_pay_ok/",templateUrl:d("users/user_mode_diy_pay_ok.html"),controller:"userModeDiyPayOk"}),a.state("userModeNoWorry",{url:"/usermode_noworry/",templateUrl:d("users/user_mode_noworry.html"),controller:"userModeNoWorry"}),a.state("userModeNoWorrySubmit",{url:"/usermode_noworry_submit/",templateUrl:d("users/user_mode_noworry_submit.html"),controller:"userModeNoWorrySubmit"})}]),b.factory("fUserMode",function(){return{listDiy:[],listNoworry:[],choosedModeList:[],choosedModeListMinor:[],loading:!0,currentOrderData:{},chooseOneModeId:0,chooseOneModeType:"",chooseOneModeName:"",modeFee:0,servicePeriod:"",serviceExpired:""}}),b.run(function(a,b){a.$on("$viewContentLoaded",function(){b.removeAll()})}),b.controller("userMode",["$scope","$http","$state","$templateCache","fUserMode",function(a,b,c,d,e){a.loading=e.loading,a.basePriceDiy=0,a.basePriceNoworry=0,a.loadingDiy=!0,a.loadingNoworry=!0,j(b,"/vip/get_self_service_select/","",function(c){e.listDiy=c.data,l.minPrice(a,c.data,"basePriceDiy"),a.loadingDiy=!1,j(b,"/vip/get_manual_service_select/","",function(b){e.listNoworry=b.data,l.minPrice(a,b.data,"basePriceNoworry"),a.loadingNoworry=!1})}),a.chooseUserMode=function(b,d){$(".user-mode").removeClass("selected"),$(".user-mode-"+d).addClass("selected");var f="userModeNoWorry";e.choosedModeList=e.listNoworry,d.match(/^diy$/i)&&(e.choosedModeList=e.listDiy,f="userModeDiy"),e.loading=!1,a.loading=e.loading,c.go(f,{})}}]),b.controller("userModeDiy",["$scope","$http","$state","$templateCache","fUserMode",function(a,b,c,d,e){a.loadingThis=!0,a.chooseOneMode=!1,a.chooseOneModeId=0,a.chooseOneModeType="",a.chooseOneModeName="",a.modeFee=0,a.agreementChecked=!0,a.servicePeriodList=[{n:3,selected:!0},{n:4,selected:!1},{n:5,selected:!1},{n:6,selected:!1},{n:7,selected:!1},{n:8,selected:!1},{n:9,selected:!1},{n:10,selected:!1},{n:11,selected:!1},{n:12,selected:!1}],a.servicePeriod="3",a.serviceExpired="2016-10-29 00:00:00",0==e.choosedModeList.length?j(b,"/vip/get_self_service_select/","",function(b){l.updateUserModeList(e,a,b,null,null)}):a.loadingThis=!1,a.modeList=e.choosedModeList,a.clickMode=function(c,d,f,g,h,i,j){j?l.orderActAlert(b,a,$,"\u8d2d\u4e70\u5931\u8d25","",'\u60a8\u6b63\u5728\u4f7f\u7528\u7701\u5fc3\u578b\u5957\u9910\uff0c\u4e0d\u80fd\u8d2d\u4e70\u81ea\u52a9\u578b\u5957\u9910\uff0c\u6709\u7591\u95ee\uff0c\u8bf7\u54a8\u8be2<a href="javascript:void(0);" id="JS_pbqqdiy_btn" class="c63c2ec">\u8058\u5b9d\u4eba\u624d\u987e\u95ee</a>\uff01',"\u786e\u5b9a",function(){$._LayerOut.close()}):i?$(".user-mode-small-"+f).hasClass("selected")?($(".user-mode-small").removeClass("selected"),a.chooseOneModeId=0,a.chooseOneModeType="",a.chooseOneModeName="",a.chooseOneMode=!1,a.modeFee=0,e.chooseOneModeId=a.chooseOneModeId,e.chooseOneModeType=a.chooseOneModeType,e.chooseOneModeName=a.chooseOneModeName,e.modeFee=a.modeFee):(a.chooseOneModeId=parseInt(f),a.chooseOneModeType=d,a.chooseOneModeName=h,$(".user-mode-small").removeClass("selected"),$(".user-mode-small-"+f).addClass("selected"),a.chooseOneMode=!0,a.modeFee=g,e.chooseOneModeId=a.chooseOneModeId,e.chooseOneModeType=a.chooseOneModeType,e.chooseOneModeName=a.chooseOneModeName,e.modeFee=a.modeFee):l.orderActAlert(b,a,$,"\u8d2d\u4e70\u5931\u8d25","","\u8bf7\u9009\u62e9\u66f4\u9ad8\u7ea7\u522b\u7684\u5957\u9910\u8d2d\u4e70\uff01","\u786e\u5b9a",function(){$._LayerOut.close()})},a.clickToPayAfterConfirm=function(c){if($("#agreement").prop("checked")===!1)a.agreementChecked=!1,$("#agreement-error").text("\u8bf7\u5148\u540c\u610f\u8058\u5b9d\u5957\u9910\u7528\u6237\u534f\u8bae").css("display","block");else if(a.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==c){for(var d=0,f=0,g=0,h=0,i=e.choosedModeList.length;i>h;h++){var k=e.choosedModeList[h];if(k.pid==e.chooseOneModeId){d=k.feed_count,f=k.pinbot_point,g=e.servicePeriod;break}}var m="";m+='<div class="price content box-content box-content-table box-content-table-box pd-top-0 lh180">',m+='<div class="modal-line-big text-center"><span class="f18 c42b4e6">'+e.chooseOneModeName+"</span></div>",m+='<div class="box-col box-col-center">',m+='<div class="user-mode">',m+="<ul>",m+='    <li class="text-center">',m+="        <span>\u5b9a\u5236\u6570\u91cf</span>",m+='        <span><span class="cf46c62">'+d+"</span>\u4e2a</span>",m+="    </li>",m+='    <li class="text-center">',m+="        <span>\u6bcf\u5468\u53ef\u4f7f\u7528\u8058\u70b9</span>",m+='        <span><span class="cf46c62">'+f+"</span>\u70b9</span>",m+="    </li>",m+='    <li class="text-center">',m+="        <span>\u670d\u52a1\u65f6\u957f</span>",m+='        <span><span class="cf46c62">'+g+"</span>\u4e2a\u6708</span>",m+="    </li>",m+="</ul>",m+="</div>",m+="</div>",m+='<div class="modal-line text-center">\u670d\u52a1\u6709\u6548\u671f\u81f3\uff1a<span class="cf46c62">'+e.chooseOneModeName+"</span><br></div>",m+='<div class="modal-line text-center">\u670d\u52a1\u8d39\u7528\uff1a<span class="cf46c62">\xa5 '+e.modeFee+"</span></div>",m+="</div>",l.pbAlert(b,a,$,"\u8bf7\u786e\u8ba4\u60a8\u8981\u8d2d\u4e70\u7684\u5957\u9910\uff01","",m,"\u786e\u8ba4\u8d2d\u4e70",function(){j(b,"/vip/self/info/?pid="+a.chooseOneModeId,"#/usermode_diy_pay/",function(b){e.currentOrderData=b,a.currentOrderData=e.currentOrderData,a.loadingThis=!1})})}},a.clickToPay=function(c){$("#agreement").prop("checked")===!1?(a.agreementChecked=!1,$("#agreement-error").text("\u8bf7\u5148\u540c\u610f\u8058\u5b9d\u5957\u9910\u7528\u6237\u534f\u8bae").css("display","block")):(a.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==c&&j(b,"/vip/self/info/?pid="+a.chooseOneModeId,"#/usermode_diy_pay/",function(b){e.currentOrderData=b,a.currentOrderData=e.currentOrderData,a.loadingThis=!1}))},a.checkAgreement=function(b){a.agreementChecked===!1?(a.agreementChecked=!0,$("#agreement-error").text("").css("display","none")):a.agreementChecked=!1},a.goNoWorryMode=function(){e.choosedModeList=[],e.choosedModeListMinor=[],a.loadingThis=!0,j(b,"/vip/get_self_service_select/","",function(b){l.updateUserModeList(e,a,b,function(){c.go("userModeNoWorry",{})},null)})}}]),b.controller("userModeDiyPay",["$scope","$http","$state","fUserMode",function(a,b,c,d){a.userCoin=!1,void 0!=d&&void 0!=d.chooseOneModeId&&void 0!=d.currentOrderData.coin?(a.loadingThis=!0,a.payPid=d.chooseOneModeId,a.payType=d.chooseOneModeType,a.payName=d.chooseOneModeName,a.modeFee=d.modeFee,a.coin=g?1e3:d.currentOrderData.coin,a.payMethod="alipay"):c.go("userMode",{}),a.hoverMe=function(a,b){b===!0?$(a.currentTarget).addClass("hover"):$(a.currentTarget).removeClass("hover")},a.choosePayMethod=function(b,c){a.payMethod=c,$(b.currentTarget).hasClass("active")?$(b.currentTarget).removeClass("active"):($(".user-mode-pay").removeClass("active"),$(b.currentTarget).addClass("active")),$(".agreement-error").text("").css("display","none")},a.paynow=function(){if(""==a.payMethod)$(".agreement-error").text("\u8bf7\u5148\u9009\u62e9\u652f\u4ed8\u65b9\u5f0f\uff01").css("display","block");else if($(".agreement-error").text("").css("display","none"),"diy"==a.payType){var e=d.currentOrderData.order_info.product_type,f="alipay";f=a.coin>a.modeFee&&$("#userCoin").prop("checked")===!0?"coin":"alipay";var g=0,h={product_type:e,num:1,pid:a.payPid,payment_terms:f,is_insurance:g};pbDebug&&console.log("postData",d,h),m(a,c,b,$,h,"userModeDiyPayOk")}},$.Menu()}]),b.controller("userModeDiyPayOk",["$scope","$http","$state","fUserMode",function(a,b,c,d){a.feed_count=0,a.pinbot_point=0,l.currentDiySet(a,d.chooseOneModeId,d.choosedModeList)}]),b.controller("userModeNoWorry",["$scope","$http","$state","$templateCache","fUserMode",function(a,b,c,d,e){if(a.loadingThis=!0,a.chooseOneMode=!1,a.chooseOneModeId=0,a.chooseOneModeType="",a.chooseOneModeName="",a.chooseCandidateNum=1,a.modeFee=0,a.packagePrice=0,a.agreementChecked=!0,pbDebug&&console.log("userModeNoWorry choosedModeList",e.choosedModeList),0==e.choosedModeListMinor.length)j(b,"/vip/get_manual_service_select/","",function(b){e.choosedModeList=[],e.choosedModeListMinor=[];for(var c=0,d=b.data.length;d>c;c++)e.choosedModeListMinor.push(b.data[c]);a.modeListMinor=e.choosedModeListMinor,a.loadingThis=!1});else{a.loadingThis=!1;var f=e.choosedModeList;a.modeListMinor=[];for(var g=0,h=f.length;h>g;g++)a.modeListMinor.push(f[g]);e.choosedModeListMinor=a.modeListMinor}a.clickMode=function(b,c,d,f,g,h){$(".user-mode-small-"+d).hasClass("selected")?(a.chooseCandidateNum=1,a.chooseOneModeId=0,a.chooseOneModeType="",a.chooseOneModeName="",$(".user-mode-small").removeClass("selected"),a.chooseOneMode=!1,a.modeFee=0,a.packagePrice=0,e.chooseOneModeId=a.chooseOneModeId,e.chooseOneModeType=a.chooseOneModeType,e.chooseOneModeName=a.chooseOneModeName,e.modeFee=a.modeFee):(a.chooseCandidateNum=parseInt(g),a.chooseOneModeId=parseInt(d),a.chooseOneModeType=c,a.chooseOneModeName=h,$(".user-mode-small").removeClass("selected"),$(".user-mode-small-"+d).addClass("selected"),a.chooseOneMode=!0,a.modeFee=f,a.packagePrice=f,e.chooseOneModeId=a.chooseOneModeId,e.chooseOneModeType=a.chooseOneModeType,e.chooseOneModeName=a.chooseOneModeName,$("#useGuarantee").prop("checked")===!0?($(".useGuaranteeInfo").text("\u5df2\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice+500*a.chooseCandidateNum):($(".useGuaranteeInfo").text("\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice),e.modeFee=a.modeFee)},a.clickToPay=function(d){if($("#agreement").prop("checked")===!1)a.agreementChecked=!1,$("#agreement-error").text("\u8bf7\u5148\u540c\u610f\u8058\u5b9d\u5957\u9910\u7528\u6237\u534f\u8bae").css("display","block");else if(a.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==d);else{var f=a.chooseOneModeType,g="offline",h=$("#useGuarantee").prop("checked")===!0?1:0;1==h?($(".useGuaranteeInfo").text("\u5df2\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice+500*a.chooseCandidateNum):($(".useGuaranteeInfo").text("\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice),e.modeFee=a.modeFee;var i={product_type:f,num:1,pid:a.chooseOneModeId,payment_terms:g,is_insurance:h};pbDebug&&console.log("postData",e,i),k(b,i,"/vip/create_user_order/","",function(b){pbDebug&&console.log("diy paynow",b),void 0!=b.status&&"ok"==b.status?(e.modeFee=b.order_price,c.go("userModeNoWorrySubmit",{})):$.alert('<p class="alert-notice-center"><span>\u521b\u5efa\u8ba2\u5355\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01</span></p>'),a.loadingThis=!1})}},a.chooseGuarantee=function(){$("#useGuarantee").prop("checked")===!0?($(".useGuaranteeInfo").text("\u5df2\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice+500*a.chooseCandidateNum):($(".useGuaranteeInfo").text("\u9009\u62e9\u8d2d\u4e70"),a.modeFee=a.packagePrice),e.modeFee=a.modeFee},a.checkAgreement=function(b){a.agreementChecked===!1?(a.agreementChecked=!0,$("#agreement-error").text("").css("display","none")):a.agreementChecked=!1},a.goDiyMode=function(){e.choosedModeList=[],e.choosedModeListMinor=[],a.loadingThis=!0,j(b,"/vip/get_self_service_select/","",function(b){l.updateUserModeList(e,a,b,function(){c.go("userModeDiy",{})},null)})};var m=function(b){a.$apply(function(){a.modeFee=a.packagePrice+b*a.chooseCandidateNum}),e.modeFee=a.modeFee};a.aboutInsurance=function(){$.LayerOut({html:i('<span class="pay-title">\u5173\u4e8e\u5165\u804c\u9669\u7684\u8bf4\u660e</span>',"\u63d0\u4ea4\u8ba2\u5355\u540e\uff0c\u8bf7\u7b49\u5f85\u8058\u5b9d\u4eba\u624d\u987e\u95ee\u4e0e\u60a8\u6c9f\u901a\u5e76\u6838\u5bf9\u4fe1\u606f",'\u9009\u62e9\u8d2d\u4e70\u5165\u804c\u9669<span class="cf46c62">500\u5143/\u4eba</span>\uff0c\u6211\u4eec\u63d0\u4f9b\u6bcf\u4e2a\u5019\u9009\u4eba<span class="cf46c62">2\u5468</span>\u7684\u5165\u804c\u4fdd\u8bc1\u671f\u5177\u4f53\u4fe1\u606f\u8bf7\u54a8\u8be2\u9500\u552e\u987e\u95ee\u3002',"\u786e\u8ba4\u8d2d\u4e70"),afterClose:function(){}}),$(".modal").undelegate(".btn-click-ok").delegate(".btn-click-ok","click",function(a,b){$._LayerOut.close(),$("#useGuarantee").prop("checked",!0),$(".useGuaranteeInfo").text("\u5df2\u9009\u62e9\u8d2d\u4e70"),m(500)})},$.Menu()}]),b.controller("userModeNoWorrySubmit",["$scope","$http","$state","fUserMode",function(a,b,c,d){return a.loadingThis=!0,a.salary_range="",a.service_month=0,a.candidate_num=0,a.modeFee=d.modeFee,0==d.choosedModeListMinor.length?(c.go("userModeNoWorry",{}),!1):(l.currentNoworrySet(a,d.chooseOneModeId,d.choosedModeListMinor),void $.Menu())}]),b.directive("servicePeriod",function(a){return{restrict:"E",templateUrl:"/static/users/servicePeriod.html",scope:{servicePeriodList:"="},replace:!0,controller:function(a,b){a.chooseServicePeriod=function(b,c){for(var e=(b.currentTarget,0),f=a.servicePeriodList.length;f>e;e++)a.servicePeriodList[e].selected=!1,a.servicePeriodList[e].n==c&&(a.servicePeriodList[e].selected=!0)}},link:function(a,b,c,d){console.log("directive link",a,b,c,d)},compile:function(a,b,c){return{pre:function(a,b,c,d){},post:function(a,b,c,d){}}}}})}();