(function(){var e=angular.module("app.notify",["app.config","app.django","ui.router","app.utils"]);var d=angular.injector(["app.django","app.utils"]);var a=d.get("tmpl");var b=d.get("api");var c=d.get("id_url");e.config(["$stateProvider","$urlRouterProvider",function(g,f){f.otherwise("/all/");g.state("unread",{url:"/unread/",templateUrl:a("notify/notify_list.html"),controller:"notifyList"});g.state("all",{url:"/all/",templateUrl:a("notify/notify_list.html"),controller:"notifyList"});g.state("read",{url:"/read/",templateUrl:a("notify/notify_list.html"),controller:"notifyList"});}]);e.controller("notifyList",["$scope","$http","$state","$compile","$rootScope",function(g,j,i,h,f){g.notify_type=i.current.name;g.page=g.page||1;j.get(b.notify.notify_list,{params:{page:g.page,notify_type:g.notify_type,}}).success(function(k){g.data=k;g.pages=k.pages;});g.checkShow=function(){return g.notify_type==="read"?false:true;};g.markNotifyRead=function(l){var k=c(b.notify.mark_notify_read,l);j.get(k).success(function(m){alert(m.msg);});};g.markAllRead=function(){j.get(b.mark_all_read).success(function(k){location.href.reload();});};g.view=function(l){target=l.target;if(target.tagName.toLowerCase()=="a"){return true;}var k=angular.element(target).parent().find("a").attr("href");location.href=k;};angular.element(window).on("scroll",function(){if($(document).height()-$(window).height()-$(document).scrollTop()>100){return false;}if(f.loading){return false;}if(g.page>=g.pages){return false;}f.loading=true;g.page++;var k=h('<load-more page="page"></load-more>')(g);angular.element("[ui-view]").append(k);});}]);e.controller("loadNotify",["$scope","$element","$http","$compile","$rootScope",function(h,g,j,i,f){j.get(b.notify.notify_list,{params:{page:h.page,notify_type:h.notify_type,}}).success(function(k){h.data=k;f.loading=false;}).error(function(){f.loading=false;});}]);e.directive("loadMore",function(){return{restrict:"E",templateUrl:a("notify/notify_list.html"),controller:"loadNotify",scope:{page:"=page"}};});e.filter("to_trusted",["$sce",function(f){return function(g){return f.trustAsHtml(g);};}]);e.filter("farmatDate",function(){return function(g){var f=g.indexOf("+");return g.substring(0,f);};});})();