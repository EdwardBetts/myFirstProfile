(function(){var e=angular.module("app.chat",["app.config","ui.router","app.django","app.utils","app.filter"]);var d=angular.injector(["app.django","app.utils"]);var a=d.get("tmpl");var b=d.get("api");var c=d.get("id_url");e.config(["$stateProvider","$urlRouterProvider",function(g,f){f.otherwise("/history_chat/");g.state("chat_book",{url:"/chat_book/",templateUrl:a("chat/chat.html"),controller:"chatList",onExit:function(){angular.element(window).unbind("scroll");},data:{pageActive:"book_list"}});g.state("history_chat",{url:"/history_chat/",templateUrl:a("chat/history_chat.html"),controller:"chatList",onExit:function(){angular.element(window).unbind("scroll");},data:{pageActive:"history_list"}});}]);e.controller("chatList",["$scope","$http","$state","$rootScope","$compile","$filter",function(g,k,i,f,h,j){f.pageActive=window.pageActive=i.current.data.pageActive;g.page=g.pages=1;f.loading=false;k.get(b.chat[i.current.data.pageActive],{params:{page:g.page}}).success(function(l){if(l.data&&l.data.length){g.data=l;g.userid=l.user_id;g.pages=l.pages;f.noRecord=false;}else{f.noRecord=true;}}).error(function(){f.noRecord=true;});g.toDetail=function(l){location.href="/chat/chat_detail/"+l+"/";};g.loadMoreFun=function(){if($(document).height()-$(window).height()-$(document).scrollTop()>100){return false;}if(f.loading){return false;}if(g.page>=g.pages){return false;}f.loading=true;g.page++;var l=h("<load-more"+(window.pageActive=="history_list"?"-history":"")+' page="'+g.page+'" ></load-more>')(g);angular.element("[ui-view]").append(l);};angular.element(window).on("scroll",g.loadMoreFun);}]);e.directive("loadMore",function(f){var g=window.pageActive=="history_list"?"history_chat":"chat";return{restrict:"E",templateUrl:a("chat/"+g+".html"),controller:"loadMoreChat",scope:true};});e.directive("loadMoreHistory",function(f){var g=window.pageActive=="history_list"?"history_chat":"chat";return{restrict:"E",templateUrl:a("chat/"+g+".html"),controller:"loadMoreChat",scope:true};});e.controller("loadMoreChat",["$scope","$http","$state","$rootScope","$filter",function(g,j,h,f,i){j.get(b.chat[h.current.data.pageActive],{params:{page:g.page}}).success(function(k){g.data=k;f.loading=false;}).error(function(){f.loading=false;});}]);})();