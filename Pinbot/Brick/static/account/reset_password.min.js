var pwdReg=/^(?![^a-zA-Z]+$)(?!\D+$).{8,20}$/,options={rules:{password:{required:true,rangelength:[8,20]},confirm_password:{required:true,equalTo:"#id_password"}},messages:{password:{required:"新密码不能为空！",rangelength:"密码应为8-20个数字+字母"},confirm_password:{required:"密码确认不能为空！",equalTo:"两次输入不一致！"}}};function showResponse(b,c){$("#id_submit").removeAttr("disabled").removeClass("disabled");var a=b;if(a&&a.status&&a.status=="ok"){window.location.href="/account/login";}else{if(a&&a.status&&a.status=="token_error"){alert(a.msg);}else{if(a&&a.status&&a.status=="token_expire"){alert(a.msg);}else{if(a&&a.status&&a.status=="form_error"){alert(a.msg);}}}}}function showRequest(d,c,b){var a=$("#resetForm").valid();if(a){$("#id_submit").attr("disabled","disabled").addClass("disabled");}return a;}$(document).ready(function(){validator=$("#resetForm").validate(options);$("#id_submit").click(function(){var c=$(this);validator.form();var a=$("[name = password]").val();var b=$("[name = confirm_password]").val();var d=$("[name = csrfmiddlewaretoken]").val();c.ajaxSubmit({type:"post",url:".",dataType:"json",data:{password:a,confirm_password:b,csrfmiddlewaretoken:d},beforeSubmit:showRequest,success:showResponse,error:function(e){$("#id_submit").removeAttr("disabled").removeClass("disabled");console.log(e.responseText);}});});$(document).on("keyup",function(a){if(a.keyCode==13){$("#id_submit").trigger("click");}});});$("#id_password").on("blur",function(){var c=$(this),d=c.val(),e=c.attr("id");if(!pwdReg.test(d)){var a=$("#"+e+"-error"),b="密码应为8-20个数字+字母";if(a.length){a.html(b).show();c.addClass("error");}else{c.after('<label id="'+e+'-error" class="error" for="'+e+'">'+b+"</label>");c.addClass("error");}}});$("input").on("focus",function(){var a=$(this),b=a.attr("id");a.removeClass("error");$("#"+b+"-error").each(function(){$(this).css("display","none");});$(".tips").each(function(){$(this).parent().css("display","none");});$("button[type=submit]").removeAttr("disabled").css("background","#0091fa");});