var emailReg=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/,gmailReg=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([gG][mM][aA][iI][lL])+\.[a-zA-Z]{2,3}$/,options={rules:{username:{required:true,email:true},password:{required:true},invite_code:{required:true}},messages:{username:{required:"邮箱不能为空！",email:"请输入正确格式的邮箱！"},password:{required:"请输入密码！"},invite_code:{required:"请输入邀请码！"}}};function showResponse(f,g){$("#id_submit").removeAttr("disabled").removeClass("disabled");var d=f;if(d&&d.status&&d.status=="ok"){$("button[type=submit]").attr("disabled","disabled").css("background","#ccc");$(".result").html("激活邮件已发送至你的注册邮箱，请激活后登录").parent().show();}else{if(d&&d.status&&d.status=="malice_ip"){$("button[type=submit]").attr("disabled","disabled").css("background","#ccc");$(".result").html("提交得太频繁啦，休息一会再试吧！").parent().show();}else{if(d&&d.errors){for(var c in d.errors){var b=$('[name="'+c+'"]'),h=b.attr("id"),a=$("#"+h+"-error"),e=d.errors[c];if(a.length){a.html(e).show();b.addClass("error");}else{b.after('<label id="'+h+'-error" class="error" for="'+h+'">'+e+"</label>");b.addClass("error");}}}}}}function showRequest(d,c,b){var a=$("#registerForm").valid();if(a){$("#id_submit").attr("disabled","disabled").addClass("disabled");}return a;}$(document).ready(function(){validator=$("#registerForm").validate(options);$("#id_submit").click(function(){var c=$(this);validator.form();var e=$("[name = username]").val();var b=$("[name = password]").val()?$("[name = password]").val():"123456as";var a=$("[name = invite_code]").val();var d=$("[name = csrfmiddlewaretoken]").val();c.ajaxSubmit({type:"post",dataType:"json",data:{username:e,password:b,invite_code:a,csrfmiddlewaretoken:d},beforeSubmit:showRequest,success:showResponse,error:function(f){$("#id_submit").removeAttr("disabled").removeClass("disabled");console.log(f.responseText);}});});$(document).on("keyup",function(a){if(a.keyCode==13){$("#id_submit").trigger("click");}});});$("#id_username").on("focus",function(){$(".info").remove();$("[name = password]").parent().css("display","block");var d=$(this),e=d.val();if(gmailReg.test(e)){var b=$("[name=username]"),f=b.attr("id"),a=$("#"+f+"-error"),c="Gmail可能会收不到验证邮件，建议使用其他邮箱";if(a.length){a.html(c).show();}else{b.after('<label id="'+f+'-error" class="error gmail" for="'+f+'">'+c+"</label>");}}});$("#id_username").on("keyup",function(){var d=$(this),e=d.val();if(gmailReg.test(e)){var b=$("[name=username]"),f=b.attr("id"),a=$("#"+f+"-error"),c="Gmail可能会收不到验证邮件，建议使用其他邮箱";if(a.length){a.html(c).show();}else{b.after('<label id="'+f+'-error" class="error gmail" for="'+f+'">'+c+"</label>");}}});$("#id_username").on("blur",function(){$(".gmail").remove();var a=$(this),c=a.val(),b=a.attr("valid_email");a.data("username",c);a.data("valid_email_url",b);if(emailReg.test(c)){$.ajax({type:"get",dataType:"json",url:a.data("valid_email_url"),data:{username:a.data("username")},success:function(g){if(g&&g.status&&g.status=="user_exists"){var d=$("[name = username]"),i=d.attr("id"),f=$("#"+i+"-info"),h=g.msg;if(f.length){f.html(h+'<a href="/account/login">登录</a>').show();f.find("a").on("click",function(){window.location.href="/account/login";});}else{d.after('<label id="'+i+'-info" class="info" for="'+i+'">'+h+'<a href="/account/login">登录</a></label>');$("label").find("a").on("click",function(){window.location.href="/account/login";});}}else{if(g&&g.status&&g.status=="company_user"){var d=$("[name = username"),f=$("#"+i+"-info"),i=d.attr("id"),e=$("[name = password]"),h=g.msg;if(f.length){f.html(h).show();if(e.length!=0){e.parent().css("display","none");}}else{d.after('<label id="'+i+'-info" class="info" for="'+i+'">'+h+"</label>");if(e.length!=0){e.parent().css("display","none");}}e.val("");}}},error:function(d){console.log(d.responseText);}});}});