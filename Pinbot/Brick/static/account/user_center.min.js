(function(){var b=angular.module("app.account",["app.config","validation","validation.rule"]),a=function(j,f){for(var e in j){var c=$(f).find('[name="'+e+'"]'),g=c.next(),d=g[0]&&g[0].tagName?g[0].tagName.toLowerCase():"",h=g.find("p");if(d=="span"&&h.length){h.html(j[e]);}else{c.after('<span><p class="validation-invalid">'+j[e]+"</p></span>");}g.show();}};b.controller("editAccount",["$scope","$element","$http",function(d,c,e){d.isChangePassword=d.isOpenContact=d.isOpenRecommend=false;d.csrfmiddlewaretoken=angular.element('[name="csrfmiddlewaretoken"]').val();d.toggleChangePassword=function(f){d.isChangePassword=f;};d.toggleOpenContact=function(f){d.isOpenContact=f;};d.toggleOpenRecommend=function(f){d.isOpenRecommend=f;};d.togglePasswordType=function(g){var i=angular.element(g.target),f=i.next(),h=f.attr("type");h=h=="text"?"password":"text";i.toggleClass("active");f.attr("type",h);};d.changePassword=function(){var f=c.find("form")[0];if(d.password!=d.confirm_password){a({confirm_password:"确认密码与新密码不一致！"},f);return false;}e.post(".",$.param({old_password:d.old_password,password:d.password,confirm_password:d.confirm_password,csrfmiddlewaretoken:d.csrfmiddlewaretoken})).success(function(g){if(g.status=="ok"){d.isChangePassword=false;d.old_password=d.password=d.confirm_password="";}else{if(g.data&&g.data.errors){a(g.data.errors,f);}}}).error(function(){console.log("请求失败了.");});};}]);})();