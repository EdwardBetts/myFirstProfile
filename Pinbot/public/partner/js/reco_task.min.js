function cancelBubble(a){if(!a){var a=window.event;}a.cancelBubble=true;if(a.stopPropagation){a.stopPropagation();}}Array.prototype.remove=function(a){if(isNaN(a)||a>this.length){return false;}for(var b=0,c=0;b<this.length;b++){if(this[b]!=this[a]){this[c++]=this[b];}}this.length-=1;};(function(){var e=angular.module("recoTaskApp",["ui.router","app.config","app.filter"]),c=angular.injector(["app.utils","app.django"]),b=c.get("id_url"),a=c.get("tmpl"),d=c.get("static_url");e.config(["$stateProvider","$urlRouterProvider",function(g,f){f.otherwise("/list");g.state("list",{url:"/list",controller:"recoListCtrl",templateUrl:a("partner/task_time.html")});}]);e.controller("recoListCtrl",["$scope","$http","$state",function(f,j,g){var i=window.localStorage;f.city_list=["北京","上海","广州","深圳","杭州","重庆","成都","西安","武汉"];f.showCityList=false;f.showHistoryList=false;f.selected_city=i.getItem("selected_city")?i.getItem("selected_city").split(","):[];f.history_list=i.getItem("history_list")?i.getItem("history_list").split(","):[];f.keyword=f.history_list.length===0?"":angular.copy(f.history_list[f.history_list.length-1]);f.examples=["产品经理 Axure"];f.hot_tasks=["Java","PHP","前端"];f.loading=true;f.current=1;f.showBackdrop=false;f.getAjaxData=function(){j.get("/partner/reco_task_list/",{params:{page:f.current,city:f.selected_city,keywords:f.keyword}}).success(function(k){if(k){if(k.data&&k.data.length>0){f.datas=k;f.noAnyData=false;}else{f.noData();}if(k.all_citys.length!=0){f.city_list=k.all_citys;}if(k.examples.length!=0){f.examples=k.examples;}if(k.hot_tasks.length!=0){f.hot_tasks=k.hot_tasks;}}else{f.noData();}f.loading=false;}).error(function(){f.loading=false;f.noData();});};f.getAjaxData();f.noData=function(){f.noAnyData=true;};f.prev=function(){if(f.current<=1){return;}f.loading=true;f.current--;f.getAjaxData();};f.next=function(){if(f.current>=f.datas.pages){return;}f.loading=true;f.current++;f.getAjaxData();};f.toogleBackdrop=function(k){f.showBackdrop=k;};f.isShowLayer=function(l,m,k){f.checkTask();f.viewFeed=false;if(k.has_resume){f.toogleBackdrop(true);l.stopPropagation();f.upload_url=k.upload_task_url+m;f.select_url=k.select_resume_url+m+"/";}else{location.href=k.upload_task_url+m;}};f.showViewDesc=true;f.viewFeed=false;f.toggleView=function(k){f.viewFeed=k;};f.showFeed=function(k){f.checkTask();f.toggleView(true);f.feedData={task:k,feed:k.feed,company:k.feed.company};f.refresh();};f.toggleDesc=function(){f.showViewDesc=!f.showViewDesc;f.refresh();};f.refresh=function(){if(!f.viewFeed){return;}setTimeout(function(){$(".modal-dialog-view").css({marginTop:($(window).height()-$(".modal-dialog-view").height())/2+"px"});},0);};f.checkTask=function(){j.get("/partner/check_task/");};f.toggleCity=function(k){f.showCityList=!k;};f.showHistory=function(){if(f.history_list.length!=0){var k=$(".history-list");k.show();f.showHistoryList=true;}};var h=-1;f.toggleUpDown=function(l){var k=$(".history-list").find("li");if(l.keyCode===40){if(h!=-1){k.eq(h).removeClass("hovered");}h++;if(h===k.length){h=0;}k.eq(h).addClass("hovered");}else{if(l.keyCode===38){if(h!=-1){k.eq(h).removeClass("hovered");h--;}if(h==-1){h=k.length-1;}k.eq(h).addClass("hovered");}else{if(l.keyCode===13&&h!=-1){f.keyword=k.eq(h)[0].innerText;f.hideHistory();}else{if(l.keyCode===13){f.loading=true;f.current=1;f.getAjaxData();f.saveKeyword();}else{if(l.keyCode===188){$(l.target)[0].value=$(l.target)[0].value.replace(/[,]/g,"");}}}}}f.showHistory();};f.setHovered=function(m,l){$(".hovered").removeClass("hovered");var k=$(".history-list").find("li");h=l;k.eq(h).addClass("hovered");};f.clearHovered=function(){h=-1;$(".hovered").removeClass("hovered");};$("body").on("click",function(m){m.stopPropagation();var k=$(m.target),l=k.attr("target_type");if(l!=undefined){return false;}else{f.hideHistory();}});f.hideHistory=function(){h=-1;$(".hovered").removeClass("hovered");$(".history-list").hide();f.showHistoryList=false;};f.isSelected=function(l){for(var k=f.selected_city.length-1;k>=0;k--){if(f.selected_city[k]===l){return true;}}return false;};f.setCity=function(o,m){var k=$(m.target);if(k.hasClass("selected")){k.removeClass("selected");for(var l=0,p=0;l<f.selected_city.length;l++){if(f.selected_city[l]!=o){f.selected_city[p++]=f.selected_city[l];}}f.selected_city.length-=1;}else{k.addClass("selected");f.selected_city.push(o);}};f.saveCity=function(){i.setItem("selected_city",f.selected_city);f.showCityList=false;};f.setKeyword=function(k){f.keyword=k;};f.saveKeyword=function(){if(f.keyword===""){return;}if(f.history_list.length>0){for(var k=f.history_list.length-1;k>=0;k--){if(f.history_list[k]===f.keyword){return false;}}if(f.history_list.length===5){f.history_list.shift();}f.history_list.push(f.keyword);}else{f.history_list.push(f.keyword);}i.setItem("history_list",f.history_list);};f.clickSearch=function(){f.loading=true;f.current=1;f.getAjaxData();f.saveKeyword();};f.clickKeyword=function(k){f.setKeyword(k);f.saveKeyword();f.loading=true;f.current=1;f.getAjaxData();};f.deleteHistory=function(m,k){cancelBubble(m);var l=f.history_list.length-k-1;f.history_list.remove(l);i.setItem("history_list",f.history_list);};}]);e.filter("formatCity",function(){return function(f){var h=[];if(f.length===0){return"请选择";}else{if(f.length<3){return f.join(",");}else{for(var g=0;g<2;g++){h.push(f[g]);}return h.join(",")+"...";}}};});e.filter("formatExamples",function(){return function(f){var h=[];for(var g=0;g<f.length;g++){h.push(f[g]);}return h.join(";");};});e.filter("reverse",function(){return function(f){return f.slice().reverse();};});})();