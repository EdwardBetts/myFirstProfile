!function(a,b){var c=a.module("feedApp",["app.config","ui.router","app.utils","app.filter","app.django","validation","validation.rule"]),d=a.injector(["app.django","app.utils"]),e=d.get("id_url");d.get("tmpl");c.controller("feedController",["$scope","$validation","$http",function(c,d,f){c.feedData=a.fromJson(a.element(document.getElementById("JS_container")).attr("data-feedData")),c.feedData.analyze_titles=[],c.feedData.analyze_keywords=[],c.isAddNew=!0,c.loadingMore=!1,c.loadingMoreDone=!1,c.isSyncData=!1,c.isFillAll=!0,c.invalidPanelClassName="";for(var g in c.feedData.feed){c.isAddNew=!1,c.loadingMoreDone=!0;break}c.firstStep=!0,c.feedData.levelDirty=c.feedData.levelCity=!1,c.feedData.titleDirty=c.feedData.descDirty=!1,c.feedData.jobKeywordDirty=c.feedData.keywordDirty=c.feedData.catDirty=c.feedData.salaryDirty=c.preferDirty=c.welfareDirty=!1,c.feedData.submiting=!1,c.isAddNew||(c.feedData.descDirty=!0),c.showViewDesc=!0,c.viewFeed=!1,c.feedData.talent_level=["\u521d\u7ea7","\u4e2d\u7ea7","\u9ad8\u7ea7"],c.feedData.feed=a.extend({title:"",job_desc:"",expect_area:[],talent_level:[],analyze_titles:[],keywords:[],job_domain:[],company_prefer:[],job_welfare:[],salary_min:"",salary_max:""},c.feedData.feed),c.feedData.title=c.feedData.feed.title,0==c.feedData.feed.salary_min&&1e6==c.feedData.feed.salary_max&&(c.feedData.feed.salary_min="",c.feedData.feed.salary_max="",c.isNegotiable=!0),c.feedData.feed.categorys=c.feedData.company.categorys||[],c.feedData.min_salary=c.feedData.max_salary=c.feedData.min_num=c.feedData.max_num=0,c.feedData.Databackup=a.copy(c.feedData.feed),c.defaultErrorMsg="\u6b64\u9879\u4e3a\u5fc5\u586b\u9879\uff01",c.reDescErrorMsg=c.reTitleErrorMsg=c.reLevelErrorMsg=c.reAreaErrorMsg=c.reKeywordsErrorMsg=c.reJobKeywordsErrorMsg=c.reCatErrorMsg=c.reSalaryErrorMsg=c.defaultErrorMsg,c.reDescError=c.reTitleError=c.reLevelError=c.reAreaErrorError=c.reKeywordsError=c.reCatError=c.reJobKeywordsError=c.reSalaryError=!1,c.reCatErrorMsg="",c.reCatError=!1,c.feedData.catDirty=!1;var h=function(a){if(c.feedData.feed[a].length>0)for(var d=0,e=c.feedData.feed[a].length;e>d;d++)(c.feedData.feed[a][d]==b||""==c.feedData.feed[a][d].trim())&&c.feedData.feed[a].splice(d,1)};c.isAddNew||(h("analyze_titles"),h("keywords")),0==c.feedData.feed.analyze_titles.length&&(c.feedData.jobKeywordDirty=!0),0==c.feedData.feed.keywords.length&&(c.feedData.keywordDirty=!0);var i=function(a,d){var e=!1;"string"==typeof a?e=a==b||""==a.trim()?!0:!1:"object"==typeof a&&(e=0==a.length?!0:!1),e?(c.invalidPanelClassName=d,c.isFillAll=!1):c.isFillAll=!0},j=20,k=1e3,l=function(a,b){if("string"!=typeof a)return!1;var c=a;return c.match(/[^\x00-\xff]/i)&&(c=c.replace(/[^\x00-\xff]/g,"**")),c.length<=b?!0:!1};c.$watchCollection("feedData.feed.title",function(a,b){i(a,"#label_job_title_title"),c.reTitleErrorMsg=c.defaultErrorMsg,c.reTitleError=!1}),c.$watchCollection("feedData.feed.job_desc",function(a,b){c.isAddNew?i(a,"#label_job_desc_title"):i(a,"#label_job_desc_title_edit"),c.reDescErrorMsg=c.defaultErrorMsg,c.reDescError=!1,""!=a&&("#label_job_desc_title"==c.invalidPanelClassName&&(c.invalidPanelClassName=""),"#label_job_desc_title_edit"==c.invalidPanelClassName&&(c.invalidPanelClassName="")),l(a,k)||(c.reDescErrorMsg="\u804c\u4f4d\u8be6\u60c5\u6700\u591a\u4e3a500\u5b57",c.reDescError=!0,c.isAddNew?c.invalidPanelClassName="#label_job_desc_title":c.invalidPanelClassName="#label_job_desc_title_edit")}),c.$watchCollection("feedData.feed.talent_level",function(a,b){c.isAddNew?i(a,"#label_level_title"):i(a,"#label_level_title_edit"),c.reLevelErrorMsg=c.defaultErrorMsg,c.reLevelError=!1,c.loadingMoreDone&&c.getAnalyzeRelated()}),c.$watchCollection("feedData.feed.expect_area",function(a,b){i(a,"#label_expect_area_title"),c.reAreaErrorMsg=c.defaultErrorMsg,c.reAreaErrorError=!1}),c.$watchCollection("feedData.feed.analyze_titles",function(a,b){i(a,"#label_job_keywords_title"),c.loadingMoreDone&&c.getAnalyzeRelated(),c.reJobKeywordsErrorMsg="\u6b64\u9879\u4e3a\u5fc5\u586b\u9879\uff0c\u8bd5\u8bd5\u70b9\u51fb\u201c\u89e3\u6790\u804c\u4f4d\u8be6\u60c5\u201d\u5e2e\u4f60\u586b\u5199\u62d3\u5c55\u540d",c.reJobKeywordsError=!1,a.length>0&&($(".icon-menu-job-keyword").addClass("right-nav-state-current"),"#label_job_keywords_title"==c.invalidPanelClassName&&(c.invalidPanelClassName=""),a.length>j&&c.feedData.feed.analyze_titles.splice(a.length-1,1));var d=c.feedData.feed.analyze_titles.join("");l(d,k)||c.feedData.feed.analyze_titles.splice(a.length-1,1)}),c.$watchCollection("feedData.feed.keywords",function(a,b){i(a,"#label_skill_keywords_title"),c.loadingMoreDone&&c.getAnalyzeRelated(),c.reSkillKeywordsErrorMsg=c.defaultErrorMsg,c.reSkillKeywordsError=!1,a.length>0&&($(".icon-menu-skill-keyword").addClass("right-nav-state-current"),"#label_skill_keywords_title"==c.invalidPanelClassName&&(c.invalidPanelClassName=""),a.length>j&&c.feedData.feed.keywords.splice(a.length-1,1));var d=c.feedData.feed.keywords.join("");l(d,k)||c.feedData.feed.keywords.splice(a.length-1,1)}),c.$watchCollection("feedData.feed.job_domain",function(a,b){c.loadingMoreDone&&c.getAnalyzeRelated(),c.reCatErrorMsg=c.defaultErrorMsg,c.reCatError=!1}),c.$watchCollection("feedData.feed.company_prefer",function(a,b){c.loadingMoreDone&&c.getAnalyzeRelated(),c.rePreferError=!1,c.rePreferErrorMsg=c.defaultErrorMsg}),c.$watchCollection("feedData.feed.job_welfare",function(a,b){c.reWelfareError=!1,c.reWelfareErrorMsg=c.defaultErrorMsg}),c.salaryMsgs=["\u6700\u4f4e\u85aa\u8d44\u4e3a\u5fc5\u586b\u9879\uff01","\u8bf7\u8f93\u5165\u5927\u4e8e1000\u5c0f\u4e8e1000000\u7684\u85aa\u8d44","\u6700\u9ad8\u85aa\u8d44\u5e94\u5927\u4e8e\u6700\u4f4e\u85aa\u8d44","\u6700\u9ad8\u85aa\u8d44\u4e0d\u80fd\u5927\u4e8e\u6700\u4f4e\u85aa\u8d44\u7684\u4e09\u500d","\u6700\u9ad8\u85aa\u8d44\u4e3a\u5fc5\u586b\u9879\uff01"],c.$watchCollection("feedData.feed.salary_min",function(a,b){if(a!=b){var d=parseInt(c.feedData.feed.salary_max),e="",f=!1;a=parseInt(a),a?1e3>a||a>1e6?(e=c.salaryMsgs[1],f=!0):d&&a>d?(e=c.salaryMsgs[2],f=!0):d&&d/a>3?(f=!0,e=c.salaryMsgs[3]):d?(1e3>d||d>1e6)&&(e=c.salaryMsgs[1],f=!0):(e=c.salaryMsgs[4],f=!0):(e=c.salaryMsgs[0],f=!0),c.reSalaryError=f,c.reSalaryErrorMsg=e}}),c.$watchCollection("feedData.feed.salary_max",function(a,b){if(a!=b){var d=parseInt(c.feedData.feed.salary_min),e="",f=!1;a=parseInt(a),a?1e3>a||a>1e6?(e=c.salaryMsgs[1],f=!0):d&&d>a?(e=c.salaryMsgs[2],f=!0):d&&a/d>3?(e=c.salaryMsgs[3],f=!0):d?(1e3>d||d>1e6)&&(e=c.salaryMsgs[1],f=!0):(e=c.salaryMsgs[0],f=!0):(e=c.salaryMsgs[4],f=!0),c.reSalaryError=f,c.reSalaryErrorMsg=e}}),c.isShowList={},c.isShowCurrentList={};var m=function(b,c){var d=a.element(b.currentTarget),e=a.element(document.getElementsByClassName("icon-menu"));e.removeClass("right-nav-current"),d.addClass("right-nav-current"),d.attr("class").match(/right\-nav\-state\-error/i)&&(e.removeClass("right-nav-current-wrong"),d.addClass("right-nav-current-wrong"))},n=function(c){var d=a.element(o(c)).offset().top;d!=b&&"number"==typeof d&&a.element(window).scrollTop(d)},o=function(c){if(c!=b&&"string"==typeof c){if(c.match(/^#(.+)$/i)){var d=RegExp.$1;return null!=document.getElementById(d)?a.element(document.getElementById(d))[0]:null}return null!=document.getElementsByClassName(c)?a.element(document.getElementsByClassName(c)[0])[0]:null}return null};c.moveToPanel=function(a,b){c.isAddNew?"city"==b?m(a,"label_expect_area_title"):"level"==b?m(a,"id"):"job_title"==b?m(a,"id"):"job_desc"==b&&m(a,"id"):"city_edit"==b?m(a,"id"):"level_edit"==b?m(a,"id"):"job_title_edit"==b?m(a,"id"):"job_desc_edit"==b&&m(a,"id"),"keyword"==b?m(a,"id"):"job_keyword"==b?m(a,"id"):"skill_keyword"==b?m(a,"id"):"domain"==b?m(a,"id"):"prefer"==b?m(a,"id"):"welfare"==b?m(a,"id"):"salary"==b&&m(a,"id")},c.chkPanel=function(a){if(c.isAddNew){if("city"==a&&null!=document.getElementById("JS_city_addnew"))return c.isShowList.city=!0,!0;if("level"==a&&null!=document.getElementById("JS_level_edit"))return c.isShowList.level=!0,!0;if("job_title"==a&&null!=document.getElementById("JS_job_title_box"))return c.isShowList.job_title=!0,!0;if("job_desc"==a&&null!=document.getElementById("JS_job_desc_box"))return c.isShowList.job_desc=!0,!0}else{if("city_edit"==a)return!0;if("level_edit"==a&&null!=document.getElementById("JS_level_edit"))return c.isShowList.level_edit=!0,!0;if("job_title_edit"==a)return!0;if("job_desc_edit"==a&&null!=document.getElementById("JS_job_desc_edit_box"))return c.isShowList.job_desc_edit=!0,!0}return"keyword"==a&&null!=document.getElementById("JS_skill_keywords_box")?(c.isShowList.keyword=!0,!0):"job_keyword"==a&&null!=document.getElementById("JS_job_keywords_box")?(c.isShowList.job_keyword=!0,!0):"skill_keyword"==a&&null!=document.getElementById("JS_skill_keywords_box")?(c.isShowList.skill_keyword=!0,!0):"domain"==a&&null!=document.getElementById("JS_categorys_box")?(c.isShowList.domain=!0,!0):"prefer"==a&&null!=document.getElementById("JS_prefer_box")?(c.isShowList.prefer=!0,!0):"welfare"==a&&null!=document.getElementById("JS_welfare_box")?(c.isShowList.welfare=!0,!0):"salary"==a&&null!=document.getElementById("JS_salary_box")?(c.isShowList.salary=!0,!0):!1},c.isPrimaryLevel=function(){return!1},c.toLowSalary=function(){return c.feedData.feed.salary_min&&c.feedData.min_salary?c.feedData.feed.salary_min<c.feedData.min_salary:!1},c.formatArrayParam=function(a,b){var c=[];if(!a||!a.length)return"";for(var d=0,e=a.length;e>d;d++)b?c.push(a[d][b]):c.push(a[d]);return c.join(",")},c.concat=function(a,b){return a&&a.length?b?a.join(b):a.join(","):""},c.returnIdArray=function(a){var b=[];if(!a||!a.length)return"";for(var c=0,d=a.length;d>c;c++){var e=a[c].id;e&&b.push(e)}return b},c.hasInArr=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!0;return!1},c.toggleCity=function(b,d){c.feedData.levelCity=!0;var e=c.feedData.feed.expect_area,f=a.element(d.target),g=f.hasClass("active"),e=c.feedData.feed.expect_area||[];if(g){for(var h=0,i=e.length;i>h;h++)if(e[h]==b){c.feedData.feed.expect_area.splice(h,1);break}}else c.feedData.feed.expect_area.push(f.text());f.toggleClass("active")},c.isCityActive=function(a){var b=c.feedData.feed.expect_area;if(!b||!b.length)return!1;for(var d=0,e=b.length;e>d;d++)if(b[d]==a)return"active";return!1},c.toggleLevel=function(b,d){c.feedData.levelDirty=!0;var e=c.feedData.feed.talent_level,f=a.element(d.target),h=(f.attr("data-id"),f.hasClass("active"));if(e=e||[],h){for(var i=0,j=e.length;j>i;i++)if(e[i]==b){c.feedData.feed.talent_level.splice(i,1);break}}else c.feedData.feed.talent_level.push(b);f.toggleClass("active")},c.isLevelActive=function(a){var b=c.feedData.feed.talent_level;if(!b||!b.length)return!1;for(var d=0,e=b.length;e>d;d++)if(b[d]==a)return"active";return!1};var p=function(){var b=a.element(document.getElementsByClassName("job_desc_parse"));b.text("\u89e3\u6790\u804c\u4f4d\u8be6\u60c5"),b.removeAttr("disabled")},q=function(a,b,d,e){if(c.feedData[a].length>0)for(var f=0;d>f&&c.feedData[a].length>0;f++){var g=c.feedData[a].shift();s(c.feedData.feed[b],g,e)}};c.loadAnalyzeData=function(b){c.feedData.analyze_keywords=b.analyze_keywords||[],c.isAddNew?q("analyze_keywords","keywords",4,"keywords"):0==c.feedData.feed.keywords.length&&q("analyze_keywords","keywords",4,"keywords"),c.feedData.analyze_titles=b.analyze_titles||[],c.isAddNew?q("analyze_titles","analyze_titles",8,"analyze_titles"):0==c.feedData.feed.analyze_titles.length&&q("analyze_titles","analyze_titles",8,"analyze_titles"),c.feedData.analyze_job_domain=b.analyze_job_domain||[],c.feedData.feed.analyze_job_domain=b.analyze_job_domain||[],c.feedData.feed_extra_info=b.feed_extra_info||{},c.feedData.feed=a.extend(c.feedData.feed,c.feedData.feed_extra_info),p()},c.toggleTip=function(){a.element(document.getElementById("JS_slideup_btn")).toggleClass("active"),$("#JS_on_tip,#JS_off_tip").slideToggle()},c.setKeywords=function(b,d,e){var f=a.element(document.getElementById(b)),g=$.trim(f.val());f.val(""),c.feedData.feed[d].length>=20||g&&!c.hasInArr(c.feedData.feed[d],g)&&c.addAnaKeyword(g,e,d)};var r=function(a,c,d){if("string"!=typeof a)return"";var e=function(a){var c=0,d=0,e=0,f=0;if(a!=b&&"string"==typeof a){if(a=a.trim(),""==a)return 0;for(f=a.length,c=0;f>c;c++)e=a.charCodeAt(c),d+=127>e?1:2;return d}return 0},f=function(a,b,c){var d=0,f=0,g=0,h="",i=a.length,j=e(a);for(0>b&&(b=j+b),1>c&&(c=j+c),d=0;i>d&&!(f>=b);d++){var g=a.charCodeAt(d);f+=127>g?1:2}for(d=d;i>d;d++){var g=a.charCodeAt(d);if(f+=127>g?1:2,h+=a.charAt(d),f>=c)break}return h};return f(a,c,d)},s=function(a,d,e){if("string"!=typeof d)return!1;var f=d.trim(),g=[],h=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b){a.splice(c,1);break}},i=function(c,d){d&&!c.hasInArr(a,d)&&""!=d.trim()&&l(d,50)&&(e!=b&&("analyze_titles"==e||"keywords"==e)&&c.feedData[e]!=b&&h(c.feedData[e],d),a.push(d.trim()))};if(f.match(/([ ,\uff0c])/i)){var j=RegExp.$1;g=d.trim().split(j);for(var k=0,m=g.length;m>k;k++)i(c,g[k])}else i(c,f)};c.addAnaKeyword=function(a,b,d){c.feedData[b]=!0,"string"==typeof a&&s(c.feedData.feed[d],a,d),"analyze_titles"==d?document.getElementById("JS_job_keyword_model").focus():"keywords"==d&&document.getElementById("JS_keyword_model").focus()},c.removeAnaKeyword=function(a,d,e,f){if($(e.target).closest("#JS_skill_keywords_box").length&&(c.feedData.keywordDirty=!0),$(e.target).closest("#JS_job_keywords_box").length&&(c.feedData.jobKeywordDirty=!0),$(e.target).closest("#JS_welfare_box").length&&(c.feedData.welfareDirty=!1),a&&d&&d.length){for(var g=0,h=d.length;h>g;g++)if(d[g]==a){d.splice(g,1),f==b||"string"!=typeof f||c.feedData[f]==b||c.hasInArr(c.feedData[f],a)||c.feedData[f].push(a);break}e.stopPropagation()}};var t=function(a,b){var c=o(a);l(c.value,b)||(c.value=r(c.value,0,b))};c.watchKeyword=function(a,b,d,e,f){t(f,50),c.canSave(a)&&c.setKeywords(b,d,e)},c.toggleCat=function(b,d){c.feedData.catDirty=!1;var e=c.feedData.feed.job_domain,f=a.element(d.target),g=b.id,h=b.category,i=f.hasClass("active"),e=c.feedData.feed.job_domain||[];if(i){for(var j=0,k=e.length;k>j;j++)if(e[j].id==g){c.feedData.feed.job_domain.splice(j,1);break}}else{if(e.length>=3)return;c.feedData.feed.job_domain.push({id:g,category:h})}f.toggleClass("active")},c.isCatActive=function(a){var b=c.feedData.feed.job_domain;if(!b||!b.length)return!1;for(var d=0,e=b.length;e>d;d++)if(b[d].id==a.id)return"active";return!1},c.togglePrefer=function(b,d){c.feedData.preferDirty=!1;var e=c.feedData.feed.company_prefer,f=a.element(d.target),g=b.id,h=b.name,i=f.hasClass("active"),e=c.feedData.feed.company_prefer||[];if(i){for(var j=0,k=e.length;k>j;j++)if(e[j].id==g){c.feedData.feed.company_prefer=[];break}}else c.feedData.feed.company_prefer=[{id:g,category:h}];f.toggleClass("active")},c.isPreferActive=function(a){var b=c.feedData.feed.company_prefer;if(!b||!b.length)return!1;for(var d=0,e=b.length;e>d;d++)if(b[d].id==a.id)return"active";return!1},c.canSave=function(a){var b=a.target,c=b.value,d=a.keyCode;return 188==d?(b.value=c.substring(0,c.length-1),!0):!1},c.setWelfare=function(){var b=a.element(document.getElementById("JS_welfare_model")),d=$.trim(b.val());b.val(""),c.feedData.feed.job_welfare.length>=20||d&&!c.hasInArr(c.feedData.feed.job_welfare,d)&&c.addWelfare(d)},c.addWelfare=function(a){c.feedData.welfareDirty=!1,"string"==typeof a&&s(c.feedData.feed.job_welfare,a)},c.watchWelfare=function(a){t("#JS_welfare_model",50),c.canSave(a)&&c.setWelfare()},c.filterJobDomain=function(){for(var a=c.feedData.feed.job_domain||[],b=c.feedData.company.categorys||[],d=c.feedData.analyze_job_domain||[],e=b.concat(d),f=[],g=0,h=a.length;h>g;g++)for(var i=a[g].id,j=0,k=e.length;k>j;j++)if(jId=e[j].id,i==jId){f.push(a[g]);break}c.feedData.feed.job_domain=f};var u=function(d,e){var f=!1;if(c.feedData.feed[e]!=b&&("string"==typeof c.feedData.feed[e]&&""!=c.feedData.feed[e].trim()?f=!0:"object"==typeof c.feedData.feed[e]&&c.feedData.feed[e].length>0&&(f=!0)),null==document.getElementById(d)||f){var h=!1;return l(c.feedData.feed.job_desc,k)||(h=!0),h&&d.match(/^JS_job_desc_box/i)?(c.isAddNew?(n("#label_job_desc_title"),c.feedData.descDirty=!0):n("#label_job_desc_title_edit"),!1):!0}if(d.match(/^JS_level_edit$/i))c.isAddNew?(n("#label_level_title"),c.feedData.levelDirty=!0):n("#label_level_title_edit");else if(d.match(/^JS_job_desc_box/i))c.isAddNew?(n("#label_job_desc_title"),c.feedData.descDirty=!0):n("#JS_job_desc_edit_box");else if(d.match(/^JS_city_addnew/i))n("#label_expect_area_title"),c.feedData.levelCity=!0;else if(d.match(/^JS_job_title_box/i))n("#label_job_title_title"),c.feedData.titleDirty=!0;else{var g=a.element(document.getElementById(d)).offset().top;a.element(window).scrollTop(g)}return!1};c.jobDescParse=function(b,d){return 0==u("JS_city_addnew","expect_area")?!1:0==u("JS_level_edit","talent_level")?!1:0==u("JS_job_title_box","title")?!1:0==u("JS_job_desc_box","job_desc")?!1:(a.element(b.currentTarget).html('<img src="/static/b_common/img/loading.gif" alt="loading">'),a.element(b.currentTarget).attr("disabled",!0),void c.form.next(d))},c.form={next:function(e){if(c.feedData.titleDirty=c.feedData.descDirty=!0,null!=e.$error.maxlength&&null!=e.$error.job_desc&&e.$error.maxlength!=b&&e.$error.job_desc!=b)return document.getElementById("job_desc_message").style.display="block",document.getElementById("job_desc_message").getElementsByClassName("validation-invalid")[0].innerHTML="\u804c\u4f4d\u8be6\u60c5\u8bf7\u63a7\u5236\u57281000\u5b57\u4ee5\u5185\uff01",p(),!1;c.feedData.levelDirty=c.feedData.levelCity=!0;var f=0,g=d.validate(e);return c.feedData.feed.title?c.feedData.feed.talent_level.length?c.feedData.feed.expect_area.length?c.feedData.feed.job_desc?(c.loadingMore=!0,void g.success(function(){c.loadingMoreDone=!0,c.loadingMore=!1,c.next()}).error(function(){})):(e.job_desc.$invalid=!0,f=c.isAddNew?a.element(document.getElementById("JS_job_desc_addnew")).closest(".form-panel").offset().top:a.element(document.getElementById("JS_job_desc_edit")).closest(".form-panel").offset().top,a.element(window).scrollTop(f),p(),!1):(c.isAddNew&&(f=a.element(document.getElementById("JS_city_addnew")).offset().top),a.element(window).scrollTop(f),p(),!1):(f=c.isAddNew?a.element(document.getElementById("JS_level_addnew")).offset().top:a.element(document.getElementById("JS_level_edit")).offset().top,a.element(window).scrollTop(f),p(),!1):(e.title.$invalid=!0,f=a.element(document.getElementById("JS_job_title")).closest(".form-panel").offset().top,a.element(window).scrollTop(f),p(),!1)},submit:function(b){if(!c.isAddNew)if(c.isFillAll);else if(""!=c.invalidPanelClassName)return n(c.invalidPanelClassName),!1;c.filterJobDomain(),c.feedData.keywordDirty=c.feedData.salaryDirty=!0;var e=function(b){var c=a.element(document.getElementById(b)).offset().top;a.element(window).scrollTop(c)};if(c.isAddNew){if(!c.feedData.feed.expect_area.length)return e("label_expect_area_title"),!1;if(!c.feedData.feed.talent_level.length)return e("JS_level_edit"),!1;if(""==c.feedData.feed.title)return e("label_job_title_title"),!1;if(""==c.feedData.feed.job_desc)return e("label_job_desc_title"),!1}if(!c.feedData.feed.analyze_titles.length)return e("JS_job_keywords_box"),!1;if(!c.feedData.feed.keywords.length)return e("JS_skill_keywords_box"),!1;var f=0,g=d.validate(b);return c.isNegotiable||c.feedData.feed.salary_min&&c.feedData.feed.salary_max||(c.reSalaryError=!0),c.isNegotiable||(c.feedData.feed.salary_min||(b.salary_min.$invalid=!0),c.feedData.feed.salary_max||(b.salary_max.$invalid=!0)),c.isNegotiable||c.feedData.feed.salary_min&&c.feedData.feed.salary_max?!c.isNegotiable&&c.reSalaryError?(f=a.element(document.getElementById("JS_salary_box")).offset().top,a.element(window).scrollTop(f),!1):void g.success(function(){c.submit()}).error(function(){console.log("submit error")}):(c.reSalaryError=!0,c.reSalaryErrorMsg=c.defaultErrorMsg,c.feedData.feed.salary_min?c.feedData.feed.salary_max||$('[name="salary_max"]').val("").focus():$('[name="salary_min"]').val("").focus(),f=a.element(document.getElementById("JS_salary_box")).offset().top,a.element(window).scrollTop(f),!1)}},c.previous=function(){c.firstStep=!0},c.deleteFeed=function(a){$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>\u786e\u5b9a\u5220\u9664\u8be5\u5b9a\u5236\u5417\uff1f</p><p class="text-center cf46c62" style="font-size:14px;">\u5220\u9664\u540e\u4e0d\u53ef\u6062\u590d</p>',function(){location.href=e("/feed/delete/",a)})},c.next=function(){c.firstStep=!0,a.element(document.getElementById("JS_job_keyword_model")).focus(),f.post("/special_feed/analyze_jd/",JSON.stringify({title:c.feedData.feed.title,job_desc:c.feedData.feed.job_desc,expect_area:c.concat(c.feedData.feed.expect_area),talent_level:c.formatArrayParam(c.feedData.feed.talent_level)})).success(function(a){a&&a.data?c.loadAnalyzeData(a.data):c.loadAnalyzeData({})}).error(function(){c.loadAnalyzeData({})}),setTimeout(function(){var b=a.element(document.getElementById("JS_job_keywords_box")).offset().top;a.element(window).scrollTop(b)},500),c.feedData.Databackup=a.extend(c.feedData.Databackup,{title:c.feedData.feed.title,job_desc:c.feedData.feed.job_desc,expect_area:c.feedData.feed.expect_area,talent_level:c.feedData.feed.talent_level})},c.formatSubmitData=function(){var b=a.extend({},c.feedData.feed);return b.job_domain=c.returnIdArray(b.job_domain),b.company_prefer=c.returnIdArray(b.company_prefer),b.job_welfare=b.job_welfare.join(","),b.keywords=b.keywords.join(","),b.analyze_titles=b.analyze_titles.join(","),b.talent_level=b.talent_level.join(","),b.expect_area=c.concat(b.expect_area),b.block_titles=c.feedData.analyze_titles.join(","),b.block_keywords=c.feedData.analyze_keywords.join(","),b.__=(new Date).getTime(),c.isNegotiable&&(b.salary_min=0,b.salary_max=1e6),b},c.submit=function(){var b=function(b){var d="",e={salary_max:{variable:"reSalaryError",msg:"reSalaryErrorMsg",id:"label_salary_title"},salary_min:{variable:"reSalaryError",msg:"reSalaryErrorMsg",id:"label_salary_title"},job_desc:{variable:"reDescError",msg:"reDescErrorMsg",id:"label_job_desc_title"},talent_level:{variable:"reLevelError",msg:"reLevelErrorMsg",id:"label_level_title"},title:{variable:"reTitleError",msg:"reTitleErrorMsg",id:"label_job_title_title"},expect_area:{variable:"reAreaErrorError",msg:"reAreaErrorMsg",id:"label_expect_area_title"},keywords:{variable:"reKeywordsError",msg:"reKeywordsErrorMsg",id:"label_skill_keywords_title"},analyze_titles:{variable:"reJobKeywordsError",msg:"reJobKeywordsErrorMsg",id:"label_job_keywords_title"}};for(var f in b){var g=e[f];if(g){if(g.message)$(g.message).text(b[f][0]).show();else if(c[e[f].variable]=!0,c[e[f].msg]=b[f][0],null!=document.getElementById(e[f].id)){var h=a.element(document.getElementById(e[f].id)).offset().top;a.element(window).scrollTop(h)}}else d+=b[f][0]+"\r\n"}d&&$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>'+d+"</p>")},d=function(){c.feedData.submiting=!0,f.post("/special_feed/submit_feed/",JSON.stringify(c.formatSubmitData())).success(function(a){a&&"ok"==a.status?a.show_mission?($("#JS_username").html(a.username),$("#JS_mission_time").html(a.mission_time),$(".modal-backdrop-tip,.modal-tip").show(),$(".modal-dialog-tip").css({marginTop:($(window).height()-$(".modal-dialog-tip").height())/2+"px"})):a.redirect_url?a.redirect_url.match(/^\/feed$/i)?location.href="/special_feed/page/#/feed_resume/"+a.feed_id+"/":location.href=a.redirect_url:$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>\u4fdd\u5b58\u6210\u529f\uff01</p>'):a.errors?b(a.errors):$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>\u65b0\u589e\u5b9a\u5236\u5931\u8d25\uff0c\u53ef\u80fd\u662f\u4f60\u7684\u5957\u9910\u8bbe\u7f6e\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\u89e3\u51b3\uff01</p>'),c.feedData.submiting=!1}).error(function(){$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>\u65b0\u589e\u5b9a\u5236\u5931\u8d25\uff0c\u53ef\u80fd\u662f\u4f60\u7684\u5957\u9910\u8bbe\u7f6e\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb\u6211\u4eec\u89e3\u51b3\uff01</p>'),c.feedData.submiting=!1})};if(c.isAddNew)if(c.isFillAll){var e='<div style="margin: 0 auto;width: 400px;"><div class="f16 text-center"><i class="i-l-notice"></i>\u4ee5\u4e0b\u5185\u5bb9\u63d0\u4ea4\u540e\u4e0d\u53ef\u4fee\u6539</div><div class="f16 text-left" style="padding: 10px 0 0 135px;">\u804c\u4f4d\u540d\uff1a<span class="cf46c62">'+c.feedData.feed.title+'</span></div><div class="f16 text-left" style="padding: 10px 0 0 135px;">\u5de5\u4f5c\u5730\uff1a<span class="cf46c62">'+c.concat(c.feedData.feed.expect_area)+"</span></div></div>";$.alert(e,"","",{handlers:[{title:"\u8fd4\u56de\u4fee\u6539",eventType:"click",className:"button button-normal w158 f16",event:function(){$._LayerOut.close()}},{title:"\u786e\u5b9a",eventType:"click",className:"button button-primary w158 f16",event:function(){d(),$._LayerOut.close()}}]})}else""!=c.invalidPanelClassName&&n(c.invalidPanelClassName);else""!=c.invalidPanelClassName?n(c.invalidPanelClassName):d()},c.toggleEnvelope=function(){c.envelope=!0},c.getAnalyzeRelated=function(){c.isSyncData=!0,window.__httpAna&&window.__httpAna.abort(),window.__httpAna=$.ajax({type:"POST",url:"/special_feed/analyze_related/",data:JSON.stringify(c.formatSubmitData()),success:function(a){a&&"ok"==a.status&&a.data&&c.synData(a.data)}})},c.synData=function(b){c.animateNumber(b),a.element(document.getElementById("JS_slideup_btn")).addClass("active"),$("#JS_off_tip").slideUp(),$("#JS_on_tip").slideDown(),c.feedData.min_salary=b.salary.min,c.feedData.max_salary=b.salary.max,c.feedData.min_num=b.num.min,c.feedData.max_num=b.num.max},c.animateNumber=function(a){var d=50,e=c.feedData.min_salary,f=c.feedData.max_salary,g=c.feedData.min_num,h=c.feedData.max_num,i=$("#JS_salary_min"),j=$("#JS_salary_max"),k=$("#JS_num_min"),l=$("#JS_num_max"),m=(a.salary.min-e)/d,n=(a.salary.max-f)/d,o=(a.num.min-g)/d,p=(a.num.max-h)/d,q=1,r=function(a,c,d,e){a=a||0,c=isNaN(c=Math.abs(c))?2:c,d=d!==b?d:"",e=e||",";var f=0>a?"-":"",g=parseInt(a=Math.abs(+a||0).toFixed(c),10)+"",h=(h=g.length)>3?h%3:0;return d+f+(h?g.substr(0,h)+e:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+e)},s=function(){var a=r(parseInt(m*q+e)),b=r(parseInt(n*q+f)),c=r(parseInt(o*q+g)),t=r(parseInt(p*q+h));i.text(a),j.text(b),k.text(c),l.text(t),q++,d>=q&&setTimeout(function(){s()},30)};s()},c.synSalary=function(){c.isNegotiable=!1,c.feedData.feed.salary_min=c.feedData.min_salary,c.feedData.feed.salary_max=c.feedData.max_salary,$('[name="salary_min"]').val(c.feedData.min_salary),$('[name="salary_max"]').val(c.feedData.max_salary),$(".icon-menu-salary").addClass("right-nav-state-current"),n("#label_salary_title")},c.toggleView=function(){c.viewFeed=!c.viewFeed,c.refresh()},c.toggleDesc=function(){c.showViewDesc=!c.showViewDesc,c.refresh()},c.refresh=function(){c.viewFeed&&setTimeout(function(){$(".modal-dialog-view").css({marginTop:($(window).height()-$(".modal-dialog-view").height())/2+"px"})},0)}}]),c.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),c.directive("locationButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal f16" data-id="{- city -}" ng-class="isCityActive( city )" ng-click="toggleCity( city , $event )" ng-repeat="city in expectArea">{- city -}</a>',controller:function(a,b){},link:function(a,b,c){},scope:{expectArea:"="}}}),c.directive("talentButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal f16" data-level="{- level -}" ng-class="isLevelActive( level )" ng-click="toggleLevel( level , $event )" ng-repeat="level in talentLevel">{- level -}</a>',controller:function(a,b){},link:function(a,b,c){},scope:{talentLevel:"="}}}),c.directive("detailTextarea",function(){return{restrict:"E",replace:!0,template:'<textarea name="job_desc" id="JS_job_desc_addnew" rows="10" class="textarea full" ng-model="jobDescInfo" validator="jobDesc" ng-maxlength="1000" message-id="job_desc_message">{- jobDescInfo -}</textarea>',controller:function(a,b){},link:function(a,b,c){},scope:{jobDescInfo:"="}}}),c.filter("maxlen",function(){var a=function(a,c,d){if("string"!=typeof a)return"";var e=function(a){var c=0,d=0,e=0,f=0;if(a!=b&&"string"==typeof a){if(a=a.trim(),""==a)return 0;for(f=a.length,c=0;f>c;c++)e=a.charCodeAt(c),d+=127>e?1:2;return d}return 0},f=function(a,b,c){var d=0,f=0,g=0,h="",i=a.length,j=e(a);for(0>b&&(b=j+b),1>c&&(c=j+c),d=0;i>d&&!(f>=b);d++){var g=a.charCodeAt(d);f+=127>g?1:2}for(d=d;i>d;d++){var g=a.charCodeAt(d);if(f+=127>g?1:2,h+=a.charAt(d),f>=c)break}return h};return f(a,c,d)},c=function(a,b){if("string"!=typeof a)return!1;var c=a;return c.match(/[^\x00-\xff]/i)&&(c=c.replace(/[^\x00-\xff]/g,"**")),c.length<=b?!0:!1};return function(b){var d=16;return b.match(/[^\x00-\xff]/i)||(d=12),c(b,d)?b:a(b,0,d)+"..."}}),c.directive("customizedTitleButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/customized_title_button.html",controller:function(c,d){c.isShowNew=!1,c.watchKeyword=function(a,b,d,e,f){c.$parent.watchKeyword(a,b,d,e,f)},c.hasInArr=function(a,b){return c.$parent.hasInArr(a,b)},c.setKeywords=function(d,e,f,g){var h=a.element(document.getElementById(d)),i=$.trim(h.val());i!=b&&""!=i.trim()&&(!i||e!=b&&"object"==typeof e&&c.hasInArr(e,i)||(h.val(""),c.$parent.addAnaKeyword(i,f,g)))},c.setKeywordsEnter=function(a,b,d,e){c.$parent.setKeywords(b,d,e)},c.addAnaKeyword=function(a,b,d){c.$parent.addAnaKeyword(a,b,d)},c.removeAnaKeyword=function(a,b,d,e){c.$parent.removeAnaKeyword(a,b,d,e)},c.$watch("isShowNew",function(a,b,c){1==a&&window.setTimeout(function(){document.getElementById("JS_job_keyword_model").focus()},200)})},link:function(a,b,c){},scope:{keywords:"=",useRecommand:"=",recommandKeywords:"=",kwt:"=",selectTitle:"="}}}),c.directive("customizedButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/customized_button.html",controller:function(c,d){c.isShowNew=!1,c.watchKeyword=function(a,b,d,e,f){c.$parent.watchKeyword(a,b,d,e,f)},c.hasInArr=function(a,b){return c.$parent.hasInArr(a,b)},c.setKeywords=function(d,e,f,g){var h=a.element(document.getElementById(d)),i=$.trim(h.val());i!=b&&""!=i.trim()&&(!i||e!=b&&"object"==typeof e&&c.hasInArr(e,i)||(h.val(""),c.$parent.addAnaKeyword(i,f,g)))},c.setKeywordsEnter=function(a,b,d,e){c.$parent.setKeywords(b,d,e)},c.addAnaKeyword=function(a,b,d){c.$parent.addAnaKeyword(a,b,d)},c.removeAnaKeyword=function(a,b,d,e){c.$parent.removeAnaKeyword(a,b,d,e)}},link:function(a,b,c){},scope:{keywords:"=",useRecommand:"=",recommandKeywords:"=",kwt:"=",selectTitle:"="}}}),c.directive("welfareButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/welfare_button.html",controller:function(c,d){c.isShowNew=!1,c.watchWelfare=function(a){c.$parent.watchWelfare(a)},c.hasInArr=function(a,b){return c.$parent.hasInArr(a,b)},c.setWelfare=function(){return c.$parent.setWelfare()},c.setKeywords=function(d,e){var f=a.element(document.getElementById(d)),g=$.trim(f.val());g!=b&&""!=g.trim()&&(!g||e!=b&&"object"==typeof e&&c.hasInArr(e,g)||(f.val(""),c.$parent.addWelfare(g)))},c.addWelfare=function(a){c.$parent.addWelfare(a)},c.removeAnaKeyword=function(a,b,d,e){c.$parent.removeAnaKeyword(a,b,d,e)},c.$watch("isShowNew",function(a,b,c){1==a&&window.setTimeout(function(){document.getElementById("JS_welfare_model").focus()},200)})},link:function(a,b,c){},scope:{keywords:"=",recommandKeywords:"="}}}),c.directive("domainButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal" ng-repeat="cat in categorys" data-cat="{- cat.id -}" ng-class="isCatActive( cat )" ng-click="toggleCat( cat , $event )">{- cat.category -}</a>',controller:function(a,b){},link:function(a,b,c){},scope:{categorys:"="}}}),c.directive("preferButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal" ng-repeat="prefer in companyPrefer" ng-class="isPreferActive( prefer )" ng-click="togglePrefer( prefer , $event )">{- prefer.name -}</a>',
controller:function(a,b){},link:function(a,b,c){},scope:{companyPrefer:"="}}}),c.directive("feedLabel",function(){return{restrict:"E",replace:!0,template:'<div><p id="{- forId -}" class="form-label alert-label-ok text-center c607d8b" ng-class="{\'alert-label-error\':isShowErr}"><label for="{- forId -}" class="relative"><span class="sumsun cf46c62" ng-if="star">*</span><span class="info">{- title -}</span></label></p><div class="wrong-tip ng-hide" ng-show="isShowErr"><span ng-bind="errorMsg"></span><span class="arrow"><em></em></span></div></div>',controller:function(b,c){var d=function(c,d){if(b.forId==c&&null!=document.getElementsByClassName(d)){b.$parent.isShowCurrentList&&b.$parent.isShowCurrentList.hasOwnProperty(d)&&(b.$parent.isShowCurrentList[d]=!1);var e=a.element(document.getElementsByClassName(d)[0]);return e.attr("class")&&e.attr("class").match(/right\-nav\-current/i)?(e.removeClass("right-nav-current"),e.addClass("right-nav-current-wrong"),e.addClass("right-nav-state-error")):e.attr("class")&&e.attr("class").match(/right\-nav\-state\-current/i)?(e.removeClass("right-nav-state-current"),e.addClass("right-nav-state-error")):e.addClass("right-nav-state-error"),!1}},e=function(c,d,e,f){if(b.forId==c&&null!=document.getElementsByClassName(d)){b.$parent.isShowCurrentList&&b.$parent.isShowCurrentList.hasOwnProperty(d)&&(b.$parent.isShowCurrentList[d]=!0);var g=a.element(document.getElementsByClassName(d)[0]);return g.attr("class")&&g.attr("class").match(/right\-nav\-current/i)?(g.removeClass("right-nav-current-wrong"),g.removeClass("right-nav-state-error"),g.addClass("right-nav-current")):g.attr("class")&&g.attr("class").match(/right\-nav\-state\-error/i)?(g.removeClass("right-nav-state-error"),g.addClass("right-nav-state-current")):g.addClass("right-nav-state-current"),f!=e&&1==f&&(a.element(document.getElementsByClassName("icon-menu")).removeClass("right-nav-current"),g.addClass("right-nav-current right-nav-state-current")),!1}};b.$watch("isShowErr",function(a,b,c){1==a?(d("label_expect_area_title","icon-menu-city"),d("label_level_title","icon-menu-level"),d("label_job_title_title","icon-menu-job-title"),d("label_job_desc_title","icon-menu-job-desc"),d("label_job_keywords_title","icon-menu-job-keyword"),d("label_skill_keywords_title","icon-menu-skill-keyword"),d("label_salary_title","icon-menu-salary")):(e("label_expect_area_title","icon-menu-city",a,b),e("label_level_title","icon-menu-level",a,b),e("label_job_title_title","icon-menu-job-title",a,b),e("label_job_desc_title","icon-menu-job-desc",a,b),e("label_job_keywords_title","icon-menu-job-keyword",a,b),e("label_skill_keywords_title","icon-menu-skill-keyword",a,b),e("label_salary_title","icon-menu-salary",a,b))})},link:function(a,b,c){},scope:{title:"=",forId:"=",isShowErr:"=",errorMsg:"=",star:"="}}})}(angular);