!function(e,t){var a=e.module("feedApp",["app.config","ui.router","app.utils","app.filter","app.django","validation","validation.rule"]),r=e.injector(["app.django","app.utils"]),l=r.get("id_url");r.get("tmpl");a.controller("feedController",["$scope","$validation","$http",function(a,r,n){a.feedData=e.fromJson(e.element(document.getElementById("JS_container")).attr("data-feedData")),a.feedData.analyze_titles=[],a.feedData.analyze_keywords=[],a.isAddNew=!0,a.loadingMore=!1,a.loadingMoreDone=!1,a.isSyncData=!1,a.isFillAll=!0,a.invalidPanelClassName="";for(var o in a.feedData.feed){a.isAddNew=!1,a.loadingMoreDone=!0;break}a.firstStep=!0,a.feedData.levelDirty=a.feedData.levelCity=!1,a.feedData.titleDirty=a.feedData.descDirty=!1,a.feedData.jobKeywordDirty=a.feedData.keywordDirty=a.feedData.catDirty=a.feedData.salaryDirty=a.preferDirty=a.welfareDirty=!1,a.feedData.submiting=!1,a.isAddNew||(a.feedData.descDirty=!0),a.showViewDesc=!0,a.viewFeed=!1,a.feedData.talent_level=["初级","中级","高级"],a.feedData.feed=e.extend({title:"",job_desc:"",expect_area:[],talent_level:[],analyze_titles:[],keywords:[],job_domain:[],company_prefer:[],job_welfare:[],salary_min:"",salary_max:""},a.feedData.feed),a.feedData.title=a.feedData.feed.title,0==a.feedData.feed.salary_min&&1e6==a.feedData.feed.salary_max&&(a.feedData.feed.salary_min="",a.feedData.feed.salary_max="",a.isNegotiable=!0),a.feedData.feed.categorys=a.feedData.company.categorys||[],a.feedData.min_salary=a.feedData.max_salary=a.feedData.min_num=a.feedData.max_num=0,a.feedData.Databackup=e.copy(a.feedData.feed),a.defaultErrorMsg="此项为必填项！",a.reDescErrorMsg=a.reTitleErrorMsg=a.reLevelErrorMsg=a.reAreaErrorMsg=a.reKeywordsErrorMsg=a.reJobKeywordsErrorMsg=a.reCatErrorMsg=a.reSalaryErrorMsg=a.defaultErrorMsg,a.reDescError=a.reTitleError=a.reLevelError=a.reAreaErrorError=a.reKeywordsError=a.reCatError=a.reJobKeywordsError=a.reSalaryError=!1,a.reCatErrorMsg="",a.reCatError=!1,a.feedData.catDirty=!1;var i=function(e){if(a.feedData.feed[e].length>0)for(var r=0,l=a.feedData.feed[e].length;l>r;r++)(a.feedData.feed[e][r]==t||""==a.feedData.feed[e][r].trim())&&a.feedData.feed[e].splice(r,1)};a.isAddNew||(i("analyze_titles"),i("keywords")),0==a.feedData.feed.analyze_titles.length&&(a.feedData.jobKeywordDirty=!0),0==a.feedData.feed.keywords.length&&(a.feedData.keywordDirty=!0);var d=function(e,r){var l=!1;"string"==typeof e?l=e==t||""==e.trim()?!0:!1:"object"==typeof e&&(l=0==e.length?!0:!1),l?(a.invalidPanelClassName=r,a.isFillAll=!1):a.isFillAll=!0},s=20,f=1e3,c=function(e,t){if("string"!=typeof e)return!1;var a=e;return a.match(/[^\x00-\xff]/i)&&(a=a.replace(/[^\x00-\xff]/g,"**")),a.length<=t?!0:!1};a.$watchCollection("feedData.feed.title",function(e,t){d(e,"#label_job_title_title"),a.reTitleErrorMsg=a.defaultErrorMsg,a.reTitleError=!1}),a.$watchCollection("feedData.feed.job_desc",function(e,t){a.isAddNew?d(e,"#label_job_desc_title"):d(e,"#label_job_desc_title_edit"),a.reDescErrorMsg=a.defaultErrorMsg,a.reDescError=!1,""!=e&&("#label_job_desc_title"==a.invalidPanelClassName&&(a.invalidPanelClassName=""),"#label_job_desc_title_edit"==a.invalidPanelClassName&&(a.invalidPanelClassName="")),c(e,f)||(a.reDescErrorMsg="职位详情最多为500字",a.reDescError=!0,a.isAddNew?a.invalidPanelClassName="#label_job_desc_title":a.invalidPanelClassName="#label_job_desc_title_edit")}),a.$watchCollection("feedData.feed.talent_level",function(e,t){a.isAddNew?d(e,"#label_level_title"):d(e,"#label_level_title_edit"),a.reLevelErrorMsg=a.defaultErrorMsg,a.reLevelError=!1,a.loadingMoreDone&&a.getAnalyzeRelated()}),a.$watchCollection("feedData.feed.expect_area",function(e,t){d(e,"#label_expect_area_title"),a.reAreaErrorMsg=a.defaultErrorMsg,a.reAreaErrorError=!1}),a.$watchCollection("feedData.feed.analyze_titles",function(e,t){d(e,"#label_job_keywords_title"),a.loadingMoreDone&&a.getAnalyzeRelated(),a.reJobKeywordsErrorMsg="此项为必填项，试试点击“解析职位详情”帮你填写拓展名",a.reJobKeywordsError=!1,e.length>0&&($(".icon-menu-job-keyword").addClass("right-nav-state-current"),"#label_job_keywords_title"==a.invalidPanelClassName&&(a.invalidPanelClassName=""),e.length>s&&a.feedData.feed.analyze_titles.splice(e.length-1,1));var r=a.feedData.feed.analyze_titles.join("");c(r,f)||a.feedData.feed.analyze_titles.splice(e.length-1,1)}),a.$watchCollection("feedData.feed.keywords",function(e,t){d(e,"#label_skill_keywords_title"),a.loadingMoreDone&&a.getAnalyzeRelated(),a.reSkillKeywordsErrorMsg=a.defaultErrorMsg,a.reSkillKeywordsError=!1,e.length>0&&($(".icon-menu-skill-keyword").addClass("right-nav-state-current"),"#label_skill_keywords_title"==a.invalidPanelClassName&&(a.invalidPanelClassName=""),e.length>s&&a.feedData.feed.keywords.splice(e.length-1,1));var r=a.feedData.feed.keywords.join("");c(r,f)||a.feedData.feed.keywords.splice(e.length-1,1)}),a.$watchCollection("feedData.feed.job_domain",function(e,t){a.loadingMoreDone&&a.getAnalyzeRelated(),a.reCatErrorMsg=a.defaultErrorMsg,a.reCatError=!1}),a.$watchCollection("feedData.feed.company_prefer",function(e,t){a.loadingMoreDone&&a.getAnalyzeRelated(),a.rePreferError=!1,a.rePreferErrorMsg=a.defaultErrorMsg}),a.$watchCollection("feedData.feed.job_welfare",function(e,t){a.reWelfareError=!1,a.reWelfareErrorMsg=a.defaultErrorMsg}),a.salaryMsgs=["最低薪资为必填项！","请输入大于1000小于1000000的薪资","最高薪资应大于最低薪资","最高薪资不能大于最低薪资的三倍","最高薪资为必填项！"],a.$watchCollection("feedData.feed.salary_min",function(e,t){if(e!=t){var r=parseInt(a.feedData.feed.salary_max),l="",n=!1;e=parseInt(e),e?1e3>e||e>1e6?(l=a.salaryMsgs[1],n=!0):r&&e>r?(l=a.salaryMsgs[2],n=!0):r&&r/e>3?(n=!0,l=a.salaryMsgs[3]):r?(1e3>r||r>1e6)&&(l=a.salaryMsgs[1],n=!0):(l=a.salaryMsgs[4],n=!0):(l=a.salaryMsgs[0],n=!0),a.reSalaryError=n,a.reSalaryErrorMsg=l}}),a.$watchCollection("feedData.feed.salary_max",function(e,t){if(e!=t){var r=parseInt(a.feedData.feed.salary_min),l="",n=!1;e=parseInt(e),e?1e3>e||e>1e6?(l=a.salaryMsgs[1],n=!0):r&&r>e?(l=a.salaryMsgs[2],n=!0):r&&e/r>3?(l=a.salaryMsgs[3],n=!0):r?(1e3>r||r>1e6)&&(l=a.salaryMsgs[1],n=!0):(l=a.salaryMsgs[0],n=!0):(l=a.salaryMsgs[4],n=!0),a.reSalaryError=n,a.reSalaryErrorMsg=l}}),a.isShowList={},a.isShowCurrentList={};var _=function(t,a){var r=e.element(t.currentTarget),l=e.element(document.getElementsByClassName("icon-menu"));l.removeClass("right-nav-current"),r.addClass("right-nav-current"),r.attr("class").match(/right\-nav\-state\-error/i)&&(l.removeClass("right-nav-current-wrong"),r.addClass("right-nav-current-wrong"))},m=function(a){var r=e.element(u(a)).offset().top;r!=t&&"number"==typeof r&&e.element(window).scrollTop(r)},u=function(a){if(a!=t&&"string"==typeof a){if(a.match(/^#(.+)$/i)){var r=RegExp.$1;return null!=document.getElementById(r)?e.element(document.getElementById(r))[0]:null}return null!=document.getElementsByClassName(a)?e.element(document.getElementsByClassName(a)[0])[0]:null}return null};a.moveToPanel=function(e,t){a.isAddNew?"city"==t?_(e,"label_expect_area_title"):"level"==t?_(e,"id"):"job_title"==t?_(e,"id"):"job_desc"==t&&_(e,"id"):"city_edit"==t?_(e,"id"):"level_edit"==t?_(e,"id"):"job_title_edit"==t?_(e,"id"):"job_desc_edit"==t&&_(e,"id"),"keyword"==t?_(e,"id"):"job_keyword"==t?_(e,"id"):"skill_keyword"==t?_(e,"id"):"domain"==t?_(e,"id"):"prefer"==t?_(e,"id"):"welfare"==t?_(e,"id"):"salary"==t&&_(e,"id")},a.chkPanel=function(e){if(a.isAddNew){if("city"==e&&null!=document.getElementById("JS_city_addnew"))return a.isShowList.city=!0,!0;if("level"==e&&null!=document.getElementById("JS_level_edit"))return a.isShowList.level=!0,!0;if("job_title"==e&&null!=document.getElementById("JS_job_title_box"))return a.isShowList.job_title=!0,!0;if("job_desc"==e&&null!=document.getElementById("JS_job_desc_box"))return a.isShowList.job_desc=!0,!0}else{if("city_edit"==e)return!0;if("level_edit"==e&&null!=document.getElementById("JS_level_edit"))return a.isShowList.level_edit=!0,!0;if("job_title_edit"==e)return!0;if("job_desc_edit"==e&&null!=document.getElementById("JS_job_desc_edit_box"))return a.isShowList.job_desc_edit=!0,!0}return"keyword"==e&&null!=document.getElementById("JS_skill_keywords_box")?(a.isShowList.keyword=!0,!0):"job_keyword"==e&&null!=document.getElementById("JS_job_keywords_box")?(a.isShowList.job_keyword=!0,!0):"skill_keyword"==e&&null!=document.getElementById("JS_skill_keywords_box")?(a.isShowList.skill_keyword=!0,!0):"domain"==e&&null!=document.getElementById("JS_categorys_box")?(a.isShowList.domain=!0,!0):"prefer"==e&&null!=document.getElementById("JS_prefer_box")?(a.isShowList.prefer=!0,!0):"welfare"==e&&null!=document.getElementById("JS_welfare_box")?(a.isShowList.welfare=!0,!0):"salary"==e&&null!=document.getElementById("JS_salary_box")?(a.isShowList.salary=!0,!0):!1},a.isPrimaryLevel=function(){return!1},a.toLowSalary=function(){return a.feedData.feed.salary_min&&a.feedData.min_salary?a.feedData.feed.salary_min<a.feedData.min_salary:!1},a.formatArrayParam=function(e,t){var a=[];if(!e||!e.length)return"";for(var r=0,l=e.length;l>r;r++)t?a.push(e[r][t]):a.push(e[r]);return a.join(",")},a.concat=function(e,t){return e&&e.length?t?e.join(t):e.join(","):""},a.returnIdArray=function(e){var t=[];if(!e||!e.length)return"";for(var a=0,r=e.length;r>a;a++){var l=e[a].id;l&&t.push(l)}return t},a.hasInArr=function(e,t){for(var a=0,r=e.length;r>a;a++)if(e[a]==t)return!0;return!1},a.toggleCity=function(t,r){a.feedData.levelCity=!0;var l=a.feedData.feed.expect_area,n=e.element(r.target),o=n.hasClass("active"),l=a.feedData.feed.expect_area||[];if(o){for(var i=0,d=l.length;d>i;i++)if(l[i]==t){a.feedData.feed.expect_area.splice(i,1);break}}else a.feedData.feed.expect_area.push(n.text());n.toggleClass("active")},a.isCityActive=function(e){var t=a.feedData.feed.expect_area;if(!t||!t.length)return!1;for(var r=0,l=t.length;l>r;r++)if(t[r]==e)return"active";return!1},a.toggleLevel=function(t,r){a.feedData.levelDirty=!0;var l=a.feedData.feed.talent_level,n=e.element(r.target),o=(n.attr("data-id"),n.hasClass("active"));if(l=l||[],o){for(var i=0,d=l.length;d>i;i++)if(l[i]==t){a.feedData.feed.talent_level.splice(i,1);break}}else a.feedData.feed.talent_level.push(t);n.toggleClass("active")},a.isLevelActive=function(e){var t=a.feedData.feed.talent_level;if(!t||!t.length)return!1;for(var r=0,l=t.length;l>r;r++)if(t[r]==e)return"active";return!1};var y=function(){var t=e.element(document.getElementsByClassName("job_desc_parse"));t.text("解析职位详情"),t.removeAttr("disabled")},g=function(e,t,r,l){if(a.feedData[e].length>0)for(var n=0;r>n&&a.feedData[e].length>0;n++){var o=a.feedData[e].shift();p(a.feedData.feed[t],o,l)}};a.loadAnalyzeData=function(t){a.feedData.analyze_keywords=t.analyze_keywords||[],a.isAddNew?g("analyze_keywords","keywords",4,"keywords"):0==a.feedData.feed.keywords.length&&g("analyze_keywords","keywords",4,"keywords"),a.feedData.analyze_titles=t.analyze_titles||[],a.isAddNew?g("analyze_titles","analyze_titles",8,"analyze_titles"):0==a.feedData.feed.analyze_titles.length&&g("analyze_titles","analyze_titles",8,"analyze_titles"),a.feedData.analyze_job_domain=t.analyze_job_domain||[],a.feedData.feed.analyze_job_domain=t.analyze_job_domain||[],a.feedData.feed_extra_info=t.feed_extra_info||{},a.feedData.feed=e.extend(a.feedData.feed,a.feedData.feed_extra_info),y()},a.toggleTip=function(){e.element(document.getElementById("JS_slideup_btn")).toggleClass("active"),$("#JS_on_tip,#JS_off_tip").slideToggle()},a.setKeywords=function(t,r,l){var n=e.element(document.getElementById(t)),o=$.trim(n.val());n.val(""),a.feedData.feed[r].length>=20||o&&!a.hasInArr(a.feedData.feed[r],o)&&a.addAnaKeyword(o,l,r)};var v=function(e,a,r){if("string"!=typeof e)return"";var l=function(e){var a=0,r=0,l=0,n=0;if(e!=t&&"string"==typeof e){if(e=e.trim(),""==e)return 0;for(n=e.length,a=0;n>a;a++)l=e.charCodeAt(a),r+=127>l?1:2;return r}return 0},n=function(e,t,a){var r=0,n=0,o=0,i="",d=e.length,s=l(e);for(0>t&&(t=s+t),1>a&&(a=s+a),r=0;d>r&&!(n>=t);r++){var o=e.charCodeAt(r);n+=127>o?1:2}for(r=r;d>r;r++){var o=e.charCodeAt(r);if(n+=127>o?1:2,i+=e.charAt(r),n>=a)break}return i};return n(e,a,r)},p=function(e,r,l){if("string"!=typeof r)return!1;var n=r.trim(),o=[],i=function(e,t){for(var a=0,r=e.length;r>a;a++)if(e[a]==t){e.splice(a,1);break}},d=function(a,r){r&&!a.hasInArr(e,r)&&""!=r.trim()&&c(r,50)&&(l!=t&&("analyze_titles"==l||"keywords"==l)&&a.feedData[l]!=t&&i(a.feedData[l],r),e.push(r.trim()))};if(n.match(/([ ,，])/i)){var s=RegExp.$1;o=r.trim().split(s);for(var f=0,_=o.length;_>f;f++)d(a,o[f])}else d(a,n)};a.addAnaKeyword=function(e,t,r){a.feedData[t]=!0,"string"==typeof e&&p(a.feedData.feed[r],e,r),"analyze_titles"==r?document.getElementById("JS_job_keyword_model").focus():"keywords"==r&&document.getElementById("JS_keyword_model").focus()},a.removeAnaKeyword=function(e,r,l,n){if($(l.target).closest("#JS_skill_keywords_box").length&&(a.feedData.keywordDirty=!0),$(l.target).closest("#JS_job_keywords_box").length&&(a.feedData.jobKeywordDirty=!0),$(l.target).closest("#JS_welfare_box").length&&(a.feedData.welfareDirty=!1),e&&r&&r.length){for(var o=0,i=r.length;i>o;o++)if(r[o]==e){r.splice(o,1),n==t||"string"!=typeof n||a.feedData[n]==t||a.hasInArr(a.feedData[n],e)||a.feedData[n].push(e);break}l.stopPropagation()}};var w=function(e,t){var a=u(e);c(a.value,t)||(a.value=v(a.value,0,t))};a.watchKeyword=function(e,t,r,l,n){w(n,50),a.canSave(e)&&a.setKeywords(t,r,l)},a.toggleCat=function(t,r){a.feedData.catDirty=!1;var l=a.feedData.feed.job_domain,n=e.element(r.target),o=t.id,i=t.category,d=n.hasClass("active"),l=a.feedData.feed.job_domain||[];if(d){for(var s=0,f=l.length;f>s;s++)if(l[s].id==o){a.feedData.feed.job_domain.splice(s,1);break}}else{if(l.length>=3)return;a.feedData.feed.job_domain.push({id:o,category:i})}n.toggleClass("active")},a.isCatActive=function(e){var t=a.feedData.feed.job_domain;if(!t||!t.length)return!1;for(var r=0,l=t.length;l>r;r++)if(t[r].id==e.id)return"active";return!1},a.togglePrefer=function(t,r){a.feedData.preferDirty=!1;var l=a.feedData.feed.company_prefer,n=e.element(r.target),o=t.id,i=t.name,d=n.hasClass("active"),l=a.feedData.feed.company_prefer||[];if(d){for(var s=0,f=l.length;f>s;s++)if(l[s].id==o){a.feedData.feed.company_prefer=[];break}}else a.feedData.feed.company_prefer=[{id:o,category:i}];n.toggleClass("active")},a.isPreferActive=function(e){var t=a.feedData.feed.company_prefer;if(!t||!t.length)return!1;for(var r=0,l=t.length;l>r;r++)if(t[r].id==e.id)return"active";return!1},a.canSave=function(e){var t=e.target,a=t.value,r=e.keyCode;return 188==r?(t.value=a.substring(0,a.length-1),!0):!1},a.setWelfare=function(){var t=e.element(document.getElementById("JS_welfare_model")),r=$.trim(t.val());t.val(""),a.feedData.feed.job_welfare.length>=20||r&&!a.hasInArr(a.feedData.feed.job_welfare,r)&&a.addWelfare(r)},a.addWelfare=function(e){a.feedData.welfareDirty=!1,"string"==typeof e&&p(a.feedData.feed.job_welfare,e)},a.watchWelfare=function(e){w("#JS_welfare_model",50),a.canSave(e)&&a.setWelfare()},a.filterJobDomain=function(){for(var e=a.feedData.feed.job_domain||[],t=a.feedData.company.categorys||[],r=a.feedData.analyze_job_domain||[],l=t.concat(r),n=[],o=0,i=e.length;i>o;o++)for(var d=e[o].id,s=0,f=l.length;f>s;s++)if(jId=l[s].id,d==jId){n.push(e[o]);break}a.feedData.feed.job_domain=n};var b=function(r,l){var n=!1;if(a.feedData.feed[l]!=t&&("string"==typeof a.feedData.feed[l]&&""!=a.feedData.feed[l].trim()?n=!0:"object"==typeof a.feedData.feed[l]&&a.feedData.feed[l].length>0&&(n=!0)),null==document.getElementById(r)||n){var o=!1;return c(a.feedData.feed.job_desc,f)||(o=!0),o&&r.match(/^JS_job_desc_box/i)?(a.isAddNew?(m("#label_job_desc_title"),a.feedData.descDirty=!0):m("#label_job_desc_title_edit"),!1):!0}if(r.match(/^JS_level_edit$/i))a.isAddNew?(m("#label_level_title"),a.feedData.levelDirty=!0):m("#label_level_title_edit");else if(r.match(/^JS_job_desc_box/i))a.isAddNew?(m("#label_job_desc_title"),a.feedData.descDirty=!0):m("#JS_job_desc_edit_box");else if(r.match(/^JS_city_addnew/i))m("#label_expect_area_title"),a.feedData.levelCity=!0;else if(r.match(/^JS_job_title_box/i))m("#label_job_title_title"),a.feedData.titleDirty=!0;else{var i=e.element(document.getElementById(r)).offset().top;e.element(window).scrollTop(i)}return!1};a.jobDescParse=function(t,r){return 0==b("JS_city_addnew","expect_area")?!1:0==b("JS_level_edit","talent_level")?!1:0==b("JS_job_title_box","title")?!1:0==b("JS_job_desc_box","job_desc")?!1:(e.element(t.currentTarget).html('<img src="/static/b_common/img/loading.gif" alt="loading">'),e.element(t.currentTarget).attr("disabled",!0),void a.form.next(r))},a.form={next:function(l){if(a.feedData.titleDirty=a.feedData.descDirty=!0,null!=l.$error.maxlength&&null!=l.$error.job_desc&&l.$error.maxlength!=t&&l.$error.job_desc!=t)return document.getElementById("job_desc_message").style.display="block",document.getElementById("job_desc_message").getElementsByClassName("validation-invalid")[0].innerHTML="职位详情请控制在1000字以内！",y(),!1;a.feedData.levelDirty=a.feedData.levelCity=!0;var n=0,o=r.validate(l);return a.feedData.feed.title?a.feedData.feed.talent_level.length?a.feedData.feed.expect_area.length?a.feedData.feed.job_desc?(a.loadingMore=!0,void o.success(function(){a.loadingMoreDone=!0,a.loadingMore=!1,a.next()}).error(function(){})):(l.job_desc.$invalid=!0,n=a.isAddNew?e.element(document.getElementById("JS_job_desc_addnew")).closest(".form-panel").offset().top:e.element(document.getElementById("JS_job_desc_edit")).closest(".form-panel").offset().top,e.element(window).scrollTop(n),y(),!1):(a.isAddNew&&(n=e.element(document.getElementById("JS_city_addnew")).offset().top),e.element(window).scrollTop(n),y(),!1):(n=a.isAddNew?e.element(document.getElementById("JS_level_addnew")).offset().top:e.element(document.getElementById("JS_level_edit")).offset().top,e.element(window).scrollTop(n),y(),!1):(l.title.$invalid=!0,n=e.element(document.getElementById("JS_job_title")).closest(".form-panel").offset().top,e.element(window).scrollTop(n),y(),!1)},submit:function(t){if(!a.isAddNew)if(a.isFillAll);else if(""!=a.invalidPanelClassName)return m(a.invalidPanelClassName),!1;a.filterJobDomain(),a.feedData.keywordDirty=a.feedData.salaryDirty=!0;var l=function(t){var a=e.element(document.getElementById(t)).offset().top;e.element(window).scrollTop(a)};if(a.isAddNew){if(!a.feedData.feed.expect_area.length)return l("label_expect_area_title"),!1;if(!a.feedData.feed.talent_level.length)return l("JS_level_edit"),!1;if(""==a.feedData.feed.title)return l("label_job_title_title"),!1;if(""==a.feedData.feed.job_desc)return l("label_job_desc_title"),!1}if(!a.feedData.feed.analyze_titles.length)return l("JS_job_keywords_box"),!1;if(!a.feedData.feed.keywords.length)return l("JS_skill_keywords_box"),!1;var n=0,o=r.validate(t);return a.isNegotiable||a.feedData.feed.salary_min&&a.feedData.feed.salary_max||(a.reSalaryError=!0),a.isNegotiable||(a.feedData.feed.salary_min||(t.salary_min.$invalid=!0),a.feedData.feed.salary_max||(t.salary_max.$invalid=!0)),a.isNegotiable||a.feedData.feed.salary_min&&a.feedData.feed.salary_max?!a.isNegotiable&&a.reSalaryError?(n=e.element(document.getElementById("JS_salary_box")).offset().top,e.element(window).scrollTop(n),!1):void o.success(function(){a.submit()}).error(function(){console.log("submit error")}):(a.reSalaryError=!0,a.reSalaryErrorMsg=a.defaultErrorMsg,a.feedData.feed.salary_min?a.feedData.feed.salary_max||$('[name="salary_max"]').val("").focus():$('[name="salary_min"]').val("").focus(),n=e.element(document.getElementById("JS_salary_box")).offset().top,e.element(window).scrollTop(n),!1)}},a.previous=function(){a.firstStep=!0},a.deleteFeed=function(e){$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>确定删除该定制吗？</p><p class="text-center cf46c62" style="font-size:14px;">删除后不可恢复</p>',function(){location.href=l("/feed/delete/",e)})},a.next=function(){a.firstStep=!0,e.element(document.getElementById("JS_job_keyword_model")).focus(),n.post("/special_feed/analyze_jd/",JSON.stringify({title:a.feedData.feed.title,job_desc:a.feedData.feed.job_desc,expect_area:a.concat(a.feedData.feed.expect_area),talent_level:a.formatArrayParam(a.feedData.feed.talent_level)})).success(function(e){e&&e.data?a.loadAnalyzeData(e.data):a.loadAnalyzeData({})}).error(function(){a.loadAnalyzeData({})}),setTimeout(function(){var t=e.element(document.getElementById("JS_job_keywords_box")).offset().top;e.element(window).scrollTop(t)},500),a.feedData.Databackup=e.extend(a.feedData.Databackup,{title:a.feedData.feed.title,job_desc:a.feedData.feed.job_desc,expect_area:a.feedData.feed.expect_area,talent_level:a.feedData.feed.talent_level})},a.formatSubmitData=function(){var t=e.extend({},a.feedData.feed);return t.job_domain=a.returnIdArray(t.job_domain),t.company_prefer=a.returnIdArray(t.company_prefer),t.job_welfare=t.job_welfare.join(","),t.keywords=t.keywords.join(","),t.analyze_titles=t.analyze_titles.join(","),t.talent_level=t.talent_level.join(","),t.expect_area=a.concat(t.expect_area),t.block_titles=a.feedData.analyze_titles.join(","),t.block_keywords=a.feedData.analyze_keywords.join(","),t.__=(new Date).getTime(),a.isNegotiable&&(t.salary_min=0,t.salary_max=1e6),t},a.submit=function(){var t=function(t){var r="",l={salary_max:{variable:"reSalaryError",msg:"reSalaryErrorMsg",id:"label_salary_title"},salary_min:{variable:"reSalaryError",msg:"reSalaryErrorMsg",id:"label_salary_title"},job_desc:{variable:"reDescError",msg:"reDescErrorMsg",id:"label_job_desc_title"},talent_level:{variable:"reLevelError",msg:"reLevelErrorMsg",id:"label_level_title"},title:{variable:"reTitleError",msg:"reTitleErrorMsg",id:"label_job_title_title"},expect_area:{variable:"reAreaErrorError",msg:"reAreaErrorMsg",id:"label_expect_area_title"},keywords:{variable:"reKeywordsError",msg:"reKeywordsErrorMsg",id:"label_skill_keywords_title"},analyze_titles:{variable:"reJobKeywordsError",msg:"reJobKeywordsErrorMsg",id:"label_job_keywords_title"}};for(var n in t){var o=l[n];if(o){if(o.message)$(o.message).text(t[n][0]).show();else if(a[l[n].variable]=!0,a[l[n].msg]=t[n][0],null!=document.getElementById(l[n].id)){var i=e.element(document.getElementById(l[n].id)).offset().top;e.element(window).scrollTop(i)}}else r+=t[n][0]+"\r\n"}r&&$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>'+r+"</p>")},r=function(){a.feedData.submiting=!0,n.post("/special_feed/submit_feed/",JSON.stringify(a.formatSubmitData())).success(function(e){e&&"ok"==e.status?e.show_mission?($("#JS_username").html(e.username),$("#JS_mission_time").html(e.mission_time),$(".modal-backdrop-tip,.modal-tip").show(),$(".modal-dialog-tip").css({marginTop:($(window).height()-$(".modal-dialog-tip").height())/2+"px"})):e.redirect_url?e.redirect_url.match(/^\/feed$/i)?location.href="/special_feed/page/#/feed_resume/"+e.feed_id+"/":location.href=e.redirect_url:$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>保存成功！</p>'):e.errors?t(e.errors):$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>新增定制失败，可能是你的套餐设置问题，请联系我们解决！</p>'),a.feedData.submiting=!1}).error(function(){$.alert('<p class="f16 text-center"><i class="i-l-notice"></i>新增定制失败，可能是你的套餐设置问题，请联系我们解决！</p>'),a.feedData.submiting=!1})};if(a.isAddNew)if(a.isFillAll){var l='<div style="margin: 0 auto;width: 400px;"><div class="f16 text-center"><i class="i-l-notice"></i>以下内容提交后不可修改</div><div class="f16 text-left" style="padding: 10px 0 0 135px;">职位名：<span class="cf46c62">'+a.feedData.feed.title+'</span></div><div class="f16 text-left" style="padding: 10px 0 0 135px;">工作地：<span class="cf46c62">'+a.concat(a.feedData.feed.expect_area)+"</span></div></div>";$.alert(l,"","",{handlers:[{title:"返回修改",eventType:"click",className:"button button-normal w158 f16",event:function(){$._LayerOut.close()}},{title:"确定",eventType:"click",className:"button button-primary w158 f16",event:function(){r(),$._LayerOut.close()}}]})}else""!=a.invalidPanelClassName&&m(a.invalidPanelClassName);else""!=a.invalidPanelClassName?m(a.invalidPanelClassName):r()},a.toggleEnvelope=function(){a.envelope=!0},a.getAnalyzeRelated=function(){a.isSyncData=!0,window.__httpAna&&window.__httpAna.abort(),window.__httpAna=$.ajax({type:"POST",url:"/special_feed/analyze_related/",data:JSON.stringify(a.formatSubmitData()),success:function(e){e&&"ok"==e.status&&e.data&&a.synData(e.data)}})},a.synData=function(t){a.animateNumber(t),e.element(document.getElementById("JS_slideup_btn")).addClass("active"),$("#JS_off_tip").slideUp(),$("#JS_on_tip").slideDown(),a.feedData.min_salary=t.salary.min,a.feedData.max_salary=t.salary.max,a.feedData.min_num=t.num.min,a.feedData.max_num=t.num.max},a.animateNumber=function(e){var r=50,l=a.feedData.min_salary,n=a.feedData.max_salary,o=a.feedData.min_num,i=a.feedData.max_num,d=$("#JS_salary_min"),s=$("#JS_salary_max"),f=$("#JS_num_min"),c=$("#JS_num_max"),_=(e.salary.min-l)/r,m=(e.salary.max-n)/r,u=(e.num.min-o)/r,y=(e.num.max-i)/r,g=1,v=function(e,a,r,l){e=e||0,a=isNaN(a=Math.abs(a))?2:a,r=r!==t?r:"",l=l||",";var n=0>e?"-":"",o=parseInt(e=Math.abs(+e||0).toFixed(a),10)+"",i=(i=o.length)>3?i%3:0;return r+n+(i?o.substr(0,i)+l:"")+o.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+l)},p=function(){var e=v(parseInt(_*g+l)),t=v(parseInt(m*g+n)),a=v(parseInt(u*g+o)),w=v(parseInt(y*g+i));d.text(e),s.text(t),f.text(a),c.text(w),g++,r>=g&&setTimeout(function(){p()},30)};p()},a.synSalary=function(){a.isNegotiable=!1,a.feedData.feed.salary_min=a.feedData.min_salary,a.feedData.feed.salary_max=a.feedData.max_salary,$('[name="salary_min"]').val(a.feedData.min_salary),$('[name="salary_max"]').val(a.feedData.max_salary),$(".icon-menu-salary").addClass("right-nav-state-current"),m("#label_salary_title")},a.toggleView=function(){a.viewFeed=!a.viewFeed,a.refresh()},a.toggleDesc=function(){a.showViewDesc=!a.showViewDesc,a.refresh()},a.refresh=function(){a.viewFeed&&setTimeout(function(){$(".modal-dialog-view").css({marginTop:($(window).height()-$(".modal-dialog-view").height())/2+"px"})},0)}}]),a.directive("ngEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter)}),t.preventDefault())})}}),a.directive("locationButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal f16" data-id="{- city -}" ng-class="isCityActive( city )" ng-click="toggleCity( city , $event )" ng-repeat="city in expectArea">{- city -}</a>',controller:["$scope","$element",function(e,t){}],link:function(e,t,a){},scope:{expectArea:"="}}}),a.directive("talentButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal f16" data-level="{- level -}" ng-class="isLevelActive( level )" ng-click="toggleLevel( level , $event )" ng-repeat="level in talentLevel">{- level -}</a>',controller:["$scope","$element",function(e,t){}],link:function(e,t,a){},scope:{talentLevel:"="}}}),a.directive("detailTextarea",function(){return{restrict:"E",replace:!0,template:'<textarea name="job_desc" id="JS_job_desc_addnew" rows="10" class="textarea full" ng-model="jobDescInfo" validator="jobDesc" ng-maxlength="1000" message-id="job_desc_message">{- jobDescInfo -}</textarea>',controller:["$scope","$element",function(e,t){}],link:function(e,t,a){},scope:{jobDescInfo:"="}}}),a.filter("maxlen",function(){var e=function(e,a,r){if("string"!=typeof e)return"";var l=function(e){var a=0,r=0,l=0,n=0;if(e!=t&&"string"==typeof e){if(e=e.trim(),""==e)return 0;for(n=e.length,a=0;n>a;a++)l=e.charCodeAt(a),r+=127>l?1:2;return r}return 0},n=function(e,t,a){var r=0,n=0,o=0,i="",d=e.length,s=l(e);for(0>t&&(t=s+t),1>a&&(a=s+a),r=0;d>r&&!(n>=t);r++){var o=e.charCodeAt(r);n+=127>o?1:2}for(r=r;d>r;r++){var o=e.charCodeAt(r);if(n+=127>o?1:2,i+=e.charAt(r),n>=a)break}return i};return n(e,a,r)},a=function(e,t){if("string"!=typeof e)return!1;var a=e;return a.match(/[^\x00-\xff]/i)&&(a=a.replace(/[^\x00-\xff]/g,"**")),a.length<=t?!0:!1};return function(t){var r=16;return t.match(/[^\x00-\xff]/i)||(r=12),a(t,r)?t:e(t,0,r)+"..."}}),a.directive("customizedTitleButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/customized_title_button.html",controller:["$scope","$element",function(a,r){a.isShowNew=!1,a.watchKeyword=function(e,t,r,l,n){a.$parent.watchKeyword(e,t,r,l,n)},a.hasInArr=function(e,t){return a.$parent.hasInArr(e,t)},a.setKeywords=function(r,l,n,o){var i=e.element(document.getElementById(r)),d=$.trim(i.val());d!=t&&""!=d.trim()&&(!d||l!=t&&"object"==typeof l&&a.hasInArr(l,d)||(i.val(""),a.$parent.addAnaKeyword(d,n,o)))},a.setKeywordsEnter=function(e,t,r,l){a.$parent.setKeywords(t,r,l)},a.addAnaKeyword=function(e,t,r){a.$parent.addAnaKeyword(e,t,r)},a.removeAnaKeyword=function(e,t,r,l){a.$parent.removeAnaKeyword(e,t,r,l)},a.$watch("isShowNew",function(e,t,a){1==e&&window.setTimeout(function(){document.getElementById("JS_job_keyword_model").focus()},200)})}],link:function(e,t,a){},scope:{keywords:"=",useRecommand:"=",recommandKeywords:"=",kwt:"=",selectTitle:"="}}}),a.directive("customizedButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/customized_button.html",controller:["$scope","$element",function(a,r){a.isShowNew=!1,a.watchKeyword=function(e,t,r,l,n){a.$parent.watchKeyword(e,t,r,l,n)},a.hasInArr=function(e,t){return a.$parent.hasInArr(e,t)},a.setKeywords=function(r,l,n,o){var i=e.element(document.getElementById(r)),d=$.trim(i.val());d!=t&&""!=d.trim()&&(!d||l!=t&&"object"==typeof l&&a.hasInArr(l,d)||(i.val(""),a.$parent.addAnaKeyword(d,n,o)))},a.setKeywordsEnter=function(e,t,r,l){a.$parent.setKeywords(t,r,l)},a.addAnaKeyword=function(e,t,r){a.$parent.addAnaKeyword(e,t,r)},a.removeAnaKeyword=function(e,t,r,l){a.$parent.removeAnaKeyword(e,t,r,l)}}],link:function(e,t,a){},scope:{keywords:"=",useRecommand:"=",recommandKeywords:"=",kwt:"=",selectTitle:"="}}}),a.directive("welfareButton",function(){return{restrict:"E",replace:!0,templateUrl:"/static/special_feed/welfare_button.html",controller:["$scope","$element",function(a,r){a.isShowNew=!1,a.watchWelfare=function(e){a.$parent.watchWelfare(e)},a.hasInArr=function(e,t){return a.$parent.hasInArr(e,t)},a.setWelfare=function(){return a.$parent.setWelfare()},a.setKeywords=function(r,l){var n=e.element(document.getElementById(r)),o=$.trim(n.val());o!=t&&""!=o.trim()&&(!o||l!=t&&"object"==typeof l&&a.hasInArr(l,o)||(n.val(""),a.$parent.addWelfare(o)))},a.addWelfare=function(e){a.$parent.addWelfare(e)},a.removeAnaKeyword=function(e,t,r,l){a.$parent.removeAnaKeyword(e,t,r,l)},a.$watch("isShowNew",function(e,t,a){1==e&&window.setTimeout(function(){document.getElementById("JS_welfare_model").focus()},200)})}],link:function(e,t,a){},scope:{keywords:"=",recommandKeywords:"="}}}),a.directive("domainButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal" ng-repeat="cat in categorys" data-cat="{- cat.id -}" ng-class="isCatActive( cat )" ng-click="toggleCat( cat , $event )">{- cat.category -}</a>',controller:["$scope","$element",function(e,t){}],link:function(e,t,a){},scope:{categorys:"="}}}),a.directive("preferButton",function(){return{restrict:"E",replace:!0,template:'<a class="button button-normal" ng-repeat="prefer in companyPrefer" ng-class="isPreferActive( prefer )" ng-click="togglePrefer( prefer , $event )">{- prefer.name -}</a>',controller:["$scope","$element",function(e,t){}],link:function(e,t,a){},scope:{companyPrefer:"="}}}),a.directive("feedLabel",function(){return{restrict:"E",replace:!0,template:'<div><p id="{- forId -}" class="form-label alert-label-ok text-center c607d8b" ng-class="{\'alert-label-error\':isShowErr}"><label for="{- forId -}" class="relative"><span class="sumsun cf46c62" ng-if="star">*</span><span class="info">{- title -}</span></label></p><div class="wrong-tip ng-hide" ng-show="isShowErr"><span ng-bind="errorMsg"></span><span class="arrow"><em></em></span></div></div>',controller:["$scope","$element",function(t,a){var r=function(a,r){if(t.forId==a&&null!=document.getElementsByClassName(r)){t.$parent.isShowCurrentList&&t.$parent.isShowCurrentList.hasOwnProperty(r)&&(t.$parent.isShowCurrentList[r]=!1);var l=e.element(document.getElementsByClassName(r)[0]);
return l.attr("class")&&l.attr("class").match(/right\-nav\-current/i)?(l.removeClass("right-nav-current"),l.addClass("right-nav-current-wrong"),l.addClass("right-nav-state-error")):l.attr("class")&&l.attr("class").match(/right\-nav\-state\-current/i)?(l.removeClass("right-nav-state-current"),l.addClass("right-nav-state-error")):l.addClass("right-nav-state-error"),!1}},l=function(a,r,l,n){if(t.forId==a&&null!=document.getElementsByClassName(r)){t.$parent.isShowCurrentList&&t.$parent.isShowCurrentList.hasOwnProperty(r)&&(t.$parent.isShowCurrentList[r]=!0);var o=e.element(document.getElementsByClassName(r)[0]);return o.attr("class")&&o.attr("class").match(/right\-nav\-current/i)?(o.removeClass("right-nav-current-wrong"),o.removeClass("right-nav-state-error"),o.addClass("right-nav-current")):o.attr("class")&&o.attr("class").match(/right\-nav\-state\-error/i)?(o.removeClass("right-nav-state-error"),o.addClass("right-nav-state-current")):o.addClass("right-nav-state-current"),n!=l&&1==n&&(e.element(document.getElementsByClassName("icon-menu")).removeClass("right-nav-current"),o.addClass("right-nav-current right-nav-state-current")),!1}};t.$watch("isShowErr",function(e,t,a){1==e?(r("label_expect_area_title","icon-menu-city"),r("label_level_title","icon-menu-level"),r("label_job_title_title","icon-menu-job-title"),r("label_job_desc_title","icon-menu-job-desc"),r("label_job_keywords_title","icon-menu-job-keyword"),r("label_skill_keywords_title","icon-menu-skill-keyword"),r("label_salary_title","icon-menu-salary")):(l("label_expect_area_title","icon-menu-city",e,t),l("label_level_title","icon-menu-level",e,t),l("label_job_title_title","icon-menu-job-title",e,t),l("label_job_desc_title","icon-menu-job-desc",e,t),l("label_job_keywords_title","icon-menu-job-keyword",e,t),l("label_skill_keywords_title","icon-menu-skill-keyword",e,t),l("label_salary_title","icon-menu-salary",e,t))})}],link:function(e,t,a){},scope:{title:"=",forId:"=",isShowErr:"=",errorMsg:"=",star:"="}}})}(angular);