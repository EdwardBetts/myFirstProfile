!function(e){var o=angular.module("app.user_mode",["app.config","ui.router","app.django","app.utils","app.filter"]),r=angular.injector(["app.django","app.utils"]),t=r.get("tmpl"),s=(r.get("static_url"),r.get("mockTest"),r.get("mockTestWithCoin")),n=(r.get("confirmBox"),r.get("alertBox"),r.get("getModeData")),d=(r.get("postModeData"),r.get("pbFunc")),c=r.get("orderPay");o.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,o,r){var s="/";o.otherwise(s),e.state("userMode",{url:"/",templateUrl:t("users/user_mode_no_noworry.html"),controller:"userMode"}),e.state("userModeDiy",{url:"/usermode_diy/",templateUrl:t("users/user_mode_diy.html"),controller:"userModeDiy"}),e.state("userModeDiyPay",{url:"/usermode_diy_pay/",templateUrl:t("users/user_mode_diy_pay.html"),controller:"userModeDiyPay"}),e.state("userModeDiyPayOk",{url:"/usermode_diy_pay_ok/",templateUrl:t("users/user_mode_diy_pay_ok.html"),controller:"userModeDiyPayOk"}),e.state("userModeNoWorry",{url:"/usermode_noworry/",templateUrl:t("users/user_mode_noworry.html"),controller:"userModeNoWorry"}),e.state("userModeNoWorrySubmit",{url:"/usermode_noworry_submit/",templateUrl:t("users/user_mode_noworry_submit.html"),controller:"userModeNoWorrySubmit"})}]),o.factory("fUserMode",function(){return{listDiy:[],listNoworry:[],choosedModeList:[],choosedModeListMinor:[],loading:!0,currentOrderData:{},chooseOneModeId:0,chooseOneModeType:"",chooseOneModeName:"",modeFee:0,servicePeriod:"",serviceExpired:""}}),o.run(["$rootScope","$templateCache",function(e,o){e.$on("$viewContentLoaded",function(){o.removeAll()})}]),o.controller("userMode",["$scope","$http","$state","$templateCache","fUserMode",function(e,o,r,t,s){e.loading=s.loading,e.basePriceDiy=0,e.basePriceNoworry=0,e.loadingDiy=!0,e.loadingNoworry=!0,n(o,"/vip/get_self_service_select/","",function(r){s.listDiy=r.data,d.minPrice(e,r.data,"basePriceDiy"),e.loadingDiy=!1,n(o,"/vip/get_manual_service_select/","",function(o){s.listNoworry=o.data,d.minPrice(e,o.data,"basePriceNoworry"),e.loadingNoworry=!1})}),setTimeout(function(){BizQQWPA.addCustom({aty:"0",nameAccount:"800031490",selector:"contact_us_noworry"})},500),e.chooseUserMode=function(o,t){$(".user-mode").removeClass("selected"),$(".user-mode-"+t).addClass("selected");var n="userModeNoWorry";s.choosedModeList=s.listNoworry,t.match(/^diy$/i)?(s.choosedModeList=s.listDiy,n="userModeDiy",s.loading=!1,e.loading=s.loading,r.go(n,{})):BizQQWPA.addCustom({aty:"0",nameAccount:"800031490",selector:"contact_us_noworry"})}}]),o.controller("userModeDiy",["$scope","$http","$state","$templateCache","fUserMode",function(e,o,r,t,s){e.loadingThis=!0,e.chooseOneMode=!1,e.chooseOneModeId=0,e.chooseOneModeType="",e.chooseOneModeName="",e.modeFee=0,e.agreementChecked=!0,e.servicePeriodList=[{n:3,selected:!0},{n:4,selected:!1},{n:5,selected:!1},{n:6,selected:!1},{n:7,selected:!1},{n:8,selected:!1},{n:9,selected:!1},{n:10,selected:!1},{n:11,selected:!1},{n:12,selected:!1}],e.servicePeriod="3",e.serviceExpired="2016-10-29 00:00:00",0==s.choosedModeList.length?n(o,"/vip/get_self_service_select/","",function(o){d.updateUserModeList(s,e,o,null,null)}):e.loadingThis=!1,e.modeList=s.choosedModeList,e.clickMode=function(r,t,n,c,a,i,l){l?d.orderActAlert(o,e,$,"购买失败","",'您正在使用省心型套餐，不能购买自助型套餐，有疑问，请咨询<a href="javascript:void(0);" id="JS_pbqqdiy_btn" class="c63c2ec">聘宝人才顾问</a>！',"确定",function(){$._LayerOut.close()}):i?$(".user-mode-small-"+n).hasClass("selected")?($(".user-mode-small").removeClass("selected"),e.chooseOneModeId=0,e.chooseOneModeType="",e.chooseOneModeName="",e.chooseOneMode=!1,e.modeFee=0,s.chooseOneModeId=e.chooseOneModeId,s.chooseOneModeType=e.chooseOneModeType,s.chooseOneModeName=e.chooseOneModeName,s.modeFee=e.modeFee):(e.chooseOneModeId=parseInt(n),e.chooseOneModeType=t,e.chooseOneModeName=a,$(".user-mode-small").removeClass("selected"),$(".user-mode-small-"+n).addClass("selected"),e.chooseOneMode=!0,e.modeFee=c,s.chooseOneModeId=e.chooseOneModeId,s.chooseOneModeType=e.chooseOneModeType,s.chooseOneModeName=e.chooseOneModeName,s.modeFee=e.modeFee):d.orderActAlert(o,e,$,"购买失败","","请选择更高级别的套餐购买！","确定",function(){$._LayerOut.close()})},e.clickToPayAfterConfirm=function(r){if($("#agreement").prop("checked")===!1)e.agreementChecked=!1,$("#agreement-error").text("请先同意聘宝套餐用户协议").css("display","block");else if(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==r){for(var t=0,c=0,a=0,i=0,l=s.choosedModeList.length;l>i;i++){var u=s.choosedModeList[i];if(u.pid==s.chooseOneModeId){t=u.feed_count,c=u.pinbot_point,a=s.servicePeriod;break}}var p="";p+='<div class="price content box-content box-content-table box-content-table-box pd-top-0 lh180">',p+='<div class="modal-line-big text-center"><span class="f18 c42b4e6">'+s.chooseOneModeName+"</span></div>",p+='<div class="box-col box-col-center">',p+='<div class="user-mode">',p+="<ul>",p+='    <li class="text-center">',p+="        <span>定制数量</span>",p+='        <span><span class="cf46c62">'+t+"</span>个</span>",p+="    </li>",p+='    <li class="text-center">',p+="        <span>每周可使用聘点</span>",p+='        <span><span class="cf46c62">'+c+"</span>点</span>",p+="    </li>",p+='    <li class="text-center">',p+="        <span>服务时长</span>",p+='        <span><span class="cf46c62">'+a+"</span>个月</span>",p+="    </li>",p+="</ul>",p+="</div>",p+="</div>",p+='<div class="modal-line text-center">服务有效期至：<span class="cf46c62">'+s.chooseOneModeName+"</span><br></div>",p+='<div class="modal-line text-center">服务费用：<span class="cf46c62">¥ '+s.modeFee+"</span></div>",p+="</div>",d.pbAlert(o,e,$,"请确认您要购买的套餐！","",p,"确认购买",function(){n(o,"/vip/self/info/?pid="+e.chooseOneModeId,"#/usermode_diy_pay/",function(o){s.currentOrderData=o,e.currentOrderData=s.currentOrderData,e.loadingThis=!1})})}},e.clickToPay=function(r){$("#agreement").prop("checked")===!1?(e.agreementChecked=!1,$("#agreement-error").text("请先同意聘宝套餐用户协议").css("display","block")):(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==r&&n(o,"/vip/self/info/?pid="+e.chooseOneModeId,"#/usermode_diy_pay/",function(o){s.currentOrderData=o,e.currentOrderData=s.currentOrderData,e.loadingThis=!1}))},e.checkAgreement=function(o){e.agreementChecked===!1?(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none")):e.agreementChecked=!1},e.goNoWorryMode=function(){s.choosedModeList=[],s.choosedModeListMinor=[],e.loadingThis=!0,n(o,"/vip/get_self_service_select/","",function(o){d.updateUserModeList(s,e,o,function(){r.go("userModeNoWorry",{})},null)})}}]),o.controller("userModeDiyPay",["$scope","$http","$state","fUserMode",function(e,o,r,t){e.userCoin=!1,void 0!=t&&void 0!=t.chooseOneModeId&&void 0!=t.currentOrderData.coin?(e.loadingThis=!0,e.payPid=t.chooseOneModeId,e.payType=t.chooseOneModeType,e.payName=t.chooseOneModeName,e.modeFee=t.modeFee,e.coin=s?1e3:t.currentOrderData.coin,e.payMethod="alipay"):r.go("userMode",{}),e.hoverMe=function(e,o){o===!0?$(e.currentTarget).addClass("hover"):$(e.currentTarget).removeClass("hover")},e.choosePayMethod=function(o,r){e.payMethod=r,$(o.currentTarget).hasClass("active")?$(o.currentTarget).removeClass("active"):($(".user-mode-pay").removeClass("active"),$(o.currentTarget).addClass("active")),$(".agreement-error").text("").css("display","none")},e.paynow=function(){if(""==e.payMethod)$(".agreement-error").text("请先选择支付方式！").css("display","block");else if($(".agreement-error").text("").css("display","none"),"diy"==e.payType){var s=t.currentOrderData.order_info.product_type,n="alipay";n=e.coin>e.modeFee&&$("#userCoin").prop("checked")===!0?"coin":"alipay";var d=0,a={product_type:s,num:1,pid:e.payPid,payment_terms:n,is_insurance:d};pbDebug&&console.log("postData",t,a),c(e,r,o,$,a,"userModeDiyPayOk")}},$.Menu()}]),o.controller("userModeDiyPayOk",["$scope","$http","$state","fUserMode",function(e,o,r,t){e.feed_count=0,e.pinbot_point=0,d.currentDiySet(e,t.chooseOneModeId,t.choosedModeList)}]),o.controller("userModeNoWorry",["$scope","$http","$state","$templateCache","fUserMode",function(e,o,r,t,s){return r.go("userMode",{}),!1}]),o.controller("userModeNoWorrySubmit",["$scope","$http","$state","fUserMode",function(e,o,r,t){return r.go("userMode",{}),!1}]),o.directive("servicePeriod",["$templateCache",function(e){return{restrict:"E",templateUrl:"/static/users/servicePeriod.html",scope:{servicePeriodList:"="},replace:!0,controller:["$scope","$element",function(e,o){e.chooseServicePeriod=function(o,r){for(var t=(o.currentTarget,0),s=e.servicePeriodList.length;s>t;t++)e.servicePeriodList[t].selected=!1,e.servicePeriodList[t].n==r&&(e.servicePeriodList[t].selected=!0)}}],link:function(e,o,r,t){console.log("directive link",e,o,r,t)},compile:function(e,o,r){return{pre:function(e,o,r,t){},post:function(e,o,r,t){}}}}}])}();