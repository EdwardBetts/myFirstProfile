!function(e){var o=angular.module("app.user_mode",["app.config","ui.router","app.django","app.utils","app.filter"]),s=angular.injector(["app.django","app.utils"]),t=s.get("tmpl"),r=(s.get("static_url"),s.get("mockTest"),s.get("mockTestWithCoin")),n=(s.get("confirmBox"),s.get("alertBox")),d=s.get("getModeData"),a=s.get("postModeData"),c=s.get("pbFunc"),i=s.get("pbLib"),l=s.get("orderPay");o.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,o,s){var r="/";o.otherwise(r),e.state("userMode",{url:"/",templateUrl:t("users/user_mode.html"),controller:"userMode"}),e.state("userModeDiy",{url:"/usermode_diy/",templateUrl:t("users/user_mode_diy.html"),controller:"userModeDiy"}),e.state("userModeDiyPay",{url:"/usermode_diy_pay/",templateUrl:t("users/user_mode_diy_pay.html"),controller:"userModeDiyPay"}),e.state("userModeDiyPayOk",{url:"/usermode_diy_pay_ok/",templateUrl:t("users/user_mode_diy_pay_ok.html"),controller:"userModeDiyPayOk"}),e.state("userModeNoWorry",{url:"/usermode_noworry/",templateUrl:t("users/user_mode_noworry.html"),controller:"userModeNoWorry"}),e.state("userModeNoWorrySubmit",{url:"/usermode_noworry_submit/",templateUrl:t("users/user_mode_noworry_submit.html"),controller:"userModeNoWorrySubmit"})}]),o.factory("fUserMode",function(){return{listDiy:[],listNoworry:[],choosedModeList:[],choosedModeListMinor:[],loading:!0,currentOrderData:{},chooseOneModeId:0,chooseOneModeType:"",chooseOneModeName:"",modeFee:0,servicePeriod:"",serviceExpired:""}}),o.run(["$rootScope","$templateCache",function(e,o){e.$on("$viewContentLoaded",function(){o.removeAll()})}]),o.controller("userMode",["$scope","$http","$state","$templateCache","fUserMode",function(e,o,s,t,r){if(e.loading=r.loading,e.basePriceDiy=0,e.basePriceNoworry=0,e.loadingDiy=!0,e.loadingNoworry=!0,document.location.href.toString().match(/\?username=([0-9a-z_%@\.\-]+)/i)){var n=unescape(RegExp.$1).replace(/[^0-9a-z@_\.\-]/gi,"");i.setCookie("add_user",n)}d(o,"/vip/get_self_service_select/","",function(s){r.listDiy=s.data,c.minPrice(e,s.data,"basePriceDiy"),e.loadingDiy=!1,d(o,"/vip/get_manual_service_select/","",function(o){r.listNoworry=o.data,c.minPrice(e,o.data,"basePriceNoworry"),e.loadingNoworry=!1})}),e.chooseUserMode=function(o,t){$(".user-mode").removeClass("selected"),$(".user-mode-"+t).addClass("selected");var n="userModeNoWorry";r.choosedModeList=r.listNoworry,t.match(/^diy$/i)&&(r.choosedModeList=r.listDiy,n="userModeDiy"),r.loading=!1,e.loading=r.loading,s.go(n,{})}}]),o.controller("userModeDiy",["$scope","$http","$state","$templateCache","fUserMode",function(e,o,s,t,r){e.loadingThis=!0,e.chooseOneMode=!1,e.chooseOneModeId=0,e.chooseOneModeType="",e.chooseOneModeName="",e.modeFee=0,e.agreementChecked=!0,e.servicePeriodList=[{n:3,selected:!0},{n:4,selected:!1},{n:5,selected:!1},{n:6,selected:!1},{n:7,selected:!1},{n:8,selected:!1},{n:9,selected:!1},{n:10,selected:!1},{n:11,selected:!1},{n:12,selected:!1}],e.servicePeriod="3",e.serviceExpired="2016-10-29 00:00:00",0==r.choosedModeList.length?d(o,"/vip/get_self_service_select/","",function(o){c.updateUserModeList(r,e,o,null,null)}):e.loadingThis=!1,e.modeList=r.choosedModeList,e.clickMode=function(s,t,n,d,a,i,l){l?c.orderActAlert(o,e,$,"购买失败","",'您正在使用省心型套餐，不能购买自助型套餐，有疑问，请咨询<a href="javascript:void(0);" id="JS_pbqqdiy_btn" class="c63c2ec">聘宝人才顾问</a>！',"确定",function(){$._LayerOut.close()}):i?$(".user-mode-small-"+n).hasClass("selected")?($(".user-mode-small").removeClass("selected"),e.chooseOneModeId=0,e.chooseOneModeType="",e.chooseOneModeName="",e.chooseOneMode=!1,e.modeFee=0,r.chooseOneModeId=e.chooseOneModeId,r.chooseOneModeType=e.chooseOneModeType,r.chooseOneModeName=e.chooseOneModeName,r.modeFee=e.modeFee):(e.chooseOneModeId=parseInt(n),e.chooseOneModeType=t,e.chooseOneModeName=a,$(".user-mode-small").removeClass("selected"),$(".user-mode-small-"+n).addClass("selected"),e.chooseOneMode=!0,e.modeFee=d,r.chooseOneModeId=e.chooseOneModeId,r.chooseOneModeType=e.chooseOneModeType,r.chooseOneModeName=e.chooseOneModeName,r.modeFee=e.modeFee):c.orderActAlert(o,e,$,"购买失败","","请选择更高级别的套餐购买！","确定",function(){$._LayerOut.close()})},e.clickToPayAfterConfirm=function(s){if($("#agreement").prop("checked")===!1)e.agreementChecked=!1,$("#agreement-error").text("请先同意聘宝套餐用户协议").css("display","block");else if(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==s){for(var t=0,n=0,a=0,i=0,l=r.choosedModeList.length;l>i;i++){var u=r.choosedModeList[i];if(u.pid==r.chooseOneModeId){t=u.feed_count,n=u.pinbot_point,a=r.servicePeriod;break}}var p="";p+='<div class="price content box-content box-content-table box-content-table-box pd-top-0 lh180">',p+='<div class="modal-line-big text-center"><span class="f18 c42b4e6">'+r.chooseOneModeName+"</span></div>",p+='<div class="box-col box-col-center">',p+='<div class="user-mode">',p+="<ul>",p+='    <li class="text-center">',p+="        <span>定制数量</span>",p+='        <span><span class="cf46c62">'+t+"</span>个</span>",p+="    </li>",p+='    <li class="text-center">',p+="        <span>每周可使用聘点</span>",p+='        <span><span class="cf46c62">'+n+"</span>点</span>",p+="    </li>",p+='    <li class="text-center">',p+="        <span>服务时长</span>",p+='        <span><span class="cf46c62">'+a+"</span>个月</span>",p+="    </li>",p+="</ul>",p+="</div>",p+="</div>",p+='<div class="modal-line text-center">服务有效期至：<span class="cf46c62">'+r.chooseOneModeName+"</span><br></div>",p+='<div class="modal-line text-center">服务费用：<span class="cf46c62">¥ '+r.modeFee+"</span></div>",p+="</div>",c.pbAlert(o,e,$,"请确认您要购买的套餐！","",p,"确认购买",function(){d(o,"/vip/self/info/?pid="+e.chooseOneModeId,"#/usermode_diy_pay/",function(o){r.currentOrderData=o,e.currentOrderData=r.currentOrderData,e.loadingThis=!1})})}},e.clickToPay=function(s){$("#agreement").prop("checked")===!1?(e.agreementChecked=!1,$("#agreement-error").text("请先同意聘宝套餐用户协议").css("display","block")):(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==s&&d(o,"/vip/self/info/?pid="+e.chooseOneModeId,"#/usermode_diy_pay/",function(o){r.currentOrderData=o,e.currentOrderData=r.currentOrderData,e.loadingThis=!1}))},e.checkAgreement=function(o){e.agreementChecked===!1?(e.agreementChecked=!0,$("#agreement-error").text("").css("display","none")):e.agreementChecked=!1},e.goNoWorryMode=function(){r.choosedModeList=[],r.choosedModeListMinor=[],e.loadingThis=!0,d(o,"/vip/get_self_service_select/","",function(o){c.updateUserModeList(r,e,o,function(){s.go("userModeNoWorry",{})},null)})}}]),o.controller("userModeDiyPay",["$scope","$http","$state","fUserMode",function(e,o,s,t){e.userCoin=!1,void 0!=t&&void 0!=t.chooseOneModeId&&void 0!=t.currentOrderData.coin?(e.loadingThis=!0,e.payPid=t.chooseOneModeId,e.payType=t.chooseOneModeType,e.payName=t.chooseOneModeName,e.modeFee=t.modeFee,e.coin=r?1e3:t.currentOrderData.coin,e.payMethod="alipay"):s.go("userMode",{}),e.hoverMe=function(e,o){o===!0?$(e.currentTarget).addClass("hover"):$(e.currentTarget).removeClass("hover")},e.choosePayMethod=function(o,s){e.payMethod=s,$(o.currentTarget).hasClass("active")?$(o.currentTarget).removeClass("active"):($(".user-mode-pay").removeClass("active"),$(o.currentTarget).addClass("active")),$(".agreement-error").text("").css("display","none")},e.paynow=function(){if(""==e.payMethod)$(".agreement-error").text("请先选择支付方式！").css("display","block");else if($(".agreement-error").text("").css("display","none"),"diy"==e.payType){var r=t.currentOrderData.order_info.product_type,n="alipay";n=e.coin>e.modeFee&&$("#userCoin").prop("checked")===!0?"coin":"alipay";var d=0,a={product_type:r,num:1,pid:e.payPid,payment_terms:n,is_insurance:d};pbDebug&&console.log("postData",t,a),l(e,s,o,$,a,"userModeDiyPayOk")}},$.Menu()}]),o.controller("userModeDiyPayOk",["$scope","$http","$state","fUserMode",function(e,o,s,t){e.feed_count=0,e.pinbot_point=0,c.currentDiySet(e,t.chooseOneModeId,t.choosedModeList)}]),o.controller("userModeNoWorry",["$rootScope","$scope","$http","$state","$templateCache","fUserMode",function(e,o,s,t,r,l){if(o.username="",document.location.href.toString().match(/\?username=([0-9a-z_%@\.\-]+)/i)){var u=unescape(RegExp.$1).replace(/[^0-9a-z@_\.\-]/gi,"");i.setCookie("add_user",u),o.username=u}if(o.loadingThis=!0,o.chooseOneMode=!1,o.chooseOneModeId=0,o.chooseOneModeType="",o.chooseOneModeName="",o.chooseCandidateNum=1,o.modeFee=0,o.packagePrice=0,o.agreementChecked=!0,pbDebug&&console.log("userModeNoWorry choosedModeList",l.choosedModeList),0==l.choosedModeListMinor.length)d(s,"/vip/get_manual_service_select/","",function(e){l.choosedModeList=[],l.choosedModeListMinor=[];for(var s=0,t=e.data.length;t>s;s++)l.choosedModeListMinor.push(e.data[s]);o.modeListMinor=l.choosedModeListMinor,o.loadingThis=!1});else{o.loadingThis=!1;var p=l.choosedModeList;o.modeListMinor=[];for(var m=0,h=p.length;h>m;m++)o.modeListMinor.push(p[m]);l.choosedModeListMinor=o.modeListMinor}o.clickMode=function(e,s,t,r,n,d){$(".user-mode-small-"+t).hasClass("selected")?(o.chooseCandidateNum=1,o.chooseOneModeId=0,o.chooseOneModeType="",o.chooseOneModeName="",$(".user-mode-small").removeClass("selected"),o.chooseOneMode=!1,o.modeFee=0,o.packagePrice=0,l.chooseOneModeId=o.chooseOneModeId,l.chooseOneModeType=o.chooseOneModeType,l.chooseOneModeName=o.chooseOneModeName,l.modeFee=o.modeFee):(o.chooseCandidateNum=parseInt(n),o.chooseOneModeId=parseInt(t),o.chooseOneModeType=s,o.chooseOneModeName=d,$(".user-mode-small").removeClass("selected"),$(".user-mode-small-"+t).addClass("selected"),o.chooseOneMode=!0,o.modeFee=r,o.packagePrice=r,l.chooseOneModeId=o.chooseOneModeId,l.chooseOneModeType=o.chooseOneModeType,l.chooseOneModeName=o.chooseOneModeName,$("#useGuarantee").prop("checked")===!0?($(".useGuaranteeInfo").text("已选择购买"),o.modeFee=o.packagePrice+500*o.chooseCandidateNum):($(".useGuaranteeInfo").text("选择购买"),o.modeFee=o.packagePrice),l.modeFee=o.modeFee),null!=i.getCookie("add_user")&&(o.username=i.getCookie("add_user"))},o.clickToPay=function(e){if($("#agreement").prop("checked")===!1)o.agreementChecked=!1,$("#agreement-error").text("请先同意聘宝套餐用户协议").css("display","block");else if(o.agreementChecked=!0,$("#agreement-error").text("").css("display","none"),"diy"==e);else{var r=o.chooseOneModeType,n="offline",d=$("#useGuarantee").prop("checked")===!0?1:0;1==d?($(".useGuaranteeInfo").text("已选择购买"),o.modeFee=o.packagePrice+500*o.chooseCandidateNum):($(".useGuaranteeInfo").text("选择购买"),o.modeFee=o.packagePrice),l.modeFee=o.modeFee;var c=$("#username").val().replace(/[^0-9a-z@_\.\-]/gi,""),i={username:c,product_type:r,num:1,pid:o.chooseOneModeId,payment_terms:n,is_insurance:d};pbDebug&&console.log("postData",l,i),a(s,i,"/vip/order/admin_create/","",function(e){pbDebug&&console.log("diy paynow",e),void 0!=e.status&&"ok"==e.status?(l.modeFee=e.order_price,t.go("userModeNoWorrySubmit",{})):$.alert('<p class="alert-notice-center"><span>创建订单失败，请稍后再试！</span></p>'),o.loadingThis=!1})}},o.chooseGuarantee=function(){$("#useGuarantee").prop("checked")===!0?($(".useGuaranteeInfo").text("已选择购买"),o.modeFee=o.packagePrice+500*o.chooseCandidateNum):($(".useGuaranteeInfo").text("选择购买"),o.modeFee=o.packagePrice),l.modeFee=o.modeFee},o.checkAgreement=function(e){o.agreementChecked===!1?(o.agreementChecked=!0,$("#agreement-error").text("").css("display","none")):o.agreementChecked=!1},o.goDiyMode=function(){l.choosedModeList=[],l.choosedModeListMinor=[],o.loadingThis=!0,d(s,"/vip/get_self_service_select/","",function(e){c.updateUserModeList(l,o,e,function(){t.go("userModeDiy",{})},null)})};var M=function(e){o.$apply(function(){o.modeFee=o.packagePrice+e*o.chooseCandidateNum}),l.modeFee=o.modeFee};o.aboutInsurance=function(){$.LayerOut({html:n('<span class="pay-title">关于入职险的说明</span>',"提交订单后，请等待聘宝人才顾问与您沟通并核对信息",'选择购买入职险<span class="cf46c62">500元/人</span>，我们提供每个候选人<span class="cf46c62">2周</span>的入职保证期具体信息请咨询销售顾问。',"确认购买"),afterClose:function(){}}),$(".modal").undelegate(".btn-click-ok").delegate(".btn-click-ok","click",function(e,o){$._LayerOut.close(),$("#useGuarantee").prop("checked",!0),$(".useGuaranteeInfo").text("已选择购买"),M(500)})},$.Menu()}]),o.controller("userModeNoWorrySubmit",["$scope","$http","$state","fUserMode",function(e,o,s,t){return e.loadingThis=!0,e.salary_range="",e.service_month=0,e.candidate_num=0,e.modeFee=t.modeFee,0==t.choosedModeListMinor.length?(s.go("userModeNoWorry",{}),!1):(c.currentNoworrySet(e,t.chooseOneModeId,t.choosedModeListMinor),void $.Menu())}]),o.directive("servicePeriod",["$templateCache",function(e){return{restrict:"E",templateUrl:"/static/users/servicePeriod.html",scope:{servicePeriodList:"="},replace:!0,controller:["$scope","$element",function(e,o){e.chooseServicePeriod=function(o,s){for(var t=(o.currentTarget,0),r=e.servicePeriodList.length;r>t;t++)e.servicePeriodList[t].selected=!1,e.servicePeriodList[t].n==s&&(e.servicePeriodList[t].selected=!0)}}],link:function(e,o,s,t){console.log("directive link",e,o,s,t)},compile:function(e,o,s){return{pre:function(e,o,s,t){},post:function(e,o,s,t){}}}}}])}();