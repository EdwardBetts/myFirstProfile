$("#url").on("blur",function(){var a=$("#url").prop("value");""==a||a.match(/^https?:\/\/(.*)$/i)||$("#url").prop("value","http://"+a)});var postData={change_company_data:{company_name:"",url:""},change_contact_data:{name:"",qq:""},change_passwd_data:{old_password:"",new_password1:"",new_password2:""},recv_data:{province:"",city:"",area:"",street:"",recv_phone:"",recv_name:""}},handleError=function(a,e){"ok"==e.status?document.location.reload():e.msg?$(a).parent().find(".pb-error-info").text(e.msg):$(a).parent().find(".pb-error-info").text("提交失败！")},isChgPasswd=!1,chkInput=function(a,e,n,t){var r=void 0!=a&&"string"==typeof a?"#"+a:"",t=void 0!=t?!1:!0,n=void 0!=n?!0:!1,i=$(r).attr("placeholder");return t&&""==$.trim($(r).val())?($(r).addClass("pb-input-error"),n?$(r).parent().parent().parent().find(".pb-error-info").text(i):$(r).parent().parent().find(".pb-error-info").text(i),$(r).focus(),!1):($(r).removeClass("pb-input-error"),n?$(r).parent().parent().parent().find(".pb-error-info").text(""):$(r).parent().parent().find(".pb-error-info").text(""),postData[e][a]=$.trim($(r).val()),!0)};$(".pb-line>div>span>input").on("blur",function(a){var e=$(this).attr("id"),n=e.match(/password/i)?"change_passwd_data":"recv_data";if(e.match(/^(name|qq)$/i)&&(n="change_contact_data"),e.match(/^(company_name|url)$/i)&&(n="change_company_data"),""!=$.trim($(this).val()))$(this).removeClass("pb-input-error"),$(this).parent().parent().find(".pb-error-info").text(""),postData[n][e]=$.trim($(this).val());else{var t=$(this).attr("placeholder");$(this).addClass("pb-input-error"),$(this).parent().parent().find(".pb-error-info").text(t)}}),$("#btn-save-company").on("click",function(a){a.preventDefault(),a.stopPropagation();var e=chkInput("company_name","change_company_data");if(!e)return!1;var n=chkInput("url","change_company_data");if(!n)return!1;var t={};postData.change_company_data.company_name&&(t.company_name=postData.change_company_data.company_name),postData.change_company_data.url&&(t.company_url=postData.change_company_data.url),PB.request("post","/users/change_company_info/","json",function(a){document.location.reload()},function(a,e){return!1},t,"json")}),$("#btn-save-passwd").on("click",function(a){a.preventDefault(),a.stopPropagation();var e=this,n=chkInput("old_password","change_passwd_data");if(!n)return!1;var t=chkInput("new_password1","change_passwd_data");if(!t)return!1;var r=chkInput("new_password2","change_passwd_data");if(!r)return!1;var i={};postData.change_passwd_data.old_password&&(i.old_password=postData.change_passwd_data.old_password),postData.change_passwd_data.new_password1&&(i.new_password=postData.change_passwd_data.new_password1),postData.change_passwd_data.new_password2&&(i.confirm_password=postData.change_passwd_data.new_password2),PB.request("post","/users/change_my_pwd/","json",function(a){handleError(e,a)},function(a,e){return!1},i,"json")}),$("#btn-save-contact").on("click",function(a){a.preventDefault(),a.stopPropagation();var e=chkInput("name","change_contact_data");if(!e)return!1;var n=chkInput("qq","change_contact_data");if(!n)return!1;var t={};postData.change_contact_data.name&&(t.realname=postData.change_contact_data.name),postData.change_contact_data.qq&&(t.qq=postData.change_contact_data.qq),PB.request("post","/users/change_my_info/","json",function(a){document.location.reload()},function(a,e){return!1},t,"json")});var $navs=$(".tab-nav a"),$tabs=$(".tab-content .tab"),timer;$navs.each(function(a){var e=$(this);e.on("click",function(n){n.preventDefault(),window.location.hash=e.attr("href"),$(".tab-content .on").removeClass("on"),$(".tab-nav .on").removeClass("on"),$navs.eq(a).addClass("on"),$tabs.eq(a).addClass("on")})}),$(".profile-rss").find("li>a").on("click",function(){clearTimeout(timer);var a=$(this);if(a.hasClass("selected"))return!1;a.parents("ul").find(".selected").removeClass("selected"),a.addClass("selected");var e=a.data("selected");return $(".selected-tip").remove(),timer=setTimeout(function(){$.post("/feed/modify_frequency",{frequency:e},function(e){if("success"==e.status){var n=$('<p class="selected-tip">设置成功！</p>').appendTo(a.parent());n.fadeOut(2e3,function(){n.remove()})}})},1e3),!1});var pbCurrentSelectClass="",goodsReceiptModal=function(){var a=[],e=function(){return{}},n="";for(var t in a)n+='<li class="noselect"><a href="javascript:void(0);" fid="'+a[t].f_id+'" title="'+a[t].f_name+'"><span>'+a[t].f_name+"</span></a></li>";var r=$(".form_recv_name").length?$(".form_recv_name").text():"",i=$(".form_province").length?$(".form_province").text():"",o=$(".form_city").length?$(".form_city").text():"",s=$(".form_area").length?$(".form_area").text():"",c=$(".form_street").length?$(".form_street").text():"",p=$(".form_recv_phone").length?$(".form_recv_phone").text():"",l='<h2 class="text-center"><i class="pb-icon pb-icon-cargo pb-icon-fix"></i> 请填写您的收货地址</h2><div class="bangding clearFix pt20">';l+='<div class="pb-line pb-line-50">',l+='         <div class="pb-line-left">',l+='           <span class="c607d8b">所在地区：</span>',l+="         </div>",l+='         <div class="pb-line-right">',l+='           <div class="pb-line-33"><span ><input type="text" name="province" id="province" value="'+i+'" placeholder="请输入省份"></span><span class="pbs-error-info"></span></div>',l+='           <div class="pb-line-33"><span ><input type="text" name="city" id="city" value="'+o+'" placeholder="请输入城市"></span><span class="pbs-error-info"></span></div>',l+='           <div class="pb-line-33"><span ><input type="text" name="area" id="area" value="'+s+'" placeholder="请输入区域"></span><span class="pbs-error-info"></span></div>',l+="         </div>",l+="       </div>",l+='<div class="pb-line pb-line-50">',l+='         <div class="pb-line-left">',l+='           <span class="c607d8b">详细地址：</span>',l+="         </div>",l+='         <div class="pb-line-right">',l+='<span ><input type="text" name="street" id="street" value="'+c+'" placeholder="请输入详细地址"></span><span class="pbs-error-info"></span>',l+="         </div>",l+="       </div>",l+='<div class="pb-line pb-line-50">',l+='         <div class="pb-line-left">',l+='           <span class="c607d8b">收货人姓名：</span>',l+="         </div>",l+='         <div class="pb-line-right">',l+='<span ><input type="text" name="recv_name" id="recv_name" value="'+r+'" placeholder="请输入收货人姓名"></span><span class="pbs-error-info"></span>',l+="         </div>",l+="       </div>",l+='<div class="pb-line pb-line-50">',l+='         <div class="pb-line-left">',l+='           <span class="c607d8b">手机号码：</span>',l+="         </div>",l+='         <div class="pb-line-right">',l+='<span ><input type="text" name="recv_phone" id="recv_phone" value="'+p+'" placeholder="请输入手机号码"></span><span class="pbs-error-info"></span>',l+="         </div>",l+="       </div>",l+='</div><div class=""><a href="javascript:void(0);" class=" bangding-confirm recv-btn-save">保存</a><span class="pb-error-info text-center pb-error-info-fix"></span></div>',$.LayerOut({html:l}),$(".bangding-confirm").on("click",function(){}),$(".pb-line").undelegate("input").delegate("input","blur",function(a){var e=$(this).attr("id"),n=e.match(/password/i)?"change_passwd_data":"recv_data";if(e.match(/^(name|qq)$/i)&&(n="change_contact_data"),e.match(/^(company_name|url)$/i)&&(n="change_company_data"),e.match(/^(area)$/i)||""!=$.trim($(this).val()))$(this).removeClass("pb-input-error"),e.match(/^(province|city|area)$/i)?$(this).parent().parent().parent().find(".pb-error-info").text(""):$(this).parent().parent().find(".pb-error-info").text(""),postData[n][e]=$.trim($(this).val());else{var t=$(this).attr("placeholder");$(this).addClass("pb-input-error"),e.match(/^(province|city|area)$/i)?$(this).parent().parent().parent().find(".pb-error-info").text(t):$(this).parent().parent().find(".pb-error-info").text(t)}}),$(".modal").undelegate(".recv-btn-save").delegate(".recv-btn-save","click",function(a){var e=this,n=chkInput("province","recv_data",!0);if(!n)return!1;var t=chkInput("city","recv_data",!0);if(!t)return!1;var r=(chkInput("area","recv_data",!0,!1),chkInput("street","recv_data"));if(!r)return!1;var i=chkInput("recv_name","recv_data");if(!i)return!1;var o=chkInput("recv_phone","recv_data");if(!o)return!1;var s={};postData.recv_data.province&&(s.province=postData.recv_data.province),postData.recv_data.city&&(s.city=postData.recv_data.city),postData.recv_data.area&&(s.area=postData.recv_data.area),postData.recv_data.street&&(s.street=postData.recv_data.street),postData.recv_data.recv_name&&(s.recv_name=postData.recv_data.recv_name),postData.recv_data.recv_phone&&(s.recv_phone=postData.recv_data.recv_phone),PB.request("post","/users/change_my_recv_info/","json",function(a){handleError(e,a)},function(a,e){return document.location.href.toString().match(/#person\-info/i)&&($(".modal-backdrop,.modal").remove(),delete $._LayerOut,setTimeout(function(){},500)),!1},s,"json")}),$(".pb-line").undelegate(".pb-select").delegate(".pb-select","click",function(a){var e=$(this).attr("class");if(e.match(/pb\-select\-([0-9a-z_\-]+)/i)){var n=RegExp.$1;if($(".pb-select-options-"+n).length){var t=$(".pb-select-options-"+n).css("display");"none"==t?($(this).find("i.pb-icon").addClass("pb-icon-arrow-up"),$(".pb-select-options-"+n).removeClass("pb-hide"),pbCurrentSelectClass=n):($(this).find("i.pb-icon").removeClass("pb-icon-arrow-up"),$(".pb-select-options-"+n).addClass("pb-hide"),pbCurrentSelectClass="")}}}),$(".pb-select-options").undelegate("li").delegate("li","click",function(a){var n=$(this).parent().parent(),t=n.attr("class");if(t.match(/pb\-select\-options\-([0-9a-z_\-]+)/i)){var r=RegExp.$1;if($(".pb-select-options-"+r).length){var i=$(this).find("a > span").text();if(postData.change_profile_data[r]=i,$(".pb-select-"+r+" > span:first-child").text(i),$(".pb-select-"+r+" > span:first-child").addClass("selected"),$(".pb-select-"+r).find("i.pb-icon").removeClass("pb-icon-arrow-up"),$(".pb-select-options-"+r).addClass("pb-hide"),pbCurrentSelectClass="","province"==r){var o=e(),s=$(this).find("a").attr("fid"),c="";for(var p in o[s])c+='<li class="noselect"><a href="javascript:void(0);" fid="'+o[s][p].f_id+'" title="'+o[s][p].f_name+'"><span>'+o[s][p].f_name+"</span></a></li>";$(".pb-select-options-city").find("ul").html(c),$(".pb-select-city > span:first-child").text("请选择"),$(".pb-select-city > span:first-child").removeClass("selected"),postData.change_profile_data.city=""}}}}),$("body").on("click","*",function(a){a.stopPropagation(),""!=pbCurrentSelectClass&&($(this).parent()&&$(this).parent().attr("class")&&$(this).parent().attr("class").match(/pb\-select/i)||($(".pb-select").find("i.pb-icon").removeClass("pb-icon-arrow-up"),$(".pb-select-options").addClass("pb-hide")))})};$(".form-panel .open-recv-modal").on("click",function(){goodsReceiptModal()}),$(document).ready(function(){document.location.href.toString().match(/#person\-info/i)&&null==PB.getCookie("auto_modal")&&(PB.setCookie("auto_modal",1,6e4),PB.jumpTo("#user-info"),goodsReceiptModal())});var isScanWx=!1,tickTime=0,chkWeixinBinding=function(){if(!isWxBinding&&isScanWx)var a=setInterval(function(){tickTime++,tickTime>300&&clearInterval(a),$.ajax({type:"get",url:"/users/weixin_isbind/",format:"json",success:function(e){"ok"==e.status&&1==e.is_bind&&($(".modal-backdrop,.modal").remove(),delete $._LayerOut,clearInterval(a),isWxBinding=!0,$(".pb-add-wx-binding").addClass("pb-hide"),$(".pb-cancel-wx-binding").removeClass("pb-hide"),$(".weixin_nickname").text(e.nickname),isScanWx=!1)},error:function(){}})},1e3)};$("#js-bangding").on("click",function(){alertBangdingTip()});var alertBangdingTip=function(){isScanWx=!0,chkWeixinBinding();var a="/hr/qrcode_bind/?t="+Math.random(),e='<h2 class="text-center"><i class="pb-icon pb-icon-weixin pb-icon-fix"></i> 扫一扫绑定微信号</h2><div class="bangding clearFix pt20 weixin-barcode text-center"><img src="/static/partner/images/loading.gif" width="30" border="0"></div><div class=""><a href="javascript:void(0);" class="bangding-confirm">确定</a></div>';$.LayerOut({html:e,afterClose:function(){isScanWx=!1}});var n=function(a){var e=function(e){function n(){r(),e.resolve(i)}function t(){r(),e.reject(i)}function r(){i.onload=null,i.onerror=null,i.onabort=null}var i=new Image;i.onload=n,i.onerror=t,i.onabort=t,i.src=a};return $.Deferred(e).promise()},t=n(a);t.then(function(e){$(".weixin-barcode img").attr("src",a),$(".weixin-barcode img").attr("width","160")}),$(".bangding-confirm").on("click",function(){$(".modal-backdrop,.modal").remove(),delete $._LayerOut})},windowUrl=window.location.href;windowUrl.match(/users\/profile\/#bangding/g)&&(alertBangdingTip(),$("#js-bangding").addClass("cf46c62")),$(".pb-line").undelegate(".unbindWeixin").delegate(".unbindWeixin","click",function(a){var e='<div class="no-feed-alert"><h2><i class="i-warning"></i>解除微信绑定</h2><p class="tip"><br>您确认解除与“<span class="cf46c62">聘宝招聘版</span>”的微信绑定吗？解绑后将不再收到新的简历推荐提醒！</p><p><a class="btn confirm unbindNow" href="javascript:void(0);">确认解除</a><a class="btn cancel closeLayer" href="javascript:void(0);">取消</a></p></div>';$.LayerOut({html:e}),$(".closeLayer").on("click",function(){$(".modal-backdrop,.modal").remove(),delete $._LayerOut}),$(".unbindNow").on("click",function(){$.ajax({url:"/hr/unbind_weixin/",type:"get",cache:!1,dataType:"json",success:function(a){void 0!=a&&"ok"==a.status?document.location.reload():alert("解绑失败！"+a.msg)},error:function(){$(".modal-backdrop,.modal").remove(),delete $._LayerOut,alert("解绑失败！")}})})});var isReSend=!1,timeInterval;$(".pb-line").undelegate(".chg-phone").delegate(".chg-phone","click",function(a){var e='<div class="no-feed-alert"><h2><i class="i-warning"></i>绑定手机号码</h2><br><br>'+PB.modalLine3Col("请输入登录密码","login-passwd","password")+PB.modalLine3Col("请输入新的手机号码","new-phone")+PB.modalLine3Col("请输入短信验证码","code","text","use-sms-code")+'<br><p><a class="btn confirm chg-phone-now" href="javascript:void(0);">确认绑定</a></p></div>';PB.box(e,".chg-phone-now",function(a,e){var n=a.parent().parent().find(".code").prop("value"),t=a.parent().parent().find(".new-phone").prop("value"),r=a.parent().parent().find(".login-passwd").prop("value");if(""==$.trim(r))return PB.labelErr("login-passwd","请输入登录密码！"),a.parent().parent().find(".login-passwd").focus(),!1;if(!t.match(/^1[0-9]{10}$/i))return PB.labelErr("new-phone","请输入新的手机号码！"),a.parent().parent().find(".new-phone").focus(),!1;if(!n.match(/^[0-9]{6}$/i))return PB.labelErr("code","请输入六位短信验证码！"),a.parent().parent().find(".code").focus(),!1;$(".sms-code").html();$(".chg-phone-now").attr("disabled","true"),PB.request("post","/users/change_mobile/","json",function(a){$(".chg-phone-now").removeAttr("disabled"),PB.formErrHandler(a,function(a){e.close(),document.location.href="/users/profile/"},null,".chg-phone-now","确认修改")},function(a,e){return PB.btnAlert(".chg-phone-now","修改绑定手机失败！请重新获取"),!1},{password:r,mobile:t,code:n},"json")},null,"new-phone",isReSend,timeInterval,"ChangeMobile")}),$(".pb-line").undelegate(".chg-email").delegate(".chg-email","click",function(a){PB.chgNotifyEmail(isReSend,timeInterval)}),$(".pb-line").undelegate(".verify-email").delegate(".verify-email","click",function(a){var e=$(".receive_email").text();PB.isValidEmail(e)||(e="");var n='<div class="no-feed-alert"><h2><i class="i-warning"></i>立即验证邮箱</h2>'+PB.modalLine3Col("请输入登录密码","login-passwd","password",null,"mg-top-30")+PB.modalLine3Col("请输入要验证的邮箱","to-chg-email","text",null,"mg-bottom-30",e)+'<p class="tip line mg-bottom-30"><span class=" line-width-100">该邮箱仅用于您接收聘宝简历推荐的邮箱，不用于登录，您可至“<a class="c42b4e6" href="/users/profile/">个人设置</a>”中修改</span></p><p><a class="btn confirm verify-email-now" href="javascript:void(0);">发送邮箱验证码</a></p></div>';PB.box(n,".verify-email-now",function(a,e){var n=a.parent().parent().find(".to-chg-email").prop("value"),t=a.parent().parent().find(".login-passwd").prop("value");return""==$.trim(t)?(PB.labelErr("login-passwd","请输入登录密码！"),a.parent().parent().find(".login-passwd").focus(),!1):PB.isValidEmail(n)?($(".verify-email-now").attr("disabled","true"),void PB.request("post","/users/send_email_code/","json",function(a){$(".verify-email-now").removeAttr("disabled"),PB.formErrHandler(a,function(a){e.close()},null,".verify-email-now","发送邮箱验证码")},function(a,e){return PB.btnAlert(".verify-email-now","发送邮箱验证码失败！请重新获取"),!1},{password:t,email:n},"json")):(PB.labelErr("to-chg-email","请输入要修改的邮箱！"),a.parent().parent().find(".to-chg-email").focus(),!1)})});