$.SetKeyword=function(t,e){var i=function(t){return new i.prototype.init(t)};return i.prototype={init:function(t){this.setting=t,__setKeyword=this,this.addHtml(),this.bindEvent()},escEvent:function(t){27==t.keyCode&&__setKeyword.close()},bindEvent:function(){t(window).on("keyup",window,__setKeyword.escEvent)},add:function(){return html='<tr><td class="flag-td">'+(t(".editbox-table tbody tr").length+1)+'</td><td title="主题词进行分词后，每个词进行同义词扩展得到若干同义词集合, 简历中必须包含每个集合中至少一个词。"><div><input class="latent_semantic_keywords"></div></td><td title="简历中必须包含所有必含词."><div><input class="necessary_keywords" ></div></td><td title="简历中不能包含任意一个屏蔽词."><div><input class="exclude_job_keywords"></div></td><td class="action-td"><div><a href="javascript:;" onclick="__setKeyword.remove( this );">删除</a></div></td></tr>',html},addNew:function(){var e=this.add();t(".editbox-table tbody").append(e)},editFeed:function(){return t(".feed-nav li").each(function(e){return t(this).attr("class").match(/curr/i)&&t(this).find("a").attr("href").match(/^#\/group\/([0-9a-z]+)/i)?(window.open("http://da.pinbot.me/admin/feed/edit/?url=%2Fadmin%2Ffeed%2F&id="+RegExp.$1),!1):void 0}),!1},remove:function(e){t(e).closest("tr").remove(),this.order()},order:function(){var e=t(".flag-td");e.each(function(t,e){this.innerHTML=t+1})},addHtml:function(){var e=function(t){var i="";if(!e.length)return i=this.add();for(var s=0,a=t.length;a>s;s++){var d=t[s];i+='<tr data-op_time="'+(d.op_time||"")+'" data-username="'+(d.username||"")+'"><td class="flag-td">'+(s+1)+'</td><td title="主题词进行分词后，每个词进行同义词扩展得到若干同义词集合, 简历中必须包含每个集合中至少一个词。"><div><input class="latent_semantic_keywords" value="'+("object"==typeof d.latent_semantic_keywords?d.latent_semantic_keywords.join(" "):d.latent_semantic_keywords)+'"></div></td><td title="简历中必须包含所有必含词."><div><input class="necessary_keywords" value="'+("object"==typeof d.necessary_keywords?d.necessary_keywords.join(" "):d.necessary_keywords)+'"></div></td><td title="简历中不能包含任意一个屏蔽词."><div><input class="exclude_job_keywords" value="'+("object"==typeof d.exclude_job_keywords?d.exclude_job_keywords.join(" "):d.exclude_job_keywords)+'"></div></td><td class="action-td"><div><a href="javascript:;" onclick="__setKeyword.remove( this );">删除</a></div></td></tr>'}return i},i='<div class="wp-popup"><div class="popup popup-enter"><div class="popup-loading" id="JS_loading_img" style="display:none;"></div><div class="popup-hd clearfix"><h3 class="popup-title">添加备注(多个词间用空格隔开)</h3><span class="span-switch"><input type="checkbox" id="switch1" name="switch1" class="switch" '+("true"==this.setting.ignored.toString()?'checked="checked"':"")+'><label for="switch1">点击绿色后屏蔽用户填写的关键词</label> </span></div><div class="popup-bd"><div id="editbox"><div class="editbox-table"><div style="float:right;width:200px;text-align:right;">? <a href="https://tower.im/s/8cOFt" target=_blank>帮助文档</a></div>1、一行为一个条件,条件内为"且"关系,条件间为"或"关系;<br>2、以下关键词过滤逻辑：分别为"同义词扩展过滤"、"强过滤"、"强过滤"。<br><table><thead><tr><th class="flag-th">◊</th><th title="主题词进行分词后，每个词进行同义词扩展得到若干同义词集合, 简历中必须包含每个集合中至少一个词。"><span>主题词 <strong></strong></span></th><th title="简历中必须包含所有必含词."><span>必含词 <strong></strong></span></th><th title="简历中不能包含任意一个屏蔽词."><span>屏蔽词 <strong></strong></span></th><th class="action-th">操作</th></tr></thead><tbody>'+e(this.setting.remarks)+'</tbody></table></div></div> </div><div class="popup-action" style="display: block;"><a href="javascript:;" class="action-add" onclick="__setKeyword.addNew();">+ 新增条件</a> <a href="javascript:;" class="action-edit-feed" onclick="__setKeyword.editFeed();">修改定制</a> <a href="javascript:;" class="action-ok" onclick="__setKeyword.save();">保存</a> <a href="javascript:;" class="action-cancel" onclick="__setKeyword.close();">取消</a> </div></div> </div>';t("body").append(i)},save:function(){var e=t(".editbox-table tbody tr"),i={remarks:[]},s=this;i.ignored=t("#switch1").prop("checked");for(var a=0,d=e.length;d>a;a++){var r=e.eq(a),n={},o=r.attr("data-op_time")||"",c=r.attr("data-username")||"",l=r.find(".necessary_keywords")[0].value,p=r.find(".latent_semantic_keywords")[0].value,_=r.find(".exclude_job_keywords")[0].value;n.necessary_keywords=l,n.latent_semantic_keywords=p,n.exclude_job_keywords=_,n.op_time=o,n.username=c,i.remarks.push(n)}i.___=(new Date).getTime();var v=JSON.stringify(i),h=[];for(var a in i.remarks)if(i.remarks.hasOwnProperty(a)){if(""===i.remarks[a].necessary_keywords.trim()&&""===i.remarks[a].latent_semantic_keywords.trim()&&""===i.remarks[a].exclude_job_keywords.trim())return alert("请至少填写一项关键词"),!1;h.push(i.remarks[a])}h.length>=0?(i.remarks=h,v=JSON.stringify(i),t.post("/feed/edit_remarks/"+s.setting.feed_id+"/",v,function(e){if(t("#JS_loading_img").hide(),e&&"ok"==e.status){var a=t(".JS_set_keyword");a.each(function(t,e){var d=a.eq(t);return d.attr("data-feedid")==s.setting.feed_id?(delete i.__,delete i.feed_id,d.attr("data-remarks",JSON.stringify(i)),!1):void 0}),s.close()}else e&&e.msg?alert(e.msg):alert("请求失败！")},"json").fail(function(){alert("请求失败！"),t("#JS_loading_img").hide()}),t("#JS_loading_img").show()):this.close()},close:function(){t(".wp-popup").remove(),t(window).off("keyup",__setKeyword.escEvent),__setKeyword=null}},i.prototype.init.prototype=i.prototype,function(t){i(t)}}(jQuery);