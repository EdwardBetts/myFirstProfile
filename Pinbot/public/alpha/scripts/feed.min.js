function minusOne(a){a.each(function(){var c=$(this),b=parseInt(c.html(),10)-1;0>=b&&(b="",$(this).parents("li").removeClass("latest-count")),c.html(b);});}function setNum(b,a){b.each(function(){0>=a?a="":$(this).parents("li").addClass("latest-count"),$(this).html(a);});}var feedApp=angular.module("feedApp",[]);feedApp.config(["$interpolateProvider",function(a){a.startSymbol("{[{"),a.endSymbol("}]}");}]),feedApp.config(["$routeProvider",function(c){var a=$("#template-feeditem").html();c.when("/group/:id",{template:a,controller:"feedPage"});var d=$(".feed-group-link").first(),b="/";d.length&&(b=d.attr("href").substr(1)),c.otherwise({redirectTo:b});}]),feedApp.factory("Feed",["$http",function(b){var a=window.location.pathname||"",c="user";return"/statis/feed_result/"===a&&(c="cached"),{group:function(e,h,f,g,d){return b.get("/feed/group/"+e+"?start="+h+"&latest="+f+"&limit=5&view="+g+"&t="+ +new Date).then(function(i){return i.data;}).then(d);},current:{id:"",view:c,start:0,latest:0,total_count:0,total_recommend_count:0,scope:{}}};}]),feedApp.filter("gender",function(){return function(a){return"female"==a?"女":"男";};}).filter("nospace",function(){return function(a){return a.split(/\s+/)[0];};}).filter("checkFeedOpen",function(){return function(a){return a?"":"feed-unread";};}).filter("checkFeedLatest",function(){return function(a){return a?"feed-latest":"";};}).filter("chop",function(){return function(a){return a.length>150&&(a=a.substr(0,147)+"</br>..."),a;};}),feedApp.directive("fixedtop",function(){return{restrict:"A",link:function(h,d,k){var g=k.fixedtop||0,j=$(d).offset().top,c=$(d),b=$(window),f=c.css("position");b.on("scroll",function(){b.scrollTop()>=j-g?c.css({position:"fixed",top:g+"px"}):c.css({position:f,top:"auto"});});}};});var $more=$(".load-more");feedApp.controller("aside",["$scope","$location",function(b,a){b.isActive=function(c){return -1!=a.path().indexOf(c);};}]).controller("feedApp",["$scope","Feed","$timeout",function(b,a,c){b.current=a.current,b.toggleLatest=function(){b.current.latest=b.current.latest?0:1,c(function(){var f=$(".feed-nav .curr").find("a"),d=f.attr("href");window.location.replace(d.split("?")[0]+"?"+Math.random().toString(16).substr(2));});},b.toggleView=function(d){return b.current.view==d?!1:(b.current.view=d||"user",c(function(){var g=$(".feed-nav .curr").find("a"),f=g.attr("href");window.location.replace(f.split("?")[0]+"?"+Math.random().toString(16).substr(2));}),void 0);};}]).controller("feedPage",["$scope","Feed","$timeout","$routeParams","$rootScope",function(c,a,d,b){a.current.id=b.id,a.current.start=0,a.current.limit=5,c.fetch=function(){c.loadmore=!0,c.hasmore=!1,a.group(a.current.id,a.current.start,a.current.latest,a.current.view,function(e){d(function(){c.feeditems.push.apply(c.feeditems,e.data),a.current.start=e.next_start,c.loadmore=!1,"-1"!=e.next_start&&(c.hasmore=!0),c.current.latest?setNum($(".feed-nav li.curr").find(".feed-latest-count"),e.newest_recommend_count):e.newest_recommend_count&&_.filter(e.data||[],function(f){return !!f.latest;}).length&&setNum($(".feed-nav li.curr").find(".feed-latest-count"),e.newest_recommend_count);});});},d(function(){c.initLoading=!0,c.loadmore=!1,c.hasmore=!1,c.waiting=!1;}),a.current.id&&a.group(a.current.id,a.current.start,a.current.latest,a.current.view,function(e){d(function(){c.feeditems=e.data,c.initLoading=!1,a.current.total_count=e.total_count,a.current.total_recommend_count=e.total_recommend_count,a.current.start=e.next_start,"-1"!=e.next_start&&(c.hasmore=!0),e.count&&e.data.length||(c.waiting=!0,c.hasmore=!1),c.current.latest?setNum($(".feed-nav li.curr").find(".feed-latest-count"),e.newest_recommend_count):e.newest_recommend_count&&_.filter(e.data||[],function(f){return !(!f||!f.latest);}).length&&setNum($(".feed-nav li.curr").find(".feed-latest-count"),e.newest_recommend_count);});}),c.openFeed=function(e){c.feeditems[e].latest&&minusOne($('span[data-count-group="'+c.feeditems[e].feed_id+'"], span[data-count-group="all"]')),c.feeditems[e].latest=!1,c.feeditems[e].opened=!0;},c.dislike=function(e){$.get("/feed/modify_feed_result",{feed_id:c.feeditems[e].feed_id,resume_id:c.feeditems[e].resume_id,reco_index:"-150"}),d(function(){c.feeditems[e].dislike=!0,c.feeditems[e].latest=!1,c.feeditems[e].opened=!0;});};}]),$(function(){function c(f){$("html, body").stop().animate({scrollTop:f},"normal");}var a=$("#feed-submit-form");a.find(".options").each(function(){var g=$(this),f=g.data("name"),h=$('input[name="'+f+'"]');g.find("span").on("click",function(){g.hasClass("op-multi")?$(this).toggleClass("selected"):g.hasClass("op-single")&&($(this).parents("li").find(".selected").removeClass("selected"),$(this).addClass("selected")),h.val(g.find(".selected").map(function(){return $.trim($(this).html());}).toArray().join(","));});}),$(".suggested-keywords").on("click","span",function(){var f=$(this).html();$('input[name="keywords"]').val(f).focus();});var d=!1;$(".select-btn-more>a").on("click",function(g){g.preventDefault();var f=$(this);$(".select-expect-area").toggleClass("expect-area-span").find(".op-multi").slideToggle(200);var h=$.trim(f.html());f.html(f.data("text-span")),f.data("text-span",h);}),$('p[data-name="job_type"]>span').on("click",function(){var f=$(this).data("suggest");f&&$(".suggested-keywords").html($.map(f.split("|"),function(g){return"<span>"+g+"</span>";}).join(""));}),$('a[href^="/feed/delete"]').on("click",function(){var f=window.confirm("删除订阅条件将清除此订阅下的所有简历！是否继续？");return f?void 0:!1;}),$(".feed-edit-jd >form").on("submit",function(k){k.preventDefault();var g=$(this),m=g.attr("action"),f=g.find('input[name="salary_min"]').val(),j=g.find('input[name="salary_max"]').val(),i=g.find('textarea[name="job_desc"]').val(),h=g.find('textarea[name="skill_required"]').val();if(i==window.feed_edit_jd_old){return g.find('textarea[name="job_desc"]').focus(),!1;}var l=g.find('button[type="submit"]').html("正在保存");l.addClass("submitting"),$.post(m,{salary_min:f,salary_max:j,job_desc:i,skill_required:h},function(n){l.removeClass("submitting"),l.html("保存"),n&&n.status===true?(window.feed_edit_jd_old=i,l.prev().remove(),$('<span style="margin-right: 10px; color:green;">已保存!</span>').insertBefore(l).fadeOut(1500,function(){$(this).remove();})):(l.prev().remove(),$('<span style="margin-right: 10px; color:red;">保存失败，请重试!</span>').insertBefore(l).fadeOut(3000,function(){$(this).remove();}));});});var b;$("body").on("mouseover",".resume-tags-hook",function(){clearTimeout(b),$(this).parents(".item-header").find(".item-action-keywords").fadeIn();}).on("mouseout",".resume-tags-hook, .item-action-keywords",function(){b=setTimeout(function(){$(".item-action-keywords").hide();},400);}).on("mouseover",".item-action-keywords",function(){clearTimeout(b);}),function(){var f=$(document);$(window).on("scroll",function(){var e=$('a[ng-show="hasmore"]');if(!e.length){return !1;}if(!e.is(":hidden")){var g=f.height()-f.scrollTop()-$(window).height();100>g&&e.get(0).click();}});}();}),window.subscribe=function(a){if(a&&a.status=="ok"){if(a.show_mission){$("#JS_username").html(a.username);$("#JS_mission_time").html(a.mission_time);$(".modal-backdrop-tip,.modal-tip").show();$(".modal-dialog").css({marginTop:($(window).height()-$(".modal-dialog").height())/2+"px"});}else{if(a.redirect_url){$.alert('<p style="text-align:center;font-size:16px;"><i class="i-l-notice"></i>操作成功！</p>',function(){location.href=a.redirect_url;},"",{confirmByShadow:true});}}}},function(){var a;$(".profile-rss").find("li>a").on("click",function(){clearTimeout(a);var b=$(this);if(b.hasClass("selected")){return !1;}b.parents("ul").find(".selected").removeClass("selected"),b.addClass("selected");var c=b.data("selected");return $(".selected-tip").remove(),a=setTimeout(function(){$.post("/feed/modify_frequency",{frequency:c},function(d){if("success"==d.status){var f=$('<p class="selected-tip">设置成功！</p>').appendTo(b.parent());f.fadeOut(2000,function(){f.remove();});}});},1000),!1;});$("#btn-feed-submit").on("click",$.commonAjax);}();