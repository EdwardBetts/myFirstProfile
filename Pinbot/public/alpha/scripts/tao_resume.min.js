function scrollTo(b,a){$("html, body").stop().animate({scrollTop:b},"normal",a||function(){});}function formartTags(e){if(!e.length){return;}var c="";for(var b=0,a=e.length;b<a;b++){var d=e[b];c+='<a href="javascript:;" class="JS_tags_a" data-tag="'+d.tag+'" data-tag_id="'+d.tag_id+'">'+d.tag+"</a>";}$("#JS_list_tags").html(c);}var feedApp=angular.module("feedApp",[]);feedApp.config(["$interpolateProvider",function(a){a.startSymbol("{[{");a.endSymbol("}]}");}]);feedApp.config(["$routeProvider",function(a){var b=$("#template-feeditem").html();var c=$(".feed-nav >li").first().find("a").attr("href").substr(1);a.when("/group/:id",{template:b,controller:"feedPage"});a.otherwise({redirectTo:c});}]);feedApp.factory("Feed",["$http",function(c){var a=window.location.pathname||"";var b="user";if(a==="/statis/feed_result/"){b="cached";}return{group:function(h,g,e,d,f){return c.get("/feed/group/"+h+"?start="+g+"&limit=100&view="+d+"&t="+ +new Date()).then(function(j){formartTags(j.data.all_tags);if(j.data.data.length){var k=new Date(j.data.data[0].calc_time),n=k.getFullYear(),i=k.getMonth()+1,l=k.getDate();i=(i.toString().length>1?i:"0"+i);l=(l.toString().length>1?l:"0"+l);$("#JS_calendar").html('<i class="i-calendar">'+l+"</i> <span>"+n+"年"+i+"月"+l+"日</span>").show();}window.taoResumes=j.data;return j.data;}).then(f);},current:{id:"",view:b,start:0,latest:1,total_count:0,total_recommend_count:0,scope:{},selected:[]}};}]);function minusOne(a){a.each(function(){var c=$(this);var b=parseInt(c.html(),10)-1;if(b<=0){b="";}c.html(b);});}function setNum(b,a){b.each(function(){if(a<=0){a="";}$(this).html(a);});}feedApp.filter("gender",function(){return function(a){if(a=="female"){return"女";}else{if(a=="male"){return"男";}else{return a;}}};}).filter("nospace",function(){return function(a){return a.split(/\s+/)[0];};}).filter("checkFeedOpen",function(){return function(a){return a?"":"feed-unread";};}).filter("checkFeedLatest",function(){return function(a){return a?"feed-latest":"";};}).filter("chop",function(){return function(a){if(a.length>150){a=a.substr(0,147)+"</br>...";}return a;};}).filter("checkSelect",function(){return function(c,b){if(c.tag){for(var a=0;a<b.selected;++a){if(c.tag==b.selected[a].tag){return"curr";}}}return"";};}).filter("select",function(){return function(a,c){if(!c.selected.length){return a;}var b=[];if(c.all_tags){angular.forEach(a,function(g){if(g.tags){var h={};for(var d=0;d<g.tags.length;++d){h[g.tags[d].tag]=1;}var f=0;for(var e=0;e<c.selected.length;++e){if(h[c.selected[e].tag]){f++;}}if(f==c.selected.length){b.push(g);}}});return b;}};});feedApp.directive("fixedtop",function(){return{restrict:"A",link:function(c,d,a){var f=a.fixedtop||0;var e=$(d).offset().top;var b=$(d);var h=$(window);var g=b.css("position");h.on("scroll",function(){if(h.scrollTop()>=e-f){b.parent().css("height",b.height()+parseInt(b.parent().css("margin-bottom")));b.width(b.parent().width());b.css({position:"fixed",top:f+"px"});}else{b.css({position:g,top:"auto"});}});}};});var $more=$(".load-more");feedApp.controller("aside",["$scope","$location",function(a,b){a.isActive=function(c){return b.path().indexOf(c)!=-1;};}]).controller("feedApp",["$scope","Feed","$timeout",function(a,c,b){a.current=c.current;a.toggleLatest=function(d){if(!a.current.latest){a.current.latest=1;}else{a.current.latest=0;}b(function(){var f=$(".feed-nav .curr").find("a");var e=f.attr("href");window.location.replace(e.split("?")[0]+"?"+Math.random().toString(16).substr(2));});};a.toggleView=function(d,e){if(a.current.view==d){return false;}a.current.view=d||"user";b(function(){var g=$(".feed-nav .curr").find("a");var f=g.attr("href");window.location.replace(f.split("?")[0]+"?"+Math.random().toString(16).substr(2));});};}]).controller("feedPage",["$scope","Feed","$timeout","$routeParams","$rootScope",function(b,d,c,e,a){d.current.id=e.id;d.current.start=0;d.current.limit=6;b.fetch=function(f){b.loadmore=true;b.hasmore=false;d.group(d.current.id,d.current.start,d.current.latest,d.current.view,function(g){c(function(){b.feeditems.push.apply(b.feeditems,g.data);d.current.start=g.next_start;b.loadmore=false;if(g.next_start!="-1"){b.hasmore=true;}if(b.current.latest){setNum($(".feed-nav li.curr").find(".feed-latest-count"),g.newest_recommend_count);}else{if(g.newest_recommend_count){if(_.filter(g.data||[],function(h){return !!h.latest;}).length){setNum($(".feed-nav li.curr").find(".feed-latest-count"),g.newest_recommend_count);}}}});});};c(function(){b.initLoading=true;b.loadmore=false;b.hasmore=false;b.waiting=false;});if(d.current.id){d.group(d.current.id,d.current.start,d.current.latest,d.current.view,function(f){c(function(){b.feeditems=f.data;b.all_tags=f.all_tags;b.initLoading=false;d.current.total_count=f.total_count;d.current.total_recommend_count=f.total_recommend_count;d.current.start=f.next_start;if(f.next_start!="-1"){b.hasmore=true;}if(!f.count||!f.data.length){b.waiting=true;b.hasmore=false;}b.hasmore=false;if(b.current.latest){setNum($(".feed-nav li.curr").find(".feed-latest-count"),f.newest_recommend_count);}else{if(f.newest_recommend_count){if(_.filter(f.data||[],function(g){return !!(g&&g.latest);}).length){setNum($(".feed-nav li.curr").find(".feed-latest-count"),f.newest_recommend_count);}}}});});}b.selected=[];b.allSelect={};b.toggleTag=function(f,g){$(".feed-item-out").addClass("feed-item-out-loading");scrollTo(0,function(){$(".feed-item-out").removeClass("feed-item-out-loading");var h=$(g.target);var k="add";if(h.hasClass("curr")){k="del";}if(f){if(k=="add"){c(function(){b.selected.push(f);b.allSelect[f.tag]=1;});}else{for(var j=0;j<b.selected.length;++j){if(f.tag==b.selected[j].tag){c(function(){b.selected.splice(j,1);delete b.allSelect[f.tag];});return;}}}}});};b.isSelected=function(f){for(var g=0;g<b.selected.length;++g){if((""+f.tag)===(""+b.selected[g].tag)){return"curr";}}return"";};b.openFeed=function(f,g){if(b.feeditems[f].latest){minusOne($('span[data-count-group="'+b.feeditems[f].feed_id+'"], span[data-count-group="all"]'));}b.feeditems[f].latest=false;b.feeditems[f].opened=true;};b.dislike=function(f){$.get("/feed/modify_feed_result",{feed_id:b.feeditems[f].feed_id,resume_id:b.feeditems[f].resume_id,reco_index:"-150"});c(function(){b.feeditems[f].dislike=true;b.feeditems[f].latest=false;b.feeditems[f].opened=true;});};}]);$(function(){var c=$("#feed-submit-form");c.find(".options").each(function(){var d=$(this);var f=d.data("name");var e=$('input[name="'+f+'"]');d.find("span").on("click",function(){if(d.hasClass("op-multi")){$(this).toggleClass("selected");}else{if(d.hasClass("op-single")){$(this).parents("li").find(".selected").removeClass("selected");$(this).addClass("selected");}}e.val(d.find(".selected").map(function(){return $.trim($(this).html());}).toArray().join(","));});});$(".suggested-keywords").on("click","span",function(){var d=$(this).html();$('input[name="keywords"]').val(d).focus();});var b=false;c.on("submit",function(){if(b){return false;}if(!$('input[name="job_type"]').val()){scrollTo(c.find("li").eq(0).offset().top);return false;}if(!$('input[name="keywords"]').val()){scrollTo(c.find("li").eq(1).offset().top);return false;}if(!$('input[name="talent_level"]').val()){scrollTo(c.find("li").eq(2).offset().top);return false;}if(!$('input[name="expect_area"]').val()){scrollTo(c.find("li").eq(3).offset().top);return false;}b=true;$("#btn-feed-submit").val("正在提交..");});$(".select-btn-more>a").on("click",function(f){f.preventDefault();var d=$(this);$(".select-expect-area").toggleClass("expect-area-span").find(".op-multi").slideToggle(200);var g=$.trim(d.html());d.html(d.data("text-span"));d.data("text-span",g);});$('p[data-name="job_type"]>span').on("click",function(){var d=$(this).data("suggest");if(d){$(".suggested-keywords").html($.map(d.split("|"),function(e){return"<span>"+e+"</span>";}).join(""));}});$('a[href^="/feed/delete"]').on("click",function(f){var d=window.confirm("\u5220\u9664\u8ba2\u9605\u6761\u4ef6\u5c06\u6e05\u9664\u6b64\u8ba2\u9605\u4e0b\u7684\u6240\u6709\u7b80\u5386\uff01\u662f\u5426\u7ee7\u7eed\uff1f");if(!d){return false;}});$(".feed-edit-jd >form").on("submit",function(h){h.preventDefault();var d=$(this);var g=d.attr("action");var i=d.find('textarea[name="job_desc"]').val();if(i==window.feed_edit_jd_old){d.find('textarea[name="job_desc"]').focus();return false;}var f=d.find('button[type="submit"]').html("\u6b63\u5728\u4fdd\u5b58");f.addClass("submitting");$.post(g,{job_desc:i},function(e){f.removeClass("submitting");f.html("\u4fdd\u5b58");if(e&&e.status){window.feed_edit_jd_old=i;f.prev().remove();$('<span style="margin-right: 10px; color:green;">\u5df2\u4fdd\u5b58!</span>').insertBefore(f).fadeOut(1500,function(){$(this).remove();});}else{f.prev().remove();$('<span style="margin-right: 10px; color:red;">\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5!</span>').insertBefore(f).fadeOut(3000,function(){$(this).remove();});}});});$(".feed-page").on("click",".want-more-tags-handler",function(d){d.preventDefault();$(".want-more-tags-addition").toggle();if(!$(".want-more-tags-addition").is(":hidden")){$(".want-more-tags").find("textarea").focus();}}).on("click",".want-more-tags-addition-action .action-cancel",function(d){d.preventDefault();$(".want-more-tags-addition").hide();}).on("click",".action-add-tags",function(f){var g=$.trim($(".want-more-tags").find("textarea").val());if(!g){$(".want-more-tags").find("textarea").focus();return false;}var d=$(".feed-nav").find(".curr>a").data("feed_id");$.post("/resumes/add_tag_search",{tag:g,feed_id:d},function(h){$(".want-more-tags").find("textarea").val("");});$(".want-more-tags-addition").hide();$(".want-more-submitted").fadeIn();}).on("click",".want-more-submitted",function(){$(".want-more-submitted").fadeOut("fast");});var a;$("body").on("mouseover",".resume-tags-hook",function(){clearTimeout(a);$(this).parents(".item-header").find(".item-action-keywords").fadeIn();}).on("mouseout",".resume-tags-hook, .item-action-keywords",function(){a=setTimeout(function(){$(".item-action-keywords").hide();},400);}).on("mouseover",".item-action-keywords",function(){clearTimeout(a);});(function(){var d=$(document);$(window).on("scroll",function(){var e=$('a[ng-show="hasmore"]');if(!e.length){return false;}if(!e.is(":hidden")){var f=d.height()-d.scrollTop()-$(window).height();if(f<100){e.get(0).click();}}});}());$(document).on("click",".JS_tags_a",function(){var e=$(this),d=e.attr("data-tag"),f=e.attr("data-tag_id");$('.JS_tags_a[data-tag_id="'+f+'"]').toggleClass("curr");if(Filter&&Filter.tags&&Filter.tags[f]){delete Filter.tags[f];}else{Filter.tags[f]=d;}getList();});$(document).on("click","#JS_submit_btn",function(){if(window.lockSearch){return false;}window.lockSearch=true;var e=$(this).closest("form");if(!checkForm(e)){return false;}var d=getFilter(e);d=groupFilter(d);window.Filter=d;getList();window.lockSearch=false;});});function groupFilter(d){var h=$("#JS_list_tags").find(".curr"),e={};if(!h.length){return d;}for(var c=0,b=h.length;c<b;c++){var g=h.eq(c),a=g.attr("data-tag"),f=g.attr("data-tag_id");d.tags[f]=a;}return d;}function checkForm(a){if(a.find(".tip-error").length>0){window.lockSearch=false;alert("请填写正确!");return false;}return true;}function getFilter(e){var a=e.serialize().split("&"),f={tags:{}};for(var c=0,b=a.length;c<b;c++){var d=a[c].split("=");if(d[1]){f[d[0]]=decodeURIComponent(d[1]);}}return f;}function checkList(h){if(!$.isEmptyObject(Filter.tags)){if(!h.tags||!h.tags.length){return false;}var d=false;for(var c=0,b=h.tags.length;c<b;c++){var j=h.tags[c];if(Filter.tags[j.tag_id]){d=true;}}if(!d){return false;}}if(Filter.lower_year||Filter.upper_year){if(!h.profile||!h.profile.work_years){return false;}var a=parseInt(h.profile.work_years);if(a<parseInt(Filter.lower_year)||a>parseInt(Filter.upper_year)){return false;}}if(Filter.lower_money||Filter.upper_money){if(!h.job_target||!h.job_target.salary){return false;}var g=h.job_target.salary.split("-"),e=parseInt(Filter.upper_money),f=parseInt(Filter.lower_money);g[0]=parseInt(g[0]);g[1]=parseInt(g[1]);if(e<f){return false;}if(g[1]<f*1000||g[0]>e*1000){return false;}}if(Filter.degree){if(!h.profile||!h.profile.degree||(h.profile.degree!=Filter.degree)){return false;}}return true;}function getList(){if(!window.taoResumes||!window.taoResumes.data){return;}var g=window.taoResumes.data,c="";for(var b=0,a=g.length;b<a;b++){var e=g[b];if(!checkList(e)){continue;}c+='<div class="feed-item '+(e.opened?"":"feed-unread")+" "+(e.latest?"feed-latest":"")+'"><div class="feed-item-wrapper"><div class="item-header"><div class="item-header-wrapper"><div class="item-profile"><h3 class="item-work-position"><span style="margin-right: 5px; color: rgb(255, 153, 0); display: none;" class="ng-binding"></span>'+(e.latest_work&&e.latest_work.position_title?e.latest_work.position_title:"")+'</h3><span class="item-update-time" ng-show="item.calc_time">推荐时间： '+(e.calc_time?e.calc_time:"")+'</span><p><span class="item-profile-gender ng-binding">'+(e.profile&&e.profile.gender?(e.profile.gender=="male"?"男":(e.profile.gender=="female"?"女":e.profile.gender)):"")+'</span><span class="item-profile-age ng-binding">'+(e.profile&&e.profile.age?e.profile.age:"")+'&nbsp; &nbsp; </span><span class="ng-binding">'+(e.job_target&&e.job_target.job_hunting_state?e.job_target.job_hunting_state:"")+'</span><span class="item-profile-sep">|</span>';if(e.profile&&e.profile.address){c+='<span class="ng-binding">现居地：'+e.profile.address+"&nbsp; &nbsp;</span>";}if(e.profile&&e.profile.address){c+='<span class="ng-binding">意向地：'+e.profile.address+"</span>";}c+='</p></div><div class="item-resume-tags clearfix">';for(var d=0,h=e.tags.length;d<h;d++){var f=e.tags[d];c+='<a href="" class="JS_tags_a '+(Filter.tags&&Filter.tags[f.tag_id]?"curr":"")+'" data-tag="'+f.tag+'" data-tag_id="'+f.tag_id+'" >'+f.tag+"</a>";}c+='</div></div></div><div class="item-body"><div class="item-body-wrapper"><div class="item-summary"> <div class="item-main"> <p><span class="item-profile-exp"><em class="ng-binding">'+(e.profile&&e.profile.work_years?e.profile.work_years:"")+'</em>年经验</span><span class="item-profile-sep">|</span><span class="item-work-salary">期望薪资：<em class="ng-binding">'+(e.job_target&&e.job_target.salary?e.job_target.salary:"")+"</em></span></p></div>";if(e.latest_work){c+='<div class="item-work"><p><span class="item-work-comp ng-binding">'+(e.latest_work&&e.latest_work.company_name?e.latest_work.company_name:"")+'</span><span class="item-profile-sep">|</span><span class="item-work-position>'+(e.latest_work&&e.latest_work.position_title?e.latest_work.position_title:"")+' </span>&nbsp;<span class="item-work-salary>'+(e.latest_work&&e.latest_work.salary?e.latest_work.salary:"")+'</span></p><p class="work-detail ng-binding">'+(e.latest_work&&e.latest_work.job_desc?e.latest_work.job_desc:"")+"</p></div>";}c+='<div class="item-edu"><p><span class="item-edu-school ng-binding">'+(e.profile&&e.profile.school?e.profile.school:"")+'</span><span class="item-profile-degree ng-binding">'+(e.profile&&e.profile.degree?e.profile.degree:"")+'</span></p></div></div><div class="item-footer"><p class="resume-link"><a title="点击查看简历详情" onclick="openFeed($index)" href="/feed/get/'+e.feed_id+"/"+e.resume_id+'" target="_blank">查看简历</a></p></div></div></div></div></div>';}if(!c){c+='<div class="feed-item-out-empty"><p>可惜没找到。</p></div>';}$("#JS_list_content").html(c);}