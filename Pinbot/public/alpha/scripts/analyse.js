!function(e,t){var n=(e(window),{});n.service=function(){function t(e,t){for(var n=[],i=0;i<e.length;++i){var r=Math.floor(i/t);void 0===n[r]&&(n[r]=[]),n[r].push(e[i])}return n}var i={data:[],count:0,page:0},r="none";return{ready:function(t){e.get("/resumes/get_analyse_data/",function(e){i.data=e.data,i.count=i.data.length;for(var r=0;r<i.count;++r)i.data[r].index=r;n.loader.end(t)})},getAll:function(){var e=this.rankFilter(i.data),n=t(e,6);return i.page=n.length,n},countFiltered:function(){for(var e=[],t=i.data||[],n=0;n<t.length;++n)t[n].filtered&&e.push(t[n]);return e.length},getNew:function(){for(var e=[],n=0;n<i.count;++n)i.data[n].status||e.push(i.data[n]);var r=t(this.rankFilter(e),6);return i.page=r.length,r},setFilter:function(e){r=e},rankFilter:function(e){var t=[];if("none"==r){for(var n=r.split("-")[1],i=0;i<e.length;++i)e[i].filtered||t.push(e[i]);return t}if(/^level/.test(r)){for(var n=r.split("-")[1],i=0;i<e.length;++i)e[i].level!=n||e[i].filtered||t.push(e[i]);return t}if(/^has_/.test(r)){for(var i=0;i<e.length;++i)e[i][r]&&!e[i].filtered&&t.push(e[i]);return t}if("filtered"==r){for(var i=0;i<e.length;++i)e[i].filtered&&t.push(e[i]);return t}return e},syncWatch:function(e,t,n){return i.data[e].watch_status=t,n},getPage:function(){return i.page}}}(),n.init=function(){n.$template=e("#template-slider").html(),n.$container=e(".analyse-result-slider"),n.$switcher=e(".analyse-switch"),n.$filterRank=e(".filter-rank"),e(".analyse-switch >a").on("click",function(t){var i=e(this);t.preventDefault(),i.parent().find(".curr").removeClass("curr");var r=i.siblings().addClass("curr");n.switcher.choose(r.data("filter"))}),n.$container.on("click",".item-action a",function(t){t.preventDefault();var i="action-pending",r=e(this),a=r.parent();if(a.hasClass(i))return!1;a.addClass(i);var s=e(this).parents(".analyse-result-list"),o=s.data("index"),c=s.data("id");r.parent().hasClass("action-fav")?n.addfav(o,c,function(){s.addClass("favorite"),a.removeClass(i)}):r.parent().hasClass("action-faved")&&n.delfav(o,c,function(){s.removeClass("favorite"),a.removeClass(i)})})},n.switcher=function(){return{choose:function(e){this.show(),n.fillWith(n.service["new"==e?"getNew":"getAll"]())},show:function(){n.$switcher.show(),n.$filterRank.show()},hide:function(){n.$switcher.hide(),n.$filterRank.hide()}}}(),n.loader=function(){var t=e(".loading"),i=(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,function(){}),r=3,a=0,s=25e3,o=void 0;return{show:function(){function e(m){var g=+new Date-a;return g>9e3&&(r=0===o?0:22),g>s?(t.css({border:"none",transform:"none"}).html('<a href="javascript:window.location.reload();void(0);">重新加载试试?</a>'),void 0):v>=h?(n.loader.hide(),void 0):(l.clearRect(0,0,c.width,c.height),l.beginPath(),l.arc(d,u,f,-w,p*m-w,!1),l.stroke(),v++,setTimeout(function(){setTimeout(function(){e(v/100),i.html((v>100?100:v)+"%")},v*r)}),void 0)}t.fadeIn();var i=t.find("span"),c=document.getElementById("loading-counter"),l=c.getContext("2d"),d=c.width/2,u=c.height/2,f=75,h=100,v=0,p=2*Math.PI,w=Math.PI/2;l.lineWidth=5,l.strokeStyle="#999",l.shadowOffsetX=0,l.shadowOffsetY=0,l.shadowBlur=2,l.shadowColor="#FFF",a=+new Date,e(0)},end:function(e){i=e,o=0,s=1e5},hide:function(){t.fadeOut("fast"),i()}}}(),n.loader.show(),n.fillWith=function(e){n.$container.html(t.template(n.$template,{pages:e})),n.slidify()},n.slidify=function(){e(".slider-prev, .slider-next").remove();var t=function(e,t){var n=e;return{prev:function(){return e>=n?n=t:--n},next:function(){return n>=t?n=e:++n},curr:function(e){return n=void 0===e?n:e}}},i=n.$container.find(".slider-container").css("position","relative"),r=n.$container.find(".analyse-slider-nav>span").length,a=1302,s=e('<span class="slider-prev"></span>').appendTo("#main").hide(),o=e('<span class="slider-next"></span>').appendTo("#main");r||(s.hide(),o.hide());var c=t(0,r-1),l=function(e){{var t=-1*a*e+"px";c.curr()}i.stop().css({left:t}),e>0?s.show():s.hide(),e==r-1?o.hide():o.show()};s.on("click",function(){n.$container.find(".analyse-slider-nav>span").eq(c.prev()).click()}),o.on("click",function(){n.$container.find(".analyse-slider-nav>span").eq(c.next()).click()}),n.$container.find(".analyse-slider-nav>span").each(function(t){e(this).on("click",function(){l(t),e(".analyse-slider-nav .curr").removeClass("curr"),e(this).addClass("curr")})})},n.addfav=function(t,i,r){e.get("/resumes/add_watch/"+i,n.service.syncWatch(t,!0,r))},n.delfav=function(t,i,r){e.get("/resumes/remove_watch/"+i,n.service.syncWatch(t,!1,r))},n.service.ready(function(){n.init(),n.switcher.choose("all"),e("#filtered-count").html(n.service.countFiltered()),e(".filter-rank >a").on("click",function(){e(this).parent().find(".curr").removeClass("curr"),e(this).addClass("curr"),n.service.setFilter(e(this).data("filter"));var t=n.$switcher.find(".curr").data("filter");return n.switcher.choose(t),!1})}),e(document).on("keyup",function(t){37==t.keyCode?e(".slider-prev:visible").length&&e(".slider-prev").click():39==t.keyCode&&e(".slider-next:visible").length&&e(".slider-next").click()})}(jQuery,_);