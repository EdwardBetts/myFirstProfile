$.SetKeyword=function(t,e){var i=function(t){return new i.prototype.init(t)};return i.prototype={init:function(t){this.setting=t,__setKeyword=this,this.addHtml(),this.bindEvent()},escEvent:function(t){27==t.keyCode&&__setKeyword.close()},bindEvent:function(){t(window).on("keyup",window,__setKeyword.escEvent)},add:function(){return html='<tr><td class="flag-td">'+(t(".editbox-table tbody tr").length+1)+'</td><td><div><input ></div></td><td><div><input></div></td><td><div><input></div></td><td class="action-td"><div><a href="javascript:;" onclick="__setKeyword.remove( this );">删除</a></div></td></tr>',html},addNew:function(){var e=this.add();t(".editbox-table tbody").append(e)},remove:function(e){t(e).closest("tr").remove(),this.order()},order:function(){var e=t(".flag-td");e.each(function(t,e){this.innerHTML=t+1})},addHtml:function(){var e=function(t){var i="";if(!e.length)return i=this.add();for(var d=0,a=t.length;a>d;d++){var s=t[d];i+='<tr data-op_time="'+(s.op_time||"")+'" data-username="'+(s.username||"")+'"><td class="flag-td">'+(d+1)+'</td><td><div><input value="'+("object"==typeof s.necessary_keywords?s.necessary_keywords.join(" "):s.necessary_keywords)+'"></div></td><td><div><input value="'+("object"==typeof s.latent_semantic_keywords?s.latent_semantic_keywords.join(" "):s.latent_semantic_keywords)+'"></div></td><td><div><input value="'+("object"==typeof s.exclude_job_keywords?s.exclude_job_keywords.join(" "):s.exclude_job_keywords)+'"></div></td><td class="action-td"><div><a href="javascript:;" onclick="__setKeyword.remove( this );">删除</a></div></td></tr>'}return i},i='<div class="wp-popup"><div class="popup popup-enter"><div class="popup-loading" id="JS_loading_img" style="display:none;"></div><div class="popup-hd clearfix"><h3 class="popup-title">添加备注(多个词可用逗号或空格隔开，不要标点符号)</h3><span class="span-switch"><input type="checkbox" id="switch1" name="switch1" class="switch" '+("true"==this.setting.ignored.toString()?'checked="checked"':"")+'><label for="switch1">屏蔽关键词</label> </span></div><div class="popup-bd"><div id="editbox"><div class="editbox-table"><table><thead><tr><th class="flag-th">◊</th><th>必填词</th><th>加分词</th><th>屏蔽词</th><th class="action-th">操作</th></tr></thead><tbody>'+e(this.setting.remarks)+'</tbody></table></div></div> </div><div class="popup-action" style="display: block;"><a href="javascript:;" class="action-add" onclick="__setKeyword.addNew();">+ 新增条件</a> <a href="javascript:;" class="action-ok" onclick="__setKeyword.save();">保存</a> <a href="javascript:;" class="action-cancel" onclick="__setKeyword.close();">取消</a> </div></div> </div>';t("body").append(i)},save:function(){var e=t(".editbox-table tbody tr"),i={remarks:[]},d=this;i.ignored=t("#switch1").prop("checked");for(var a=0,s=e.length;s>a;a++){var o=e.eq(a),n={},r=o.attr("data-op_time")||"",c=o.attr("data-username")||"",l=o.find("input")[0].value,p=o.find("input")[1].value,v=o.find("input")[2].value;n.necessary_keywords=l,n.latent_semantic_keywords=p,n.exclude_job_keywords=v,n.op_time=r,n.username=c,i.remarks.push(n)}i.___=(new Date).getTime();var u=JSON.stringify(i),_=[];for(var a in i.remarks)i.remarks.hasOwnProperty(a)&&""!=i.remarks[a].necessary_keywords.trim()&&_.push(i.remarks[a]);console.log("tempRemarks",_),_.length>=0?(i.remarks=_,u=JSON.stringify(i),t.post("/feed/edit_remarks/"+d.setting.feed_id+"/",u,function(e){if(t("#JS_loading_img").hide(),e&&"ok"==e.status){var a=t(".JS_set_keyword");a.each(function(t,e){var s=a.eq(t);return s.attr("data-feedid")==d.setting.feed_id?(delete i.__,delete i.feed_id,s.attr("data-remarks",JSON.stringify(i)),!1):void 0}),d.close()}else e&&e.msg?alert(e.msg):alert("请求失败！")},"json").fail(function(){alert("请求失败！"),t("#JS_loading_img").hide()}),t("#JS_loading_img").show()):this.close()},close:function(){t(".wp-popup").remove(),t(window).off("keyup",__setKeyword.escEvent),__setKeyword=null}},i.prototype.init.prototype=i.prototype,function(t){i(t)}}(jQuery);