!function(e){var o=angular.module("app.point_recharge",["app.config","ui.router","app.django","app.utils","app.filter"]),t=angular.injector(["app.django","app.utils"]),n=t.get("tmpl"),a=(t.get("static_url"),t.get("mockTest"),t.get("mockTestWithCoin")),r=(t.get("confirmBox"),t.get("alertBox")),i=(t.get("getModeData"),t.get("postModeData"),t.get("inArray"),t.get("orderPay"));o.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,o,t){var a="/";o.otherwise(a),e.state("pointRecharge",{url:"/",templateUrl:n("payment/point_recharge.html"),controller:"pointRecharge"}),e.state("pointRechargeOk",{url:"/ok/",templateUrl:n("payment/point_recharge_ok.html"),controller:"pointRechargeOk"})}]),o.factory("fPointRecharge",function(){return{loading:!0,logList:{},myPoint:0,myCoin:0,modeFee:0}}),o.run(["$rootScope","$templateCache",function(e,o){e.$on("$viewContentLoaded",function(){o.removeAll()})}]),o.controller("pointRecharge",["$scope","$http","$state","$templateCache","fPointRecharge",function(e,o,t,n,s){e.loading=s.loading,e.loadingThis=!0,e.myPoint=0,e.coin=0,e.modeFee=100,e.modePoint=50,e.modeCoin=0,e.modeResume=5,e.userCoin=!1,s.modeFee=e.modeFee,s.modePoint=e.modePoint,s.modeResume=e.modeResume,$(".layout").attr("data-point").match(/([0-9]+)$/i)&&(e.myPoint=parseInt(RegExp.$1),s.myPoint=e.myPoint),$(".layout").attr("data-coin").match(/([0-9]+)$/i)&&(e.coin=a?100:parseInt(RegExp.$1),s.myCoin=e.coin),e.payMethod="alipay",e.chargeSuccess=!1,e.modeListMinor=[{id:1,point:50,price:100,oldPrice:0,resume:5}],e.hoverMe=function(e,o){o===!0?$(e.currentTarget).addClass("hover"):$(e.currentTarget).removeClass("hover")},e.choosePayMethod=function(o,t){e.payMethod=t,$(o.currentTarget).hasClass("active")?$(o.currentTarget).removeClass("active"):($(".user-mode-pay").removeClass("active"),$(o.currentTarget).addClass("active"))},e.clickMode=function(o,t,n,a,r){$(".user-mode-small-point-"+t).hasClass("selected")?(e.modeFee=0,e.modePoint=0,e.modeResume=0,$(".user-mode-small-point").removeClass("selected"),s.modeFee=e.modeFee,s.modePoint=e.modePoint,s.modeResume=e.modeResume):(e.modeFee=a,e.modePoint=n,e.modeResume=r,$(".user-mode-small-point").removeClass("selected"),$(".user-mode-small-point-"+t).addClass("selected"),s.modeFee=e.modeFee,s.modePoint=e.modePoint,s.modeResume=e.modeResume)};var c=function(o){var t=$("#userCoin").prop("checked")===!0?"金币":"元";$.LayerOut({html:r('<span class="pay-alert"></span><span class="pay-title">需要您的确认！</span>',"",'您选购了：<span class="cf46c62">'+e.modePoint+'</span> 聘点<br>需要支付：<span class="cf46c62">'+e.modeFee+"</span> "+t,"确认购买"),afterClose:function(){}}),$(".modal").undelegate(".btn-click-ok").delegate(".btn-click-ok","click",function(e,t){$._LayerOut.close(),"function"==typeof o&&o()})};e.paynow=function(){console.log("payMethod",e.payMethod),c(function(){if(console.log("confirmPayByCoin",1),s.modeFee<1)return $(".agreement-error").text("请选择购买套餐！").css("display","block"),!1;if($(".agreement-error").text("").css("display","none"),""==e.payMethod)return $(".agreement-error").text("请选择支付方式！").css("display","block"),!1;if($(".agreement-error").text("").css("display","none"),e.coin>e.modeFee&&$("#userCoin").prop("checked")===!0)var n="pinbot_point",a="coin",r={product_type:n,num:1,pid:1,payment_terms:a,is_insurance:0};else var n="pinbot_point",a="alipay",r={product_type:n,num:1,pid:1,payment_terms:a,is_insurance:0};i(e,t,o,$,r,"pointRechargeOk")})}}]),o.controller("pointRechargeOk",["$scope","$http","$state","fPointRecharge",function(e,o,t,n){e.modeFee=n.modeFee,e.modePoint=n.modePoint,e.modeCoin=n.modeCoin,e.modeResume=n.modeResume}])}();