!function(e){var t=angular.module("app.my_package",["app.config","ui.router","app.django","app.utils","app.filter"]),r=angular.injector(["app.django","app.utils"]),a=r.get("tmpl"),i=(r.get("static_url"),r.get("mockTest"),r.get("mockTestWithCoin"),r.get("confirmBox"),r.get("confirmBoxRed"),r.get("alertBox"),r.get("getModeData")),o=(r.get("postModeData"),r.get("inArray")),n=r.get("pbFunc"),s=r.get("orderPay");t.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,r){var i="/";t.otherwise(i),e.state("myPackageDiyResume",{url:"/diy_resume/:orderId",templateUrl:a("payment/my_package_diy_resume.html"),controller:"myPackageDiyResume"}),e.state("myPackage",{url:"/",templateUrl:a("payment/my_package.html"),controller:"myPackage"}),e.state("myPackageDiyResumePay",{url:"/diy_resume_pay/",templateUrl:a("payment/my_package_diy_resume_pay.html"),controller:"myPackageDiyResumePay"}),e.state("userModeDiyResumeOk",{url:"/diy_resume_ok/",templateUrl:a("payment/my_package_diy_resume_ok.html"),controller:"userModeDiyResumeOk"}),e.state("userModeDiyResumeFailed",{url:"/diy_resume_failed/",templateUrl:a("payment/my_package_diy_resume_failed.html"),controller:"userModeDiyResumeFailed"})}]),t.factory("fMyPackage",function(){return{loading:!0,logList:{},vipName:"",feedCount:0,pinbotPoint:0,id:0,monthPrice:0,payPrice:0,servicePeriod:"",serviceNow:"",serviceExpired:"",serviceNowTs:0,serviceExpiredTs:0,orderId:"",userInfo:{}}}),t.run(["$rootScope","$templateCache",function(e,t){e.$on("$viewContentLoaded",function(){t.removeAll()})}]),t.controller("myPackage",["$scope","$http","$state","$templateCache","fMyPackage",function(e,t,r,a,s){e.loading=s.loading,e.loadingThis=!0,e.chgStatus="all",e.api_url="/payment/service_list/",e.api_params=[],e.api_params_values={},e.listStatus=function(r,a){var i=$(r.currentTarget);$(".trade-status li").removeClass("active"),i.parent().addClass("active"),e.chgStatus=a,e.loadingThis=!0,a.toString().match(/^(applying|success|refund|cancel_refund|refunded|closed|canceled|deleted|expired|finished)$/i)?(o("status",e.api_params)||e.api_params.push("status"),e.api_params_values.status=a):"all"==a&&e.api_params.pop("status"),n.reloadList(t,e,s)},e.nextPage=function(r){n.nextPage(t,e,$,s,r)},e.defaultOrderStatus=function(e){var e=e.trim();return"申请中"!=e&&"已开通"!=e&&"退款中"!=e&&"取消退款"!=e&&"退款成功"!=e&&"已关闭"!=e&&"已取消"!=e&&"已删除"!=e&&"已过期"!=e&&"已完结"!=e?!0:!1},e.normalStatus=function(e){var e=e.trim();return"已开通"==e||"申请中"==e||"退款中"==e?!0:!1},e.showOpt=function(e){var t=$(e.currentTarget);if(t.parent().parent().find(".select-btn-opts")){var r=$(t.parent().parent().find(".select-btn-opts"))[0];"none"==$(r).css("display")?($(r).css("display","block"),t.removeClass("arrow-close")):($(r).css("display","none"),t.addClass("arrow-close"))}},e.showDoApply=function(e){return"申请中"==e?($.Menu(),!0):!1},e.doCancel=function(r){n.orderActConfirm(t,e,$,'<span class="pay-alert"></span><span class="pay-title">取消订单</span>',"订单取消后，聘宝将不再为您提供相关服务","重新购买","确认取消",function(){document.location.href="/vip/role_info/"},function(){n.orderAct(t,e,$,s,r,"/vip/order/cancel/")})},e.doRefund=function(r){var a=$(r.currentTarget),i=a.attr("data-oid");n.orderActGet(t,e,$,s,r,"/vip/order/pre_refund/"+i,function(a){var i="";i+='<div class="price content box-content box-content-table box-content-table-box box-content-table-box50 pd-top-0 lh180">',i+='<div class="box-col box-col-center"><div class="user-mode"><div class="box-col-bar"></div><ul>',i+='<li class="text-center"><span>服务期</span><span>第<span class="cf46c62">'+a.data.service_months+"</span>个月</span></li>",i+='<li class="text-center"><span>退款比例</span><span><span class="cf46c62">'+a.data.refund_percent+"</span></span></li>",i+="</ul></div></div></div>",i+='<div class="price content box-content pd-top-0 text-center"><span class="c607d8b f14"><span class="price-focus-txt">实际退款金额，请咨询您的顾问</span><br></div>',n.orderActAlert(t,e,$,'<span class="pay-alert"></span><span class="pay-title">你正在申请退款！</span>',"退款提交后，请等待聘宝人才顾问与您沟通并核对信息",i,"确认",function(){n.orderAct(t,e,$,s,r,"/vip/order/refund/",function(e){})})})},e.doResumeDiyPackage=function(e,t){document.location.href="/payment/my_package/#/diy_resume/"+t},e.chkUserNeedContact=function(e){return"已开通"==e?($.Menu(),!0):!1},e.chkUserNeedContact2=function(e){return"退款中"==e?($.Menu(),!0):!1},e.doContact=function(e){},e.cancelRefund=function(r){n.orderActConfirm(t,e,$,'<span class="pay-alert"></span><span class="pay-title">取消退款</span>',"退款取消后，聘宝人才顾问将继续为您提供相关服务","返回","确认取消",null,function(){n.orderAct(t,e,$,s,r,"/vip/order/cancel_refund/")})},e.doRebuy=function(e){document.location.href="/vip/role_info/"},e.doDelete=function(r){n.orderAct(t,e,$,s,r,"/vip/order/delete/")},e.doResume=function(e){document.location.href="/vip/role_info/"},i(t,e.api_url,"",function(t){e.loadingThis=!1,s.logList=t,s.loading=!1,e.loading=s.loading,e.logList=s.logList})}]),t.controller("myPackageDiyResume",["$q","$stateParams","$scope","$http","$state","$templateCache","fMyPackage",function(e,t,r,a,i,o,s){r.loading=s.loading,r.loadingThis=!0,r.chgStatus="all",r.orderId=t.orderId,r.servicePeriodList=[{n:3,selected:!0},{n:4,selected:!1},{n:5,selected:!1},{n:6,selected:!1},{n:7,selected:!1},{n:8,selected:!1},{n:9,selected:!1},{n:10,selected:!1},{n:11,selected:!1},{n:12,selected:!1}],r.servicePeriod="",r.serviceNow="",r.serviceExpired="",r.serviceNowTs=0,r.serviceExpiredTs=0,r.feedCount=0,r.id=0,r.monthPrice=0,r.pinbotPoint=0,r.vipName="",r.payPrice=0,r.payMethod="alipay",r.payType="diy",r.paynow=function(){i.go("myPackageDiyResumePay",{})},r.$watch("payPrice",function(e,t){e!=t&&(s.payPrice=r.payPrice,s.servicePeriod=r.servicePeriod)});var c=n.getDataWithPromise(e,a,"/vip/renew/info/"+r.orderId+"/");c.then(function(e){r.servicePeriod="3",r.serviceNowTs=e.data.expire_time.$date,r.serviceExpiredTs=e.data.expire_time.$date,r.serviceNow=n.formatDate("yyyy-MM-dd hh:mm:ss",r.serviceNowTs);var t=n.getExpiredDateArr(r.serviceNowTs,parseInt(r.servicePeriod));r.serviceExpiredTs=t[0],r.serviceExpired=t[1],r.feedCount=e.data.feed_count,r.id=e.data.id,r.monthPrice=e.data.month_price,r.pinbotPoint=e.data.pinbot_point,r.vipName=e.data.vip_name,r.payPrice=parseInt(r.servicePeriod)*parseInt(e.data.month_price),s.vipName=r.vipName,s.feedCount=r.feedCount,s.id=r.id,s.monthPrice=r.monthPrice,s.pinbotPoint=r.pinbotPoint,s.payPrice=r.payPrice,s.servicePeriod=r.servicePeriod,s.serviceNow=r.serviceNow,s.serviceExpired=r.serviceExpired,s.serviceNowTs=r.serviceNowTs,s.serviceExpiredTs=r.serviceExpiredTs,s.orderId=r.orderId},function(e){alert("暂无套餐信息，无法续期。"),history.go(-1)})}]),t.controller("myPackageDiyResumePay",["$q","$scope","$http","$state","fMyPackage",function(e,t,r,a,i){if(t.loadingThis=!0,t.userCoin=!1,t.payType="diy",""==i.servicePeriod||""==i.orderId)return document.location.href="/payment/my_account/",!1;var o=n.getDataWithPromise(e,r,"/vip/get_user_info/");o.then(function(e){t.loadingThis=!1,i.userInfo=e,t.userInfo=i.userInfo,t.modeFee=i.payPrice},function(e){alert("获取用户信息失败，请稍后再试！"),history.go(-1)}),t.hoverMe=function(e,t){t===!0?$(e.currentTarget).addClass("hover"):$(e.currentTarget).removeClass("hover")},t.choosePayMethod=function(e,r){t.payMethod=r,$(e.currentTarget).hasClass("active")?$(e.currentTarget).removeClass("active"):($(".user-mode-pay").removeClass("active"),$(e.currentTarget).addClass("active")),$(".agreement-error").text("").css("display","none")},t.paynow=function(){if("diy"==t.payType){var e={renew_month:parseInt(i.servicePeriod)};s(t,a,r,$,e,"userModeDiyResumeOk","/vip/renew/create/"+i.orderId+"/","json","userModeDiyResumeFailed")}},t.paynowold=function(){if(""==t.payMethod)$(".agreement-error").text("请先选择支付方式！").css("display","block");else if($(".agreement-error").text("").css("display","none"),"diy"==t.payType){var e=fUserMode.currentOrderData.order_info.product_type,i="alipay";i=t.coin>t.modeFee&&$("#userCoin").prop("checked")===!0?"coin":"alipay";var o=0,n={product_type:e,num:1,pid:t.payPid,payment_terms:i,is_insurance:o};pbDebug&&console.log("postData",fUserMode,n),s(t,a,r,$,n,"userModeDiyPayOk")}},$.Menu()}]),t.controller("userModeDiyResumeOk",["$scope","$http","$state","fMyPackage",function(e,t,r,a){e.reload=function(){document.location.href="/payment/my_package/"},""==a.vipName&&(document.location.href="/payment/my_account/"),e.vipName=a.vipName,e.feedCount=a.feedCount,e.pinbotPoint=a.pinbotPoint,e.serviceExpired=a.serviceExpired,e.orderId=a.orderId}]),t.controller("userModeDiyResumeFailed",["$scope","$http","$state","fMyPackage",function(e,t,r,a){e.reload=function(){document.location.href="/payment/my_account/"},""==a.vipName&&(document.location.href="/payment/my_account/"),e.vipName=a.vipName,e.feedCount=a.feedCount,e.pinbotPoint=a.pinbotPoint,e.serviceExpired=a.serviceExpired,e.orderId=a.orderId}]),t.directive("servicePeriod",["$templateCache",function(e){return{restrict:"E",templateUrl:"/static/users/servicePeriod.html",scope:{servicePeriodList:"=",orderId:"=",monthPrice:"="},replace:!0,controller:["$scope","$element",function(e,t){e.chooseServicePeriod=function(t,r){for(var a=(t.currentTarget,0),i=e.$parent.servicePeriodList.length;i>a;a++)if(e.$parent.servicePeriodList[a].selected=!1,e.$parent.servicePeriodList[a].n==r){e.$parent.servicePeriodList[a].selected=!0,e.$parent.servicePeriod=""+r;var o=n.getExpiredDateArr(e.$parent.serviceNowTs,parseInt(r));e.$parent.serviceExpiredTs=o[0],e.$parent.serviceExpired=o[1],e.$parent.payPrice=parseInt(r)*parseInt(e.$parent.monthPrice)}}}]}}])}();