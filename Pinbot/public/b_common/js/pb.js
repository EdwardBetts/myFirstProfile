var PB=function(){return{debug:!1,setCookie:function(e,t,n){var n=void 0!=n&&"number"==typeof n?n:864e5,o=new Date;o.setTime(o.getTime()+n),document.cookie=e+"="+t+";expires="+o.toUTCString()+";path=/;"},jumpTo:function(e){var t=$(e).offset().top;void 0!=t&&"number"==typeof t&&$(window).scrollTop(t)},getCookie:function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},fakePromise:function(e,t){var n=$.Deferred();return void 0!=t&&"ok"==t?n.resolve(e):n.reject(e),n.promise()},et:function(e,t,n,o){e.prototype=t,t.apply(n,o)},request:function(e,t,n,o,r,i,a){var n=void 0!=n&&"string"==typeof n&&"post"==n?"post":"json",a=void 0!=a&&"string"==typeof a&&"post"==a?"post":"json",e=void 0!=e&&"string"==typeof e&&"post"==e?"post":"get",s=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=""==t?""+n+"="+e[n]:"&"+n+"="+e[n]);return t},l=function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},c={url:t,type:e,cache:!1,headers:{"X-CSRFToken":l("csrftoken")},success:function(e){"function"==typeof o&&o(e)},error:function(e,t){"function"==typeof r&&r(e,t)}};"json"==n&&(c.dataType="json"),"post"==e&&("json"==a?(c.headers["Content-Type"]="application/json",c.data=JSON.stringify(i)):c.data=s(i));return $.ajax(c)},formErrHandler:function(e,t,n,o,r){var i=this,a=e.errors;if(a){console.log("errors",a);var s=0;for(var l in a){if(a.hasOwnProperty(l)){0==s&&("code"==l&&0==$("#"+l).length?$("#smscode").length?$("#smscode").focus():$("#code-email").length&&$("#code-email").focus():"email"==l&&0==$("#"+l).length?$("#to-chg-email").length&&$("#to-chg-email").focus():"phone"==l&&0==$("#"+l).length?$("#new-phone").length&&$("#new-phone").focus():$("#"+l).focus());var c="object"==typeof a[l]?a[l][0]:a[l];"code"==l&&0==$("#"+l).length?$("#smscode").length?$("#smscode-error").html(c).css("display","block"):$("#code-email").length&&($("#code-email-title-error").css("display","block"),$("#code-email-error").html(c).css("display","block")):"email"==l&&0==$("#"+l).length?$("#to-chg-email").length&&($("#to-chg-email-title-error").css("display","block"),$("#to-chg-email-error").html(c).css("display","block")):"phone"==l&&0==$("#"+l).length?$("#new-phone").length&&($("#new-phone-title-error").css("display","block"),$("#new-phone-error").html(c).css("display","block")):($("#"+l+"-error").html(c).css("display","block"),$("#"+l+"-title-error").length&&$("#"+l+"-title-error").css("display","block"))}s++}"function"==typeof n&&n(e)}else void 0!=e.status&&"ok"!=e.status?void 0!=o&&i.btnAlert(o,e.msg,r):"function"==typeof t&&t(e)},func:function(){},captcha:function(e){$(e).html('<img title="看不请？点击刷新" name="code" src="/users/get_check_code_image/" alt="点击刷新" width="135px" height="40px" />'),$(e).find("img").on("click",function(e){var t=$(this).attr("src")+"?t="+ +new Date;$(this).attr("src",t)})},box:function(e,t,n,o,r,i,a,s){var l=this;if($.LayerOut({closeByShadow:!1,html:e}),l.close=function(){$(".modal-backdrop,.modal").remove(),delete $._LayerOut},e.match(/use\-captcha/i)&&l.captcha(".no-feed-alert .use-captcha"),e.match(/use\-sms\-code/i)&&void 0!=r)l.smsCodeHtml(".no-feed-alert .use-sms-code",r,a,i,s);else if(e.match(/use\-email\-code/i)&&void 0!=r&&r.match(/ /i)){var c=[];"string"==typeof r&&(c=r.split(" ")),2==c.length&&l.emailCodeHtml(".no-feed-alert .use-email-code",c[0],c[1],a,i)}$(".closeLayer").on("click",function(){$(".modal-backdrop,.modal").remove(),delete $._LayerOut,"function"==typeof o&&o($(this))}),$(t).on("click",function(){"function"==typeof n&&n($(this),l)})},btnAlert:function(e,t,n,o){var r=$(e).html();void 0!=n&&"string"==typeof n&&(r=n);var o=void 0!=o&&"string"==typeof o?o:"#cccccc",i=$(e).css("background-color");$(e).css("background-color",o),$(e).html("").hide(),$(e).html('<span class="error">'+t+"</span>").fadeIn(200).delay(1e3).fadeOut(200,function(){$(e).css("background-color",i),$(e).html(r).fadeIn(200)})},getSmsCode:function(e,t,n,o){var r=this,o=void 0!=o&&"string"==typeof o?o:"AccountReg";$(".smscode").focus();var i=r.request("post","/users/send_sms_code/","json",function(e){r.formErrHandler(e,function(e){return!0},null,t,n)},function(e,o){r.formErrHandler(e,function(e){return!1},null,t,n)},{action_name:o,mobile:e},"json");return i},smsCodeHtml:function(e,t,n,o,r){var i=this;$(e).append('<button type="button" class="btn btn-blue-submit-small smscode"><span>获取验证码</span></button>');var a=$(".smscode",e).html();$(e).undelegate(".smscode","click").delegate(".smscode","click",function(s){var l=$(this),c=60;if(!$("#"+t).prop("value").match(/^1[0-9]{10}$/i))return $("#"+t+"-error").length?$("#"+t+"-error").text("请输入手机号码！").show():i.btnAlert(".smscode","请输入手机号码！",a),!1;$("#"+t+"-error").length&&($("#"+t+"-error").text("").hide(),$("#"+t+"-title-error").hide());var d,p=$("#"+t).prop("value"),u=!1,f=0;return l.prop("disabled")||(d=i.getSmsCode(p,".smscode",a,r),d.fail(function(){u=!0})),l.prop("disabled",!0),$(".smscode",e).html('<span><span class="count-down">'+c+"</span>s后重新获取</span>"),n=setInterval(function(){var t=$(".smscode .count-down",e).text();t.match(/[0-9]/i)||(t="0"),f=parseInt(t),f--,0>=f?(clearInterval(n),l.prop("disabled",!1),u||$(".smscode",e).html(a),o=!0):$(".smscode .count-down",e).text(f)},1e3),!1})},getEmailCode:function(e,t,n,o){var r=this;$(".emailcode").focus();var i=r.request("post","/users/send_email_code/","json",function(e){r.formErrHandler(e,function(e){return!0},null,n,o)},function(e,t){r.formErrHandler(e,function(e){return!1},null,n,o)},{password:e,email:t},"json");return i},emailCodeHtml:function(e,t,n,o,r){var i=this;$(e).append('<button type="button" class="btn btn-blue-submit-small emailcode"><span>获取邮箱验证码</span></button>');var a=$(".emailcode",e).html();$(e).undelegate(".emailcode","click").delegate(".emailcode","click",function(s){var l=$(this),c=60;if($("#"+t).prop("value").trim().length<6)return $("#"+t+"-error").length?$("#"+t+"-error").text("请输入登录密码！").show():i.btnAlert(".emailcode","请输入登录密码！",a),!1;if(!i.isValidEmail($("#"+n).prop("value")))return $("#"+n+"-error").length?$("#"+n+"-error").text("请输入邮箱！").show():i.btnAlert(".emailcode","请输入邮箱！",a),!1;$("#"+t+"-error").length&&($("#"+t+"-error").text("").hide(),$("#"+t+"-title-error").hide(),$("#"+n+"-error").text("").hide(),$("#"+n+"-title-error").hide());var d,p=$("#"+t).prop("value"),u=$("#"+n).prop("value"),f=!1,m=0;return l.prop("disabled")||(d=i.getEmailCode(p,u,".emailcode",a),d.fail(function(){console.log("promise_err",d),f=!0})),l.prop("disabled",!0),$(".emailcode",e).html('<span><span class="count-down">'+c+"</span>s后重新获取</span>"),o=setInterval(function(){var t=$(".emailcode .count-down",e).text();t.match(/[0-9]/i)||(t="0"),m=parseInt(t),m--,0>=m?(clearInterval(o),l.prop("disabled",!1),f||$(".emailcode",e).html(a),r=!0):f||$(".emailcode .count-down",e).text(m)},1e3),!1})},formSerializeToObject:function(e){var t=e.serializeArray(),n={},o=function(e){var t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null};return $.map(t,function(e,t){var r=e.name;if(n.hasOwnProperty(r)){var i=n[r];"object"==typeof n[r]?n[r].push(e.value.trim()):(n[r]=[],n[r].push(i),n[r].push(e.value.trim()))}else n[r]=e.value.trim();if("select_fields"==r&&"string"==typeof n[r]){var i=n[r];n[r]=[],n[r].push(i)}if(!n.hasOwnProperty("next")&&document.location.href.toString().match(/next=([0-9a-z_#&:=%\/\.\-]+)/i)){var a=RegExp.$1;n.next=a}n.hasOwnProperty("csrftoken")&&n.csrftoken!=o("csrftoken")&&(n.csrftoken=o("csrftoken")),n.hasOwnProperty("csrfmiddlewaretoken")&&n.csrfmiddlewaretoken!=o("csrftoken")&&(n.csrfmiddlewaretoken=o("csrftoken"))}),n},isValidEmail:function(e){return null!=e.match(/^[0-9a-z\._\+\-]+@[0-9a-z\._\+\-]+$/i)},validateFormSubmit:function(e,t,n,o,r,i,a,s){var l=this,s=void 0!=s&&"string"==typeof s?s:"json";e.validate(t);if($btn=$(n),e.valid()){$btn.attr("disabled","true");var c=l.formSerializeToObject(e);"function"==typeof o&&(c=o(c));var d=l.request("post",r,"json",function(e){$btn.removeAttr("disabled"),l.formErrHandler(e,function(e){"function"==typeof i&&i(e)},null,n,a)},function(e,t){return l.btnAlert(n,"系统错误，无法登录。",a),!1},c,s);return d}},modalLine3Col:function(e,t,n,o,r,i){var n=void 0!=n&&"string"==typeof n&&"password"==n?"password":"text",o=void 0!=o&&"string"==typeof n?o:"",r=void 0!=r&&"string"==typeof r?r:"",i=void 0!=i&&"string"==typeof i?i:"",a="";return a+=o?'<p class="tip line '+r+'"><span class="line-title line-width-33">'+e+'：</span><span class="line-input line-width-33"><input type="'+n+'" class="'+t+' dark-border" name="'+t+'" id="'+t+'" value="'+i+'"></span><span class="line-input line-width-33 '+o+'"></span><span id="'+t+'-title-error" class="line-title line-width-33 invalid" style="display:none;"></span><span id="'+t+'-error" class="line-input line-width-66 invalid" style="display:none;"></span></p>':'<p class="tip line '+r+'"><span class="line-title line-width-33">'+e+'：</span><span class="line-input line-width-66"><input type="'+n+'" class="'+t+' dark-border" name="'+t+'" id="'+t+'" value="'+i+'"></span><span id="'+t+'-title-error" class="line-title line-width-33 invalid" style="display:none;"></span><span id="'+t+'-error" class="line-input line-width-66 invalid" style="display:none;"></span></p>'},chgNotifyEmail:function(e,t,n){var o=this,r="确认修改",i=$(".current-email").text();o.isValidEmail(i)||(i="");var a='<div class="no-feed-alert"><h2><i class="i-warning"></i>修改简历接收邮箱</h2>'+o.modalLine3Col("请输入登录密码","login-passwd","password",null,"mg-top-30")+o.modalLine3Col("请输入新的邮箱","to-chg-email","text",null,null,i)+o.modalLine3Col("请输入邮箱验证码","code-email","text","use-email-code")+'<p class="tip line mg-bottom-30"><span class=" line-width-100">该邮箱仅用于接收简历推荐，不用于登录，您可至“<a class="c42b4e6" href="/users/profile/">个人设置</a>”中修改</span></p><p><a class="btn confirm chg-email-now" href="javascript:void(0);">确认修改</a></p></div>';o.box(a,".chg-email-now",function(e,t){var i=e.parent().parent().find(".to-chg-email").prop("value"),a=e.parent().parent().find(".code-email").prop("value"),s=e.parent().parent().find(".login-passwd").prop("value");return""==$.trim(s)?(o.labelErr("login-passwd","请输入登录密码！"),e.parent().parent().find(".login-passwd").focus(),!1):o.isValidEmail(i)?""==$.trim(a)?(o.labelErr("code-email","请输入邮箱验证码！"),e.parent().parent().find(".code-email").focus(),!1):($(".chg-email-now").attr("disabled","true"),void o.request("post","/users/change_notify_email/","json",function(e){$(".chg-email-now").removeAttr("disabled"),"function"==typeof n?n(e):o.formErrHandler(e,function(e){t.close(),document.location.href="/users/profile/"},null,".chg-email-now","确认修改")},function(e,t){return o.btnAlert(".chg-email-now","修改接收失败！请重新获取",r),!1},{password:s,code:a,email:i},"json")):(o.labelErr("to-chg-email","请输入要新的邮箱！"),e.parent().parent().find(".to-chg-email").focus(),!1)},null,"login-passwd to-chg-email",e,t)},countDown:function(e,t){$(e+" .jumpTo").length&&(console.log("countDown",$(e+" .jumpTo").length),timeInterval=setInterval(function(){var n=$(e+" .jumpTo").text();n.match(/[0-9]/i)||(n="0"),countDownLeft=parseInt(n),countDownLeft--,countDownLeft<=0?(clearInterval(timeInterval),document.location.href=t):$(e+" .jumpTo").text(countDownLeft)},1e3))},chgMobile:function(e,t,n,o,r){var i=this,a='<div class="no-feed-alert"><h2><i class="i-warning"></i>'+e+"</h2><br><br>"+i.modalLine3Col("请输入登录密码","login-passwd","password")+i.modalLine3Col("请输入新的手机号码","new-phone")+i.modalLine3Col("请输入短信验证码","code","text","use-sms-code")+'<br><p><a class="btn confirm '+n+'-now" href="javascript:void(0);">'+t+"</a></p></div>";i.box(a,"."+n+"-now",function(e,t){var o=e.parent().parent().find(".code").prop("value"),r=e.parent().parent().find(".new-phone").prop("value"),a=e.parent().parent().find(".login-passwd").prop("value");if(""==$.trim(a))return i.labelErr("login-passwd","请输入登录密码！"),e.parent().parent().find(".login-passwd").focus(),!1;if(!r.match(/^1[0-9]{10}$/i))return i.labelErr("new-phone","请输入新的手机号码！"),e.parent().parent().find(".new-phone").focus(),!1;if(!o.match(/^[0-9]{6}$/i))return i.labelErr("sms-code","请输入六位短信验证码！"),e.parent().parent().find(".sms-code").focus(),!1;$(".sms-code").html();$("."+n+"-now").attr("disabled","true"),PB.request("post","/users/change_mobile/","json",function(e){$("."+n+"-now").removeAttr("disabled"),PB.formErrHandler(e,function(e){console.log("change_mobile",e),t.close(),document.location.href="/users/profile/"},null,"."+n+"-now","确认修改")},function(e,t){return PB.btnAlert("."+n+"-now","修改绑定手机失败！请重新获取"),!1},{password:a,mobile:r,code:o},"json")},null,"new-phone",o,r,"ChangeMobile")},labelErr:function(e,t){if($("#"+e+"-error").length){var t=void 0!=t&&"string"==typeof t?t:"";""==t?($("#"+e+"-error").text(t).css("display","none"),$("#"+e+"-title-error").css("display","none")):($("#"+e+"-error").text(t).css("display","block"),$("#"+e+"-title-error").css("display","block"))}$("#"+e).on("blur",function(){""!=$(this).prop("value").trim()&&($("#"+e+"-error").text("").css("display","none"),$("#"+e+"-title-error").css("display","none"))})},boxHtml:function(e,t,n,o,r,i,a,s){var l="",c=void 0!=s&&"boolean"==typeof s?s:!0,d=void 0!=n&&"boolean"==typeof n?n:!1,p=void 0!=i&&"string"==typeof i?i:"u-btn-red",u=void 0!=a&&"string"==typeof a?a:"u-btn-grey-blue";return l+='<div class="mission-success"><h3 class="text-center"><i class="i-ms"></i>'+e+'</h3><p class="text-center">'+t+'</p><p class="mt20 text-center">',c&&d&&(l+='<a class="btn btn-small button '+p+' f-mg-lr-20" href="javascript:void(0);">'+o+"</a>"),c&&(l+='<a class="btn btn-small '+u+' f-mg-lr-20" href="javascript:void(0);">'+r+"</a>"),l+="</p></div>"},modal:function(e,t,n,o,r,i){var a=void 0!=r&&"string"==typeof r?r:"u-btn-red",s=void 0!=i&&"string"==typeof i?i:"u-btn-grey-blue";$.LayerOut({html:e,afterClose:function(){"function"==typeof t&&t()}}),$("."+a).on("click",function(e){"function"==typeof n&&n(e)}),$("."+s).on("click",function(e){"function"==typeof o&&o(e)})}}}();