!function(e){var t=angular.module("app.resume_center",["app.config","ui.router","app.django","app.utils","app.filter"]),r=angular.injector(["app.django"]),o=angular.injector(["app.utils"]),s=r.get("tmpl");r.get("static_url");t.config(["$interpolateProvider",function(e){e.startSymbol("{-"),e.endSymbol("-}")}]),t.factory("$",["$window",function(e){return e.jQuery.noConflict()}]);var a=(o.get("pbLib"),o.get("alertBox"),o.get("getModeData")),n=o.get("postModeData"),c=o.get("pbFunc"),l=function(e,t,r){var o=a(e,"/resume/side/?t="+r.getTimestamp(new Date),"",function(e){"ok"==e.status&&(t.sideData=e.data)},void 0,function(e){o.abort()});return o},i=function(e,t,r,o,s,n,c,l,i){var d=void 0!=i&&1==i?e.$parent:e,p=r+"?page="+o,f=!1;m(f),s&&(p+="&mark="+s),n&&(p+="&category="+n),c&&(p+="&search_fields="+c),l&&(p+="&keywords="+l);var g,h=function(e,t,r){var r=void 0!=r?!0:!1,o=5,s=function(e,t){var r=[],o=e.pageNum<=t?e.pageNum:e.startPage+t;if(e.pageNum>t&&e.cp>1){var s=Math.ceil((e.startPage+t)/2);"next"==e.pageDirect&&e.cp>s&&e.pageNum-e.cp>=2?(e.startPage+=1,e.startPage>e.pageNum&&(e.startPage=e.pageNum),o=e.startPage+t):"prev"==e.pageDirect&&e.cp>=1&&(e.startPage-=1,e.startPage<1&&(e.startPage=1),o=e.startPage+t)}if(o>e.pageNum&&(o=e.pageNum+1),1>o&&(o=1),t>=o)for(var a=e.startPage;o>=a;a++)r.push(a);else for(var a=e.startPage;o>a;a++)r.push(a);return r};f=!0,m(f),r||(e.cp=t.current),e.sum=r?30:t.count,e.listData=r?[]:t.data,e.pageNum=r?3:t.pages,e.pages=s(e,o),e.chooseResume&&e.chooseResume.length>0&&e.chooseResume.splice(0),u(t.data.length),$(".check-box").removeClass("check-box-choose")};return g=a(t,p,"",function(e){"ok"==e.status&&h(d,e)},void 0,function(e){g.abort()})},u=function(e){e>0?($(".null-data").css("display","none"),$(".resume-center-tabel-bottom").css("display","block")):($(".null-data").css("display","block"),$(".resume-center-tabel-bottom").css("display","none"))},m=function(e){e||"block"==$(".resume-center-loading").css("display")?e&&"block"==$(".resume-center-loading").css("display")&&$(".resume-center-loading").css("display","none"):($(".js-resume").remove(),$(".resume-center-loading").css("display","block"))},d=function(e){0==e.createFolderState?(e.createFolderState=!0,e.showFolderName=!0):(e.createFolderState=!1,e.showFolderName=!1)},p=function(e,t,r){var o=$("#js-category-name").val().replace(/[<>%&\-\+\'\"\*\?\(\)\[\]\{\} \$\r\n]/gi,"");if(o.length>0)var s=n(e,{category_name:o},"/resume/category/create/","",function(o){"ok"==o.status&&l(e,t,r)},void 0,function(e){s.abort()},"json")},f=function(e,t,r,o,s){var c=angular.element(e.currentTarget),i=c.parent().find("a").attr("folder-name"),u=c.parent().find("a").attr("folder-id");t.simpleConfirm("编辑自定义文件夹",'<div class="rename-input-box"><input type="text" value="'+i+'" id="js-rename-floder"></div><p class="mt50 cf46c62 f13">小宝提示：你可以自由添加简历到自定义文件夹哦~</p>',function(e){t.simpleConfirm("需要你的确认",'<div class="del-confirm">你确定删除<span>'+i+'</span>自定义文件夹吗？</div><p class="mt50 cf46c62 f13">小宝提示：删除的文件夹不能恢复，但简历不会被删除，仍然存在于对应简历状态菜单中~</p>',function(e){r._LayerOut.close()},null,"返回",!0,"确认删除",function(e){var n="/resume/category/delete/"+u+"/?category_name"+i,c=a(o,n,"",function(e){r._LayerOut.close(),l(o,s,t)},void 0,function(e){c.abort()})})},null,"删除文件夹",!0,"保存",function(e){var a=$("#js-rename-floder").val(),i=n(o,{category_name:a},"/resume/category/update/"+u+"/","",function(e){"ok"==e.status&&(r._LayerOut.close(),t.simpleAlert("保存成功！","",function(e,t){},null,"我知道了",!1),c.parent().find(".js-folder-name").text(a),c.parent().find("a").attr("folder-name",a),l(o,s,t))},void 0,function(e){i.abort()},"json")})},g=function(e){e.stopPropagation();var t=angular.element(e.currentTarget),r=t.attr("resume-id"),o=t.attr("feed-id"),s="/resumes/display/"+r+"/?feed_id="+o;window.open(s)},h=function(e,t){var r=angular.element(e.currentTarget),o=r.attr("search-fields");t.search_fields=o,$(".filter-factor-choose").removeClass("filter-factor-choose"),$("#js-search-filter").text(r.text()),r.addClass("filter-factor-choose"),t.showFilter=!1},v=function(e,t,r,o,s){var s=void 0!=s&&"number"==typeof s?s:1,a=$("#js-search-filter-params").val();r.search_fields=a,r.keywords=$("#js-search-val").val(),i(r,o,e.url,s,r.mark,r.category,a,r.keywords)},y=function(e,t){var r=angular.element(e.currentTarget),o=$(".js-resume"),s=o.length,a=t.chooseResume.length;if(r.hasClass("check-box-choose"))t.chooseResume.splice(0,a),$(".check-box").removeClass("check-box-choose"),$("#js-choose-resume-num").text(0);else{t.chooseResume.splice(0,a),$(".check-box").addClass("check-box-choose"),$("#js-choose-resume-num").text(s);for(var n=0;s>n;n++){var c=o.eq(n).attr("id");t.chooseResume.push(c)}}},b=function(e,t){var r=angular.element(e.currentTarget),o=r.parent().parent().parent().attr("id"),s=t.chooseResume.length;if(r.hasClass("check-box-choose")){r.removeClass("check-box-choose"),$(".js-choose-all").removeClass("check-box-choose"),$("#js-choose-resume-num").text(s-1);for(var a=0;s>a;a++)if(o==t.chooseResume[a]){t.chooseResume.splice(a,1);break}}else t.chooseResume.push(o),r.addClass("check-box-choose"),$("#js-choose-resume-num").text(s+1),t.chooseResume.length>=$(".js-choose-this").length&&$(".js-choose-all").addClass("check-box-choose")},k=function(e,t){if(t.folder_id&&t.chooseResume&&!$(".js-remove-resume").hasClass("remove-resume-choose"))var r=n(e,{record_id:t.chooseResume},"/resume/category_resume/"+t.folder_id+"/","",function(r){"ok"==r.status&&(t.folder_id="",$(".check-box").removeClass("check-box-choose"),l(e,t,c),$("#js-choosed-folder-name").text("添加到自定义文件夹"),$(".success-tip").css("display","block"),$(".js-tip-word").text("添加成功"),setTimeout(function(){$(".success-tip").css("display","none")},4e3))},void 0,function(e){r.abort()},"json");if($(".js-remove-resume").hasClass("remove-resume-choose"))var r=n(e,{record_id:t.chooseResume},"/resume/category_resume/remove/"+t.folderId+"/","",function(r){"ok"==r.status&&($(".check-box").removeClass("check-box-choose"),l(e,t,c),$(".js-remove-resume").removeClass("remove-resume-choose"),$("#js-choosed-folder-name").text("添加到自定义文件夹"),$(".success-tip").css("display","block"),$(".js-tip-word").text("移除成功"),i(t,e,t.url,t.cp,t.mark,t.category),setTimeout(function(){$(".success-tip").css("display","none")},4e3))},void 0,function(e){r.abort()},"json")};t.config(["$stateProvider","$urlRouterProvider",function(e,t){var r="/";t.otherwise(r),e.state("default",{url:"/",templateUrl:s("resume/resume_center_detail.html"),controller:"resumeCenter"}),e.state("company_card",{url:"/{area:company_card}/{cp:[0-9]+}",templateUrl:s("resume/company_record.html"),controller:"resumeCenter"}),e.state("my_favs",{url:"/{area:my_favs}/{cp:[0-9]+}",templateUrl:s("resume/collect.html"),controller:"resumeCenter"}),e.state("category",{url:"/{area:f-[0-9]+}/{cp:[0-9]+}",templateUrl:s("resume/resume_center_detail.html"),controller:"resumeCenter"}),e.state("mark",{url:"/{area:[0-9a-z_]+}/{cp:[0-9]+}",templateUrl:s("resume/resume_center_detail.html"),controller:"resumeCenter"})}]),t.controller("resumeCenter",["$rootScope","$scope","$http","$state","$stateParams",function(e,t,r,o,s){t.folderId=1,t.sum=0,t.pageNum=0,t.removeShow=!1,t.startPage=1,t.pageDirect="next",t.cp=1,t.ep=10,s&&s.cp&&(t.cp=s.cp.replace(/[^0-9]/gi,"")),parseInt(t.cp)<1&&(t.cp=1),t.pages=1,t.area="",s&&s.area&&(t.area=s.area.replace(/[^0-9a-z_]/gi,"")),t.sideData={},t.haveCollect=!1,t.controlNavCurrent=!1,t.nullCollect=!0,t.nullCollectCurrent=!1,t.createFolderState=!1,t.showFolderName=!1,t.showFilter=!1,t.url="/resume/buy_record/list/",e.url="/resume/buy_record/list/",t.mark="",t.category="",t.search_fields="all",t.keywords="",t.chooseResume=[],t.leftFix=!1;var a=!1;t.currentFolderId="";var n="",u="",m=function(e,t,r){if(r&&r.area){var o;if($(".control-nav-current").removeClass("control-nav-current"),"my_favs"==r.area)t.url="/resume/follow/list/",e.url="/resume/follow/list/",t.haveCollect=!1,t.controlNavCurrent=!0,t.mark="",t.category="",t.sideData.watch_count>0&&(t.haveCollect=!0,t.nullCollect=!1),$("#js-collect-num").text()<=0&&0==t.nullCollectCurrent&&(t.nullCollect=!1,t.nullCollectCurrent=!0),o=$(".area-btn-fav"),t.leftFix=!0;else if("company_card"==r.area)t.controlNavCurrent=!1,t.mark="",t.category="",t.url="/resume/send_record/list/",e.url="/resume/send_record/list/",o=$(".area-btn-company-card"),t.leftFix=!0;else if(r.area.match(/^f\-([0-9]+)$/i)){t.controlNavCurrent=!1,t.mark="",t.category="",t.removeShow=!0;var s=RegExp.$1;t.currentFolderId=s;for(var c in t.sideData.categories)if(t.sideData.categories[c].id==s){t.category=t.sideData.categories[c].category_name;break}for(var l in t.sideData.categories)if(t.sideData.categories[l].category_name==t.category){t.folderId=t.sideData.categories[l].id;break}""==t.category&&(a=!0),t.url="/resume/buy_record/list/",e.url="/resume/buy_record/list/",o=$(".area-btn-f-"+s)}else t.controlNavCurrent=!1,t.mark=r.area,t.category="",t.url="/resume/buy_record/list/",e.url="/resume/buy_record/list/",o=$(".area-btn-"+r.area),r.area.match(/^(invite_interview|break_invite|unconfirm)$/i)?(n="interview_stage",u=RegExp.$1):r.area.match(/^(send_offer|entry)$/i)&&(n="entry_stage",u=RegExp.$1);$(".control-nav").find("a.control-nav-current").removeClass("control-nav-current"),o.addClass("control-nav-current"),parseInt($("#js-collect-num").text())>0?(t.haveCollect=!0,t.controlNavCurrent=!1):(t.nullCollect=!0,t.nullCollectCurrent=!1),$("#js-interview").css("display","none"),$("#js-entry").css("display","none"),o.hasClass("js-show-second-nav")&&(o.text().match("录用阶段")?"block"==$("#js-entry").css("display")?$("#js-entry").css("display","none"):$("#js-entry").css("display","block"):"block"==$("#js-interview").css("display")?$("#js-interview").css("display","none"):$("#js-interview").css("display","block"))}""!=n?($("#js-entry").css("display","none"),$("#js-interview").css("display","none"),"interview_stage"==n?($(".area-btn-interview_stage").addClass("control-nav-current"),$("#js-interview").css("display","block")):($(".area-btn-entry_stage").addClass("control-nav-current"),$("#js-entry").css("display","block")),$(".area-btn-"+u).addClass("control-subnav-current")):$(".area-btn-"+u).removeClass("control-subnav-current")};l(r,t,c).then(function(){return m(e,t,s),a||i(t,r,t.url,t.cp,t.mark,t.category),a&&(document.location.href="/resume/center/"),!1}),e.isHaveCollect=function(){return parseInt($("#js-collect-num").text())>0?!0:!1},t.go=function(e){var t="",r="";if(e.match(/^(interview_stage|entry_stage)$/i)){var o=RegExp.$1,s=RegExp("/"+o+"/","i");document.location.href.toString().match(s)&&("entry_stage"==o?($("#js-interview").css("display","none"),"block"==$("#js-entry").css("display")?$("#js-entry").css("display","none"):$("#js-entry").css("display","block")):"interview_stage"==o&&($("#js-entry").css("display","none"),"block"==$("#js-interview").css("display")?$("#js-interview").css("display","none"):$("#js-interview").css("display","block")))}e.match(/^([0-9a-z_]+)$/i)?(t=RegExp.$1,r="/1",document.location.href="/resume/center/#/"+t+r):e.match(/^(f\-[0-9]+)$/i)?(t=RegExp.$1,r="/1",document.location.href="/resume/center/#/"+t+r):document.location.reload()},t.createFolder=function(){d(t)},t.saveFolder=function(){p(r,t,c)},t.editFolder=function(e){e.stopPropagation(),f(e,c,$,r,t)},t.clickToDetail=function(e){var t=angular.element(e.target);t.hasClass("stop-to-detail")||g(e)},t.sexMale=function(e){return"男"==e?0:"女"==e?1:"男"!=e&&"女"!=e?2:void 0},t.showSearchFilter=function(){0==t.showFilter?t.showFilter=!0:t.showFilter=!1},t.chooseSearchFilter=function(e){e.stopPropagation(),h(e,t)},t.search=function(o){o.stopPropagation(),v(e,o,t,r)},t.enterToSearch=function(o){o.stopPropagation();var s=o.keyCode;13==s&&v(e,o,t,r)},t.chooseAllResume=function(e){e.stopPropagation(),y(e,t)},t.chooseCurrentResume=function(e){e.stopPropagation(),e.stopPropagation(),b(e,t)},t.folderAddResume=function(){"block"!=$("#js-foder-choose").css("display")?$("#js-foder-choose").css("display","block"):$("#js-foder-choose").css("display","none")},t.chooseFolderName=function(e){e.stopPropagation();var r=angular.element(e.currentTarget);t.folder_id=r.attr("folder-id"),$("#js-choosed-folder-name").text(r.text()),$("#js-foder-choose").css("display","none"),$(".js-remove-resume").removeClass("remove-resume-choose")},t.chooseRemove=function(){$(".js-remove-resume").toggleClass("remove-resume-choose"),$("#js-choosed-folder-name").text("添加到自定义文件夹"),$("#js-foder-choose").css("display","none")},t.confirmAdd=function(){k(r,t)},t.unconfirm=function(e){return"unconfirm"==e||void 0==e||null==e||""==e?!0:!1},t.redcolor=function(e){return"待处理"==e||"面试爽约"==e?!0:!1},t.feedback_status_zero=function(e){return 0==e?!0:!1},t.feedback_status_one=function(e){return 1==e?!0:!1},t.feedback_status_two=function(e){return 2==e?!0:!1},t.feedback_status_three=function(e){return 3==e?!0:!1}}]),t.filter("trustHtml",["$sce",function(e){var t=function(e){var t=6,r=null,o=e.match(/(<br[ \/]*>)/gi);if(void 0!=o&&"object"==typeof o&&o.length>=1){r=RegExp.$1;var s=e.split(r);e=s[0].length>t?s[0]:s[0]+r+s[1],e.match(/\.\.\.$/i)||(e+="...")}return e};return function(r){var o=12;return"string"!=typeof r?"":(r=t(r.length>o?r.substr(0,o-3)+"...":r),e.trustAsHtml(r))}}]),t.filter("trustHtmlAllForTitle",["$sce",function(e){return function(t){if("string"!=typeof t)return"";var r=new RegExp("<br[ /]*>","ig");return t=t.replace(r,"\n\n"),e.trustAsHtml(t)}}]),t.directive("pages",["$http",function(e){return{restrict:"E",templateUrl:s("resume/pages.html"),controller:["$scope","$element",function(t,r){var o=t.$parent;t.isFirstPage=function(e){return 1==o.cp?!0:!1},t.isLastPage=function(e){return o.cp==o.pageNum?!0:!1},t.prevPage=function(r){return 1==o.cp?!1:(o.cp-1<1?o.cp=1:o.cp-=1,o.pageDirect="prev",void i(t,e,t.url,o.cp,t.mark,t.category,t.searchFields,t.keywords,!0))},t.nextPage=function(r){return o.cp==o.pageNum?!1:(o.cp+1>o.pageNum?o.cp=o.pageNum:o.cp+=1,o.pageDirect="next",void i(t,e,t.url,o.cp,t.mark,t.category,t.searchFields,t.keywords,!0))},t.clickPage=function(r){var s=angular.element(r.currentTarget);return o.cp==parseInt(s.text())?!1:(o.cp=parseInt(s.text()),void i(t,e,t.url,o.cp,t.mark,t.category,t.searchFields,t.keywords,!0))}}],scope:{cp:"=cp",pageNum:"=pageNum",pages:"=pages",url:"=url",mark:"=mark",category:"=category",searchFields:"=searchFields",keywords:"=keywords",chooseResume:"=chooseResume"}}}]),t.directive("selectBtns",["$http",function(e){return{restrict:"E",templateUrl:s("resume/select-btns.html"),controller:["$scope","$element",function(e,t){e.unconfirm=function(e){return"unconfirm"==e||void 0==e||null==e||""==e?!0:!1}}],scope:{resumeMassage:"=resumeMassage"}}}]),t.directive("resumeBrief",["$http",function(e){return{restrict:"E",templateUrl:s("resume/resume_brief.html"),controller:["$scope","$element",function(e,t){e.sexMale=function(e){return"男"==e?0:"女"==e?1:"男"!=e&&"女"!=e?2:void 0},e.hasContactInfo=function(e){return ret=!angular.equals(e,{}),ret}}],scope:{resumeMassage:"=resumeMassage",leftFix:"=leftFix"}}}]),t.directive("meetTime",["$http",function(e){return{restrict:"E",templateUrl:s("resume/meet_time.html"),controller:["$scope","$element",function(e,t){e.showMeetInfo=function(e){return e.interview_count&&e.interview_count>0?"安排第"+e.interview_count+"轮面试":"安排面试"},e.isInterView=function(e){return"invite_interview"==e||"next_interview"==e?!0:!1}}],scope:{resumeMassage:"=resumeMassage"}}}])}();